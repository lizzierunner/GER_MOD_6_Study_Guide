<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>â›ï¸ Die 7 Zwerge â€” Module 6 Study Quest</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'system-ui', 'sans-serif'],
              display: ['Space Grotesk', 'sans-serif'],
              mono: ['JetBrains Mono', 'monospace'],
            }
          }
        }
      }
    </script>
    <style>
      * { box-sizing: border-box; }
      html { scroll-behavior: smooth; }
      body { font-family: 'Inter', system-ui, sans-serif; }

      /* ADHD-friendly: reduce motion for those who prefer it */
      @media (prefers-reduced-motion: reduce) {
        *, *::before, *::after {
          animation-duration: 0.01ms !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* Custom scrollbar */
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: #1a1a2e; }
      ::-webkit-scrollbar-thumb { background: #4a3f8a; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #6c5ce7; }

      /* Animations */
      @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-8px)} }
      @keyframes pulse-glow { 0%,100%{box-shadow:0 0 20px rgba(108,92,231,0.3)} 50%{box-shadow:0 0 40px rgba(108,92,231,0.6)} }
      @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-5px)} 75%{transform:translateX(5px)} }
      @keyframes pop { 0%{transform:scale(0.8);opacity:0} 50%{transform:scale(1.05)} 100%{transform:scale(1);opacity:1} }
      @keyframes slide-up { from{transform:translateY(30px);opacity:0} to{transform:translateY(0);opacity:1} }
      @keyframes slide-right { from{transform:translateX(-30px);opacity:0} to{transform:translateX(0);opacity:1} }
      @keyframes flip-in { from{transform:rotateY(90deg);opacity:0} to{transform:rotateY(0);opacity:1} }
      @keyframes bounce-in { 0%{transform:scale(0)} 50%{transform:scale(1.15)} 70%{transform:scale(0.95)} 100%{transform:scale(1)} }
      @keyframes gradient-shift { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
      @keyframes xp-fly { 0%{transform:translateY(0);opacity:1} 100%{transform:translateY(-60px);opacity:0} }
      @keyframes wiggle { 0%,100%{transform:rotate(0deg)} 25%{transform:rotate(-3deg)} 75%{transform:rotate(3deg)} }
      @keyframes rainbow { 0%{color:#ff6b6b} 16%{color:#feca57} 33%{color:#48dbfb} 50%{color:#ff9ff3} 66%{color:#54a0ff} 83%{color:#5f27cd} 100%{color:#ff6b6b} }
      @keyframes pickaxe-swing { 0%,100%{transform:rotate(0deg)} 25%{transform:rotate(-20deg)} 50%{transform:rotate(15deg)} 75%{transform:rotate(-10deg)} }
      @keyframes gem-sparkle { 0%,100%{filter:brightness(1) drop-shadow(0 0 4px rgba(251,191,36,0.3))} 50%{filter:brightness(1.4) drop-shadow(0 0 12px rgba(251,191,36,0.8))} }
      @keyframes lantern-glow { 0%,100%{text-shadow:0 0 8px rgba(251,191,36,0.4)} 50%{text-shadow:0 0 20px rgba(251,191,36,0.8), 0 0 40px rgba(251,191,36,0.3)} }
      @keyframes mine-cart { 0%{transform:translateX(-10px)} 50%{transform:translateX(10px)} 100%{transform:translateX(-10px)} }

      .animate-float { animation: float 3s ease-in-out infinite; }
      .animate-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
      .animate-shake { animation: shake 0.5s ease-in-out; }
      .animate-pop { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
      .animate-slide-up { animation: slide-up 0.5s ease-out forwards; }
      .animate-slide-right { animation: slide-right 0.4s ease-out forwards; }
      .animate-flip-in { animation: flip-in 0.5s ease-out forwards; }
      .animate-bounce-in { animation: bounce-in 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
      .animate-gradient { background-size: 200% 200%; animation: gradient-shift 3s ease infinite; }
      .animate-wiggle { animation: wiggle 1s ease-in-out infinite; }
      .animate-rainbow { animation: rainbow 3s linear infinite; }
      .animate-xp-fly { animation: xp-fly 1.2s ease-out forwards; }
      .animate-pickaxe { animation: pickaxe-swing 2s ease-in-out infinite; }
      .animate-gem-sparkle { animation: gem-sparkle 2s ease-in-out infinite; }
      .animate-lantern { animation: lantern-glow 3s ease-in-out infinite; }
      .animate-mine-cart { animation: mine-cart 3s ease-in-out infinite; }

      /* Dwarf avatar */
      .dwarf-avatar {
        width: 44px; height: 44px; border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        font-size: 1.2rem; font-weight: 800; flex-shrink: 0;
        border: 2px solid rgba(255,255,255,0.2);
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        transition: transform 0.3s, box-shadow 0.3s;
      }
      .dwarf-avatar:hover { transform: scale(1.15) rotate(-5deg); box-shadow: 0 6px 20px rgba(0,0,0,0.4); }
      .dwarf-avatar-sm { width: 32px; height: 32px; font-size: 0.9rem; }

      /* Mine shaft decorative border */
      .mine-border {
        border-image: repeating-linear-gradient(
          45deg,
          rgba(161,98,7,0.3) 0px,
          rgba(161,98,7,0.3) 2px,
          transparent 2px,
          transparent 8px
        ) 8;
      }

      /* Flashcard flip */
      .flip-card { perspective: 1200px; }
      .flip-card-inner { transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; }
      .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
      .flip-card-front, .flip-card-back { backface-visibility: hidden; }
      .flip-card-back { transform: rotateY(180deg); }

      /* ADHD: high-contrast focus indicators */
      .adhd-focus { position: relative; }
      .adhd-focus::before {
        content: ''; position: absolute; inset: -3px; border-radius: inherit;
        border: 2px dashed rgba(251,191,36,0.4); opacity: 0; transition: opacity 0.3s;
        pointer-events: none;
      }
      .adhd-focus:hover::before { opacity: 1; }

      /* ADHD: progress dots for flashcards */
      .fc-dot {
        width: 10px; height: 10px; border-radius: 50%;
        background: rgba(255,255,255,0.15); transition: all 0.3s;
        flex-shrink: 0;
      }
      .fc-dot.active { background: #fbbf24; box-shadow: 0 0 8px rgba(251,191,36,0.5); transform: scale(1.3); }
      .fc-dot.known { background: #34d399; box-shadow: 0 0 6px rgba(52,211,153,0.4); }

      /* ADHD: keyboard shortcut hints */
      .kbd {
        display: inline-flex; align-items: center; justify-content: center;
        padding: 2px 6px; border-radius: 4px; font-size: 10px; font-family: 'JetBrains Mono', monospace;
        background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
        color: rgba(255,255,255,0.5); line-height: 1.2;
      }

      /* ADHD: gentle breathing glow on active card */
      @keyframes breathe { 0%,100%{box-shadow:0 0 20px rgba(251,191,36,0.1), 0 8px 32px rgba(0,0,0,0.3)} 50%{box-shadow:0 0 40px rgba(251,191,36,0.2), 0 8px 32px rgba(0,0,0,0.3)} }
      .animate-breathe { animation: breathe 3s ease-in-out infinite; }

      /* Big flashcard sizing */
      .flashcard-container { min-height: 420px; }
      @media (min-width: 640px) { .flashcard-container { min-height: 480px; } }
      @media (min-width: 1024px) { .flashcard-container { min-height: 500px; } }

      /* Example essay styling */
      .essay-example-text p { margin-bottom: 0; }
      .essay-example-text p + p { margin-top: 0.75rem; }
      .essay-example-text strong { color: #a5b4fc; }
      .essay-example-text em { color: #c4b5fd; }

      /* Glass effect */
      .glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); }
      .glass-strong { background: rgba(255,255,255,0.08); backdrop-filter: blur(30px); border: 1px solid rgba(255,255,255,0.15); }

      /* Focus ring for accessibility */
      button:focus-visible, [tabindex]:focus-visible { outline: 2px solid #a78bfa; outline-offset: 2px; border-radius: 8px; }

      /* Tag pills */
      .tag { display: inline-flex; align-items: center; gap: 4px; padding: 4px 12px; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; letter-spacing: 0.025em; }

      /* Tooltip */
      .tooltip-text { visibility: hidden; opacity: 0; transition: opacity 0.2s; }
      .tooltip:hover .tooltip-text { visibility: visible; opacity: 1; }

      /* Streak fire */
      .streak-fire { filter: drop-shadow(0 0 8px rgba(251,146,60,0.5)); }

      /* Background particles */
      #particles-canvas {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; z-index: 0; opacity: 0.4;
      }

      /* ============ PRINT STYLES ============ */
      @media print {
        /* Hide everything except the cheat sheet */
        body { background: white !important; color: black !important; font-size: 9pt !important; line-height: 1.3 !important; }
        nav, #particles-canvas, .no-print, #xp-fly-container, #timer-modal, #achievement-toast,
        .fixed, .mode-btn, #topnav, footer { display: none !important; }
        main { padding: 0 !important; margin: 0 !important; max-width: 100% !important; }
        .view { display: none !important; }
        #view-cheatsheet { display: block !important; }
        #cheatsheet-content { max-width: 100% !important; }

        /* Show print header */
        .print-only-header { display: block !important; }

        /* Reset glass backgrounds for print */
        .glass, .glass-strong, .print-section {
          background: white !important; border: 1.5px solid #333 !important;
          backdrop-filter: none !important; -webkit-backdrop-filter: none !important;
          border-radius: 6px !important; padding: 8px !important; margin-bottom: 6px !important;
          page-break-inside: avoid;
        }

        /* Text colors for print */
        .text-gray-300, .text-gray-400 { color: #222 !important; }
        .text-white, strong.text-white { color: #000 !important; font-weight: 700 !important; }
        .text-amber-300, .text-amber-400, .text-pink-300, .text-pink-400,
        .text-violet-300, .text-violet-400, .text-green-300, .text-blue-300,
        .text-red-300, .text-yellow-300, .text-purple-300, .text-rose-300 { color: #000 !important; font-weight: 700 !important; }

        /* Compact spacing */
        .mb-3, .mb-4 { margin-bottom: 4px !important; }
        .p-4, .p-5 { padding: 6px !important; }
        .gap-2 { gap: 4px !important; }
        .space-y-0\.5 > * + * { margin-top: 1px !important; }
        h3 { font-size: 11pt !important; }
        .text-xs, .text-sm { font-size: 8.5pt !important; }

        /* Colored section borders for print */
        .border-amber-500\/30 { border-left: 4px solid #f59e0b !important; }
        .border-pink-500\/30 { border-left: 4px solid #ec4899 !important; }
        .border-violet-500\/30 { border-left: 4px solid #8b5cf6 !important; }

        /* Inner highlight boxes */
        .bg-amber-500\/10, .bg-pink-500\/10, .bg-violet-500\/10, .bg-pink-500\/5 {
          background: #f5f5f5 !important; border: 1px solid #ccc !important;
        }

        /* Page sizing */
        @page { margin: 0.4in; size: letter; }
      }
    </style>
</head>
<body class="bg-[#0f0f23] text-white min-h-screen relative">

<!-- Subtle animated background -->
<canvas id="particles-canvas"></canvas>

<!-- ============================================================ -->
<!--  TOP NAV BAR                                                 -->
<!-- ============================================================ -->
<nav id="topnav" class="fixed top-0 left-0 right-0 z-50 glass-strong">
  <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <span class="text-2xl animate-pickaxe">â›ï¸</span>
      <div>
        <h1 class="font-display font-bold text-sm sm:text-base leading-tight bg-gradient-to-r from-amber-400 via-orange-400 to-red-400 bg-clip-text text-transparent">Die 7 Zwerge Study Quest</h1>
        <p class="text-[10px] text-gray-400 font-mono">Module 6 Â· Dwarfs, Fairy Tales, Humor &amp; Culture</p>
      </div>
    </div>
    <div class="flex items-center gap-3 sm:gap-5">
      <div id="streak-display" class="flex items-center gap-1.5 cursor-pointer tooltip relative" onclick="showStreakInfo()">
        <span class="text-lg streak-fire">ğŸ”¥</span>
        <span id="streak-count" class="font-mono font-bold text-orange-400 text-sm">0</span>
        <span class="tooltip-text absolute top-full mt-2 right-0 bg-gray-900 text-xs px-3 py-2 rounded-lg border border-gray-700 whitespace-nowrap z-50">Correct answer streak!</span>
      </div>
      <div class="flex items-center gap-1.5">
        <span class="text-lg">â­</span>
        <span id="xp-display" class="font-mono font-bold text-amber-400 text-sm">0 XP</span>
      </div>
      <div id="level-badge" class="hidden sm:flex items-center gap-1.5 bg-purple-500/20 border border-purple-500/30 rounded-full px-3 py-1">
        <span class="text-xs">ğŸ‘‘</span>
        <span id="level-display" class="font-mono font-bold text-purple-300 text-xs">Lv 1</span>
      </div>
      <button onclick="toggleTimer()" class="flex items-center gap-1.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-full px-3 py-1.5 transition-all group">
        <span class="text-base group-hover:animate-wiggle">â±ï¸</span>
        <span id="timer-display" class="font-mono text-xs text-gray-300">25:00</span>
      </button>
    </div>
  </div>
  <div class="h-1 bg-gray-800">
    <div id="xp-bar" class="h-full bg-gradient-to-r from-amber-500 via-orange-500 to-red-500 transition-all duration-700 ease-out rounded-r" style="width:0%"></div>
  </div>
</nav>

<!-- XP Fly Animation Container -->
<div id="xp-fly-container" class="fixed top-16 right-24 z-[60] pointer-events-none"></div>

<!-- ============================================================ -->
<!--  POMODORO TIMER MODAL                                        -->
<!-- ============================================================ -->
<div id="timer-modal" class="fixed inset-0 z-[70] hidden items-center justify-center bg-black/60 backdrop-blur-sm">
  <div class="glass-strong rounded-2xl p-8 max-w-sm w-full mx-4 text-center animate-pop">
    <h3 class="font-display text-xl font-bold mb-2">â›ï¸ Mining Timer</h3>
    <p class="text-gray-400 text-sm mb-6">Stay focused in the mine! Take breaks between sessions.</p>
    <div class="relative w-48 h-48 mx-auto mb-6">
      <svg class="w-full h-full" viewBox="0 0 100 100" style="transform:rotate(-90deg)">
        <circle cx="50" cy="50" r="45" fill="none" stroke="#1e1b4b" stroke-width="6"/>
        <circle id="timer-circle" cx="50" cy="50" r="45" fill="none" stroke="url(#timer-gradient)" stroke-width="6" stroke-linecap="round" stroke-dasharray="283" stroke-dashoffset="0" style="transition:stroke-dashoffset 1s linear"/>
        <defs><linearGradient id="timer-gradient" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#f97316"/></linearGradient></defs>
      </svg>
      <div class="absolute inset-0 flex flex-col items-center justify-center" style="transform:rotate(0deg)">
        <span id="timer-big" class="font-mono text-4xl font-bold text-white">25:00</span>
        <span id="timer-label" class="text-xs text-gray-400 mt-1">FOCUS TIME</span>
      </div>
    </div>
    <div class="flex gap-3 justify-center mb-4">
      <button onclick="setTimer(15)" class="px-4 py-2 rounded-lg bg-purple-500/20 border border-purple-500/30 text-purple-300 text-sm font-semibold hover:bg-purple-500/30 transition">15 min</button>
      <button onclick="setTimer(25)" class="px-4 py-2 rounded-lg bg-pink-500/20 border border-pink-500/30 text-pink-300 text-sm font-semibold hover:bg-pink-500/30 transition">25 min</button>
      <button onclick="setTimer(45)" class="px-4 py-2 rounded-lg bg-amber-500/20 border border-amber-500/30 text-amber-300 text-sm font-semibold hover:bg-amber-500/30 transition">45 min</button>
    </div>
    <div class="flex gap-3 justify-center">
      <button onclick="startTimer()" class="px-6 py-2.5 rounded-xl bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold text-sm hover:opacity-90 transition">â›ï¸ Start</button>
      <button onclick="pauseTimer()" class="px-6 py-2.5 rounded-xl bg-white/10 border border-white/20 text-white font-bold text-sm hover:bg-white/20 transition">â¸ Pause</button>
    </div>
    <button onclick="toggleTimer()" class="mt-4 text-gray-500 text-xs hover:text-gray-300 transition">close</button>
  </div>
</div>

<!-- ============================================================ -->
<!--  ACHIEVEMENT TOAST                                           -->
<!-- ============================================================ -->
<div id="achievement-toast" class="fixed top-20 left-1/2 -translate-x-1/2 z-[80] hidden">
  <div class="glass-strong rounded-2xl px-6 py-4 flex items-center gap-4 animate-bounce-in border border-amber-500/30 shadow-[0_0_30px_rgba(251,191,36,0.2)]">
    <span id="achievement-icon" class="text-3xl">ğŸ†</span>
    <div>
      <p class="text-amber-400 font-bold text-sm" id="achievement-title">Achievement Unlocked!</p>
      <p class="text-gray-300 text-xs" id="achievement-desc">You did something awesome!</p>
    </div>
  </div>
</div>

<!-- ============================================================ -->
<!--  MAIN CONTENT                                                -->
<!-- ============================================================ -->
<main class="relative z-10 pt-20 pb-24 px-4 max-w-5xl mx-auto">

  <!-- â›ï¸ DWARF HERO BANNER -->
  <div class="glass-strong rounded-2xl p-5 sm:p-6 mb-6 mt-4 border border-amber-500/20 overflow-hidden relative">
    <div class="absolute top-0 right-0 w-64 h-64 bg-gradient-radial from-amber-500/10 to-transparent rounded-full blur-3xl -translate-y-1/2 translate-x-1/4 pointer-events-none"></div>
    <div class="relative">
      <div class="flex items-center gap-2 mb-3">
        <span class="text-2xl animate-lantern">ğŸ”ï¸</span>
        <h2 class="font-display font-bold text-lg sm:text-xl bg-gradient-to-r from-amber-300 via-yellow-200 to-amber-400 bg-clip-text text-transparent">The Mine Awaits, Scholar!</h2>
        <span class="text-2xl animate-gem-sparkle">ğŸ’</span>
      </div>
      <p class="text-gray-400 text-sm mb-4">Meet your study companions â€” the 7 Zwerge! Each dwarf guides a different part of your quest.</p>
      <div class="flex flex-wrap gap-3 sm:gap-4 justify-center sm:justify-start" id="dwarf-roster">
        <div class="flex flex-col items-center gap-1.5 group cursor-default" title="Bubi â€” The Innocent Hero">
          <div class="dwarf-avatar bg-red-500/80 text-white ring-2 ring-red-400/30 group-hover:ring-red-400/60">ğŸ˜Š</div>
          <span class="text-[10px] font-bold text-red-300">Bubi</span>
        </div>
        <div class="flex flex-col items-center gap-1.5 group cursor-default" title="Tschakko â€” The Tough Guy">
          <div class="dwarf-avatar bg-stone-600/80 text-white ring-2 ring-stone-400/30 group-hover:ring-stone-400/60">ğŸ›¡ï¸</div>
          <span class="text-[10px] font-bold text-stone-300">Tschakko</span>
        </div>
        <div class="flex flex-col items-center gap-1.5 group cursor-default" title="Sunny â€” The Wise One">
          <div class="dwarf-avatar bg-amber-400/80 text-white ring-2 ring-amber-300/30 group-hover:ring-amber-300/60">â˜€ï¸</div>
          <span class="text-[10px] font-bold text-amber-300">Sunny</span>
        </div>
        <div class="flex flex-col items-center gap-1.5 group cursor-default" title="Cloudy â€” The Dreamer">
          <div class="dwarf-avatar bg-sky-400/80 text-white ring-2 ring-sky-300/30 group-hover:ring-sky-300/60">â˜ï¸</div>
          <span class="text-[10px] font-bold text-sky-300">Cloudy</span>
        </div>
        <div class="flex flex-col items-center gap-1.5 group cursor-default" title="Cookie â€” The Cook">
          <div class="dwarf-avatar bg-orange-500/80 text-white ring-2 ring-orange-400/30 group-hover:ring-orange-400/60">ğŸª</div>
          <span class="text-[10px] font-bold text-orange-300">Cookie</span>
        </div>
        <div class="flex flex-col items-center gap-1.5 group cursor-default" title="Speedy â€” The Fast One">
          <div class="dwarf-avatar bg-yellow-300/80 text-gray-900 ring-2 ring-yellow-300/30 group-hover:ring-yellow-300/60">âš¡</div>
          <span class="text-[10px] font-bold text-yellow-300">Speedy</span>
        </div>
        <div class="flex flex-col items-center gap-1.5 group cursor-default" title="Ralfie â€” The Skeptic">
          <div class="dwarf-avatar bg-indigo-500/80 text-white ring-2 ring-indigo-400/30 group-hover:ring-indigo-400/60">ğŸ¤¨</div>
          <span class="text-[10px] font-bold text-indigo-300">Ralfie</span>
        </div>
      </div>
    </div>
  </div>

  <!-- MODE SELECTOR (dwarf-themed) -->
  <div class="flex flex-wrap justify-center gap-2 sm:gap-3 mb-8">
    <button onclick="switchMode('study')" id="mode-study" class="mode-btn px-4 sm:px-5 py-2.5 rounded-xl font-display font-bold text-sm transition-all flex items-center gap-2 bg-amber-500/20 border-2 border-amber-500 text-amber-300 shadow-[0_0_15px_rgba(245,158,11,0.2)]">
      ğŸ“– Study <span class="hidden sm:inline text-[10px] opacity-60">Sunny</span>
    </button>
    <button onclick="switchMode('flashcards')" id="mode-flashcards" class="mode-btn px-4 sm:px-5 py-2.5 rounded-xl font-display font-bold text-sm transition-all flex items-center gap-2 bg-white/5 border-2 border-white/10 text-gray-400 hover:border-white/30">
      ğŸƒ Flashcards <span class="hidden sm:inline text-[10px] opacity-60">Cloudy</span>
    </button>
    <button onclick="switchMode('quiz')" id="mode-quiz" class="mode-btn px-4 sm:px-5 py-2.5 rounded-xl font-display font-bold text-sm transition-all flex items-center gap-2 bg-white/5 border-2 border-white/10 text-gray-400 hover:border-white/30">
      âš¡ Quiz <span class="hidden sm:inline text-[10px] opacity-60">Speedy</span>
    </button>
    <button onclick="switchMode('matching')" id="mode-matching" class="mode-btn px-4 sm:px-5 py-2.5 rounded-xl font-display font-bold text-sm transition-all flex items-center gap-2 bg-white/5 border-2 border-white/10 text-gray-400 hover:border-white/30">
      ğŸ§© Match <span class="hidden sm:inline text-[10px] opacity-60">Bubi</span>
    </button>
    <button onclick="switchMode('essay')" id="mode-essay" class="mode-btn px-4 sm:px-5 py-2.5 rounded-xl font-display font-bold text-sm transition-all flex items-center gap-2 bg-white/5 border-2 border-white/10 text-gray-400 hover:border-white/30">
      âœï¸ Essay Prep <span class="hidden sm:inline text-[10px] opacity-60">Ralfie</span>
    </button>
    <button onclick="switchMode('notes')" id="mode-notes" class="mode-btn px-4 sm:px-5 py-2.5 rounded-xl font-display font-bold text-sm transition-all flex items-center gap-2 bg-white/5 border-2 border-white/10 text-gray-400 hover:border-white/30">
      ğŸ“‹ Notes <span class="hidden sm:inline text-[10px] opacity-60">Sunny</span>
    </button>
    <button onclick="switchMode('cheatsheet')" id="mode-cheatsheet" class="mode-btn px-4 sm:px-5 py-2.5 rounded-xl font-display font-bold text-sm transition-all flex items-center gap-2 bg-white/5 border-2 border-white/10 text-gray-400 hover:border-white/30">
      ğŸ“ Cheat Sheet <span class="hidden sm:inline text-[10px] opacity-60">PRINT ME</span>
    </button>
    <button onclick="switchMode('blastgames')" id="mode-blastgames" class="mode-btn px-4 sm:px-5 py-2.5 rounded-xl font-display font-bold text-sm transition-all flex items-center gap-2 bg-white/5 border-2 border-white/10 text-gray-400 hover:border-white/30">
      ğŸ® Blast Games <span class="hidden sm:inline text-[10px] opacity-60">FUN!</span>
    </button>
  </div>

  <!-- ======== STUDY MODE ======== -->
  <div id="view-study" class="view">
    
    <!-- Progress overview -->
    <div class="glass rounded-2xl p-5 sm:p-6 mb-4 flex flex-wrap items-center justify-between gap-4 border border-amber-500/10">
      <div class="flex items-center gap-3">
        <div class="dwarf-avatar dwarf-avatar-sm bg-amber-400/80 text-white">â˜€ï¸</div>
        <div>
          <h2 class="font-display font-bold text-lg sm:text-xl text-white flex items-center gap-2">â›ï¸ Mining Progress</h2>
          <p class="text-gray-400 text-sm mt-1">Sunny says: "Dig into each topic to earn gems!"</p>
        </div>
      </div>
      <div class="flex items-center gap-4">
        <div class="text-center">
          <div id="study-progress-pct" class="font-mono font-bold text-2xl text-amber-400">0%</div>
          <div class="text-[10px] text-gray-500 uppercase tracking-wider">Completed</div>
        </div>
        <div class="w-32 h-3 bg-gray-800 rounded-full overflow-hidden">
          <div id="study-progress-bar" class="h-full bg-gradient-to-r from-amber-500 to-orange-500 rounded-full transition-all duration-700" style="width:0%"></div>
        </div>
      </div>
    </div>

    <!-- ADHD: Quick tips bar -->
    <div class="glass rounded-xl p-4 mb-6 flex items-center gap-3 border border-amber-500/10">
      <span class="text-xl flex-shrink-0">ğŸ’¡</span>
      <p class="text-gray-400 text-sm"><span class="text-amber-300 font-semibold">ADHD Tip:</span> Tap a topic to expand it. When you collapse it, it marks as complete! Don't worry about reading everything â€” <span class="text-white font-medium">focus on bold keywords</span> and move on.</p>
    </div>

    <!-- SECTION 1: Dwarfs -->
    <div class="mb-8">
      <div class="flex items-center gap-3 mb-4">
        <div class="dwarf-avatar bg-stone-600/80 text-white animate-float">ğŸ›¡ï¸</div>
        <div>
          <h2 class="font-display font-bold text-xl sm:text-2xl bg-gradient-to-r from-amber-400 to-orange-400 bg-clip-text text-transparent">Part 1: Dwarfs in German Fairy Tales</h2>
          <p class="text-gray-400 text-xs font-mono">Tschakko guards this section â€¢ Stringham Article â€¢ 5 topics</p>
        </div>
      </div>

      <div class="grid gap-4" id="dwarfs-topics">

        <!-- Topic 1: Article Overview -->
        <div class="study-card glass rounded-2xl overflow-hidden transition-all hover:border-amber-500/30 group" data-topic="dwarfs-1">
          <button onclick="toggleTopic(this)" class="w-full p-5 flex items-start gap-4 text-left">
            <div class="flex-shrink-0 mt-0.5">
              <div class="w-7 h-7 rounded-lg bg-amber-500/20 border-2 border-amber-500/40 flex items-center justify-center text-amber-400 transition-all topic-check" data-checked="false">
                <span class="check-icon hidden text-sm font-bold">âœ“</span>
                <span class="uncheck-icon text-xs font-bold">1</span>
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="font-display font-bold text-white group-hover:text-amber-300 transition-colors">Article Overview</h3>
              <p class="text-gray-400 text-sm mt-1">Stringham examines dwarfs across German sagas, medieval epics &amp; Grimm.</p>
            </div>
            <span class="text-gray-600 text-xl transition-transform topic-arrow">â€º</span>
          </button>
          <div class="topic-content hidden px-5 pb-5">
            <div class="ml-11 space-y-3 border-l-2 border-amber-500/20 pl-4">
              <div class="bg-amber-500/5 rounded-xl p-4 border border-amber-500/10">
                <p class="text-gray-300 text-sm leading-relaxed"><strong class="text-amber-400">Author:</strong> EnikÃ¶ Stringham</p>
                <p class="text-gray-300 text-sm leading-relaxed mt-2">Examines dwarfs in German sagas, medieval epics, and fairy tales by the <strong class="text-amber-300">Brothers Grimm</strong>.</p>
                <p class="text-gray-300 text-sm leading-relaxed mt-2">Traces dwarf figures from <em class="text-amber-200">Rudlieb</em> and the <em class="text-amber-200">Nibelungenlied</em> through Grimm's <em class="text-amber-200">Kinder- und HausmÃ¤rchen</em>.</p>
              </div>
              <p class="text-amber-200/80 text-sm font-medium italic bg-amber-500/5 rounded-lg p-3 border-l-4 border-amber-500/40">ğŸ’¡ Dwarfs shift between <strong>helper, villain, prophet, servant, and demonic figure</strong> across these texts.</p>
            </div>
          </div>
        </div>

        <!-- Topic 2: Major Themes -->
        <div class="study-card glass rounded-2xl overflow-hidden transition-all hover:border-amber-500/30 group" data-topic="dwarfs-2">
          <button onclick="toggleTopic(this)" class="w-full p-5 flex items-start gap-4 text-left">
            <div class="flex-shrink-0 mt-0.5">
              <div class="w-7 h-7 rounded-lg bg-amber-500/20 border-2 border-amber-500/40 flex items-center justify-center text-amber-400 transition-all topic-check" data-checked="false">
                <span class="check-icon hidden text-sm font-bold">âœ“</span>
                <span class="uncheck-icon text-xs font-bold">2</span>
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="font-display font-bold text-white group-hover:text-amber-300 transition-colors">Major Themes &amp; Concepts</h3>
              <p class="text-gray-400 text-sm mt-1">7 key themes: earth, reciprocity, power, prophecy, moral ambiguityâ€¦</p>
            </div>
            <span class="text-gray-600 text-xl transition-transform topic-arrow">â€º</span>
          </button>
          <div class="topic-content hidden px-5 pb-5">
            <div class="ml-11 space-y-2 border-l-2 border-amber-500/20 pl-4">
              <div class="bg-amber-500/5 rounded-xl p-3 border border-amber-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">ğŸ“œ</span>
                <div><strong class="text-amber-300 text-sm">1. Historical Continuity</strong><p class="text-gray-400 text-xs mt-0.5">Dwarfs appear in early medieval texts like Rudlieb and the Nibelungenlied.</p></div>
              </div>
              <div class="bg-amber-500/5 rounded-xl p-3 border border-amber-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">â›°ï¸</span>
                <div><strong class="text-amber-300 text-sm">2. Association with the Earth</strong><p class="text-gray-400 text-xs mt-0.5">Linked to mountains, mining, treasure, and hidden underground spaces.</p></div>
              </div>
              <div class="bg-amber-500/5 rounded-xl p-3 border border-amber-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">ğŸ¤</span>
                <div><strong class="text-amber-300 text-sm">3. Reciprocity</strong><p class="text-gray-400 text-xs mt-0.5">Interactions involve exchange â€” treasure, protection, knowledge, or children.</p></div>
              </div>
              <div class="bg-amber-500/5 rounded-xl p-3 border border-amber-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">âš”ï¸</span>
                <div><strong class="text-amber-300 text-sm">4. Power &amp; Subjugation</strong><p class="text-gray-400 text-xs mt-0.5">In the Nibelungenlied, dwarfs may be subdued and forced into servitude.</p></div>
              </div>
              <div class="bg-amber-500/5 rounded-xl p-3 border border-amber-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">ğŸ”®</span>
                <div><strong class="text-amber-300 text-sm">5. Wisdom &amp; Prophecy</strong><p class="text-gray-400 text-xs mt-0.5">Dwarfs sometimes possess future-telling abilities and hidden knowledge.</p></div>
              </div>
              <div class="bg-amber-500/5 rounded-xl p-3 border border-amber-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">ğŸ­</span>
                <div><strong class="text-amber-300 text-sm">6. Moral Ambiguity</strong><p class="text-gray-400 text-xs mt-0.5">Dwarfs are not purely good or evil; roles shift across narratives.</p></div>
              </div>
              <div class="bg-amber-500/5 rounded-xl p-3 border border-amber-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">ğŸ“</span>
                <div><strong class="text-amber-300 text-sm">7. Grimm Revisions</strong><p class="text-gray-400 text-xs mt-0.5">Brothers Grimm shaped portrayals through scholarship and Romantic nationalism.</p></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Topic 3: Gilmour's 5 Categories -->
        <div class="study-card glass rounded-2xl overflow-hidden transition-all hover:border-amber-500/30 group" data-topic="dwarfs-3">
          <button onclick="toggleTopic(this)" class="w-full p-5 flex items-start gap-4 text-left">
            <div class="flex-shrink-0 mt-0.5">
              <div class="w-7 h-7 rounded-lg bg-amber-500/20 border-2 border-amber-500/40 flex items-center justify-center text-amber-400 transition-all topic-check" data-checked="false">
                <span class="check-icon hidden text-sm font-bold">âœ“</span>
                <span class="uncheck-icon text-xs font-bold">3</span>
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="font-display font-bold text-white group-hover:text-amber-300 transition-colors">Gilmour's 5 Categories of Dwarfs</h3>
              <p class="text-gray-400 text-sm mt-1">Unexpected Helper â†’ Demonic Dwarf â€” know all five.</p>
            </div>
            <span class="text-gray-600 text-xl transition-transform topic-arrow">â€º</span>
          </button>
          <div class="topic-content hidden px-5 pb-5">
            <div class="ml-11 space-y-2 border-l-2 border-amber-500/20 pl-4">
              <div class="bg-green-500/5 rounded-xl p-3 border border-green-500/10 flex gap-3 items-start">
                <span class="text-2xl flex-shrink-0">ğŸ¤²</span>
                <div><strong class="text-green-300 text-sm">1. The Unexpected Helper</strong><p class="text-gray-400 text-xs mt-0.5">Assists without asking for anything in return.</p><p class="text-gray-500 text-xs italic">e.g., The Elves and the Shoemaker, Snow White</p></div>
              </div>
              <div class="bg-blue-500/5 rounded-xl p-3 border border-blue-500/10 flex gap-3 items-start">
                <span class="text-2xl flex-shrink-0">ğŸ«¡</span>
                <div><strong class="text-blue-300 text-sm">2. The Obedient Dwarf</strong><p class="text-gray-400 text-xs mt-0.5">Controlled by a human through magic.</p><p class="text-gray-500 text-xs italic">e.g., Das Blaue Licht</p></div>
              </div>
              <div class="bg-yellow-500/5 rounded-xl p-3 border border-yellow-500/10 flex gap-3 items-start">
                <span class="text-2xl flex-shrink-0">ğŸ</span>
                <div><strong class="text-yellow-300 text-sm">3. The Volunteer Giver</strong><p class="text-gray-400 text-xs mt-0.5">Offers help but expects equal value in return.</p></div>
              </div>
              <div class="bg-red-500/5 rounded-xl p-3 border border-red-500/10 flex gap-3 items-start">
                <span class="text-2xl flex-shrink-0">ğŸ˜ˆ</span>
                <div><strong class="text-red-300 text-sm">4. The Demonic Dwarf</strong><p class="text-gray-400 text-xs mt-0.5">Abductor or manipulator.</p><p class="text-gray-500 text-xs italic">e.g., Rumpelstiltskin</p></div>
              </div>
              <div class="bg-purple-500/5 rounded-xl p-3 border border-purple-500/10 flex gap-3 items-start">
                <span class="text-2xl flex-shrink-0">ğŸ’€</span>
                <div><strong class="text-purple-300 text-sm">5. The Ungrateful/Evil Dwarf</strong><p class="text-gray-400 text-xs mt-0.5">Associated with greed and the Devil.</p><p class="text-gray-500 text-xs italic">e.g., Schneewittchen und Rosenrot</p></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Topic 4: Important Texts -->
        <div class="study-card glass rounded-2xl overflow-hidden transition-all hover:border-amber-500/30 group" data-topic="dwarfs-4">
          <button onclick="toggleTopic(this)" class="w-full p-5 flex items-start gap-4 text-left">
            <div class="flex-shrink-0 mt-0.5">
              <div class="w-7 h-7 rounded-lg bg-amber-500/20 border-2 border-amber-500/40 flex items-center justify-center text-amber-400 transition-all topic-check" data-checked="false">
                <span class="check-icon hidden text-sm font-bold">âœ“</span>
                <span class="uncheck-icon text-xs font-bold">4</span>
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="font-display font-bold text-white group-hover:text-amber-300 transition-colors">Important Texts</h3>
              <p class="text-gray-400 text-sm mt-1">Know 6 key texts and what each represents.</p>
            </div>
            <span class="text-gray-600 text-xl transition-transform topic-arrow">â€º</span>
          </button>
          <div class="topic-content hidden px-5 pb-5">
            <div class="ml-11 space-y-2 border-l-2 border-amber-500/20 pl-4">
              <div class="bg-amber-500/5 rounded-lg p-3 border border-amber-500/10"><strong class="text-amber-300 text-sm">Rudlieb</strong><span class="text-gray-400 text-sm"> â€” Early German dwarf story involving treasure and mistrust.</span></div>
              <div class="bg-amber-500/5 rounded-lg p-3 border border-amber-500/10"><strong class="text-amber-300 text-sm">Nibelungenlied</strong><span class="text-gray-400 text-sm"> â€” Dwarfs tied to treasure, invisibility, and subjugation.</span></div>
              <div class="bg-amber-500/5 rounded-lg p-3 border border-amber-500/10"><strong class="text-amber-300 text-sm">Snow White</strong><span class="text-gray-400 text-sm"> â€” Dwarfs as miners, protectors, guardians of domestic stability.</span></div>
              <div class="bg-amber-500/5 rounded-lg p-3 border border-amber-500/10"><strong class="text-amber-300 text-sm">The Elves and the Shoemaker</strong><span class="text-gray-400 text-sm"> â€” Helpful dwarfs assisting secretly.</span></div>
              <div class="bg-amber-500/5 rounded-lg p-3 border border-amber-500/10"><strong class="text-amber-300 text-sm">Das Blaue Licht</strong><span class="text-gray-400 text-sm"> â€” Dwarf under magical control.</span></div>
              <div class="bg-amber-500/5 rounded-lg p-3 border border-amber-500/10"><strong class="text-amber-300 text-sm">Rumpelstiltskin</strong><span class="text-gray-400 text-sm"> â€” Demonic dwarf demanding a child in exchange for help.</span></div>
            </div>
          </div>
        </div>

        <!-- Topic 5: Key Points -->
        <div class="study-card glass rounded-2xl overflow-hidden transition-all hover:border-amber-500/30 group" data-topic="dwarfs-5">
          <button onclick="toggleTopic(this)" class="w-full p-5 flex items-start gap-4 text-left">
            <div class="flex-shrink-0 mt-0.5">
              <div class="w-7 h-7 rounded-lg bg-amber-500/20 border-2 border-amber-500/40 flex items-center justify-center text-amber-400 transition-all topic-check" data-checked="false">
                <span class="check-icon hidden text-sm font-bold">âœ“</span>
                <span class="uncheck-icon text-xs font-bold">5</span>
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="font-display font-bold text-white group-hover:text-amber-300 transition-colors">Key Points to Remember â­</h3>
              <p class="text-gray-400 text-sm mt-1">The 6 must-know facts for the quiz.</p>
            </div>
            <span class="text-gray-600 text-xl transition-transform topic-arrow">â€º</span>
          </button>
          <div class="topic-content hidden px-5 pb-5">
            <div class="ml-11 space-y-2 border-l-2 border-amber-500/20 pl-4">
              <div class="bg-gradient-to-r from-amber-500/10 to-transparent rounded-lg p-3 border-l-4 border-amber-400 flex gap-2"><span>âœ…</span><span class="text-gray-300 text-sm">Dwarfs originate in <strong class="text-white">Germanic myth and medieval literature</strong> before Grimm tales.</span></div>
              <div class="bg-gradient-to-r from-amber-500/10 to-transparent rounded-lg p-3 border-l-4 border-amber-400 flex gap-2"><span>âœ…</span><span class="text-gray-300 text-sm">Frequently associated with <strong class="text-white">mountains, treasure, mining, hidden knowledge</strong>.</span></div>
              <div class="bg-gradient-to-r from-amber-500/10 to-transparent rounded-lg p-3 border-l-4 border-amber-400 flex gap-2"><span>âœ…</span><span class="text-gray-300 text-sm"><strong class="text-white">Reciprocity and exchange</strong> are central to dwarf-human interactions.</span></div>
              <div class="bg-gradient-to-r from-amber-500/10 to-transparent rounded-lg p-3 border-l-4 border-amber-400 flex gap-2"><span>âœ…</span><span class="text-gray-300 text-sm">Dwarfs shift roles: <strong class="text-white">helper, servant, prophet, villain, demonic figure</strong>.</span></div>
              <div class="bg-gradient-to-r from-amber-500/10 to-transparent rounded-lg p-3 border-l-4 border-amber-400 flex gap-2"><span>âœ…</span><span class="text-gray-300 text-sm"><strong class="text-white">Grimms' scholarly revisions</strong> influenced modern understanding.</span></div>
              <div class="bg-gradient-to-r from-amber-500/10 to-transparent rounded-lg p-3 border-l-4 border-amber-400 flex gap-2"><span>âœ…</span><span class="text-gray-300 text-sm"><strong class="text-white">Mystery and limited knowledge</strong> = enduring enchantment of dwarfs.</span></div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- SECTION 2: Culture, Fairy Tales, and 7 Zwerge -->
    <div class="mb-8">
      <div class="flex items-center gap-3 mb-4">
        <div class="dwarf-avatar bg-orange-500/80 text-white animate-float" style="animation-delay:0.5s">ï¿½</div>
        <div>
          <h2 class="font-display font-bold text-xl sm:text-2xl bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">Part 2: Culture, Fairy Tales &amp; 7 Zwerge</h2>
          <p class="text-gray-400 text-xs font-mono">Cookie serves up knowledge â€¢ Scholarly Article + Film Analysis â€¢ 5 topics</p>
        </div>
      </div>

      <div class="grid gap-4" id="culture-topics">

        <!-- Topic 6: Core Argument -->
        <div class="study-card glass rounded-2xl overflow-hidden transition-all hover:border-purple-500/30 group" data-topic="culture-1">
          <button onclick="toggleTopic(this)" class="w-full p-5 flex items-start gap-4 text-left">
            <div class="flex-shrink-0 mt-0.5">
              <div class="w-7 h-7 rounded-lg bg-purple-500/20 border-2 border-purple-500/40 flex items-center justify-center text-purple-400 transition-all topic-check" data-checked="false">
                <span class="check-icon hidden text-sm font-bold">âœ“</span>
                <span class="uncheck-icon text-xs font-bold">6</span>
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="font-display font-bold text-white group-hover:text-purple-300 transition-colors">Core Argument of the Scholarly Article</h3>
              <p class="text-gray-400 text-sm mt-1">Culture shapes how readers interpret stories â€” reading is NOT neutral.</p>
            </div>
            <span class="text-gray-600 text-xl transition-transform topic-arrow">â€º</span>
          </button>
          <div class="topic-content hidden px-5 pb-5">
            <div class="ml-11 space-y-3 border-l-2 border-purple-500/20 pl-4">
              <div class="bg-purple-500/5 rounded-xl p-4 border border-purple-500/10">
                <p class="text-gray-300 text-sm leading-relaxed"><strong class="text-purple-300">Culture shapes how readers interpret stories.</strong> Reading is not neutral.</p>
                <p class="text-gray-300 text-sm leading-relaxed mt-2">Readers rely on <strong class="text-purple-300">culturally embedded schemata</strong> (mental frameworks from socialization) to construct meaning.</p>
                <p class="text-gray-300 text-sm leading-relaxed mt-2">Schemata influence: <strong class="text-purple-300">character evaluation</strong>, <strong class="text-purple-300">plot interpretation</strong>, and <strong class="text-purple-300">inference-making</strong>.</p>
              </div>
              <p class="text-purple-200/80 text-sm font-medium italic bg-purple-500/5 rounded-lg p-3 border-l-4 border-purple-500/40">ğŸ’¡ Interpretation differences across cultures are <strong>patterned and measurable</strong>.</p>
            </div>
          </div>
        </div>

        <!-- Topic 7: Key Concepts -->
        <div class="study-card glass rounded-2xl overflow-hidden transition-all hover:border-purple-500/30 group" data-topic="culture-2">
          <button onclick="toggleTopic(this)" class="w-full p-5 flex items-start gap-4 text-left">
            <div class="flex-shrink-0 mt-0.5">
              <div class="w-7 h-7 rounded-lg bg-purple-500/20 border-2 border-purple-500/40 flex items-center justify-center text-purple-400 transition-all topic-check" data-checked="false">
                <span class="check-icon hidden text-sm font-bold">âœ“</span>
                <span class="uncheck-icon text-xs font-bold">7</span>
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="font-display font-bold text-white group-hover:text-purple-300 transition-colors">Key Concepts (6 Terms)</h3>
              <p class="text-gray-400 text-sm mt-1">Schema Theory, Top-Down Processing, Situation Modelâ€¦</p>
            </div>
            <span class="text-gray-600 text-xl transition-transform topic-arrow">â€º</span>
          </button>
          <div class="topic-content hidden px-5 pb-5">
            <div class="ml-11 space-y-2 border-l-2 border-purple-500/20 pl-4">
              <div class="bg-purple-500/5 rounded-xl p-3 border border-purple-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">ğŸ§ </span>
                <div><strong class="text-purple-300 text-sm">Schema Theory</strong><p class="text-gray-400 text-xs mt-0.5">Cultural knowledge organized into mental frameworks guiding interpretation.</p></div>
              </div>
              <div class="bg-purple-500/5 rounded-xl p-3 border border-purple-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">â¬‡ï¸</span>
                <div><strong class="text-purple-300 text-sm">Top-Down Processing</strong><p class="text-gray-400 text-xs mt-0.5">Using prior knowledge and expectations to interpret a text.</p></div>
              </div>
              <div class="bg-purple-500/5 rounded-xl p-3 border border-purple-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">ğŸ—ºï¸</span>
                <div><strong class="text-purple-300 text-sm">Situation Model</strong><p class="text-gray-400 text-xs mt-0.5">Mental representation of characters, events, time, and space built during reading.</p></div>
              </div>
              <div class="bg-purple-500/5 rounded-xl p-3 border border-purple-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">ğŸ”</span>
                <div><strong class="text-purple-300 text-sm">Inference-Making</strong><p class="text-gray-400 text-xs mt-0.5">Filling narrative gaps using reasoning and prior knowledge.</p></div>
              </div>
              <div class="bg-purple-500/5 rounded-xl p-3 border border-purple-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">ğŸŒ</span>
                <div><strong class="text-purple-300 text-sm">Individualism vs. Collectivism</strong><p class="text-gray-400 text-xs mt-0.5">Cultural value systems shaping character evaluation.</p></div>
              </div>
              <div class="bg-purple-500/5 rounded-xl p-3 border border-purple-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">ğŸ“Š</span>
                <div><strong class="text-purple-300 text-sm">Cultural Variable</strong><p class="text-gray-400 text-xs mt-0.5">Literary studies must include culture as a factor.</p></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Topic 8: Hypotheses -->
        <div class="study-card glass rounded-2xl overflow-hidden transition-all hover:border-purple-500/30 group" data-topic="culture-3">
          <button onclick="toggleTopic(this)" class="w-full p-5 flex items-start gap-4 text-left">
            <div class="flex-shrink-0 mt-0.5">
              <div class="w-7 h-7 rounded-lg bg-purple-500/20 border-2 border-purple-500/40 flex items-center justify-center text-purple-400 transition-all topic-check" data-checked="false">
                <span class="check-icon hidden text-sm font-bold">âœ“</span>
                <span class="uncheck-icon text-xs font-bold">8</span>
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="font-display font-bold text-white group-hover:text-purple-300 transition-colors">Hypotheses &amp; Findings</h3>
              <p class="text-gray-400 text-sm mt-1">What the researchers predicted vs. what the data showed.</p>
            </div>
            <span class="text-gray-600 text-xl transition-transform topic-arrow">â€º</span>
          </button>
          <div class="topic-content hidden px-5 pb-5">
            <div class="ml-11 space-y-3 border-l-2 border-purple-500/20 pl-4">
              <div class="bg-blue-500/5 rounded-xl p-4 border border-blue-500/10">
                <p class="text-blue-300 text-sm font-bold mb-1">Hypothesis 1</p>
                <p class="text-gray-400 text-sm">Western readers â†’ <strong class="text-white">individualistic</strong> interpretations<br>East Asian readers â†’ <strong class="text-white">socially oriented</strong> interpretations</p>
              </div>
              <div class="bg-pink-500/5 rounded-xl p-4 border border-pink-500/10">
                <p class="text-pink-300 text-sm font-bold mb-1">Hypothesis 2</p>
                <p class="text-gray-400 text-sm">Differences in plot preference: <strong class="text-white">adventurous vs. restrained</strong> development.</p>
              </div>
              <div class="bg-green-500/5 rounded-xl p-4 border border-green-500/10">
                <p class="text-green-300 text-sm font-bold mb-1">ğŸ“Š Results</p>
                <p class="text-gray-400 text-sm"><strong class="text-white">Statistically significant differences</strong> in inference-making â†’ <strong class="text-green-300">culture influences deep cognitive processes</strong> in reading.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Topic 9: Grimm vs 7 Zwerge -->
        <div class="study-card glass rounded-2xl overflow-hidden transition-all hover:border-purple-500/30 group" data-topic="culture-4">
          <button onclick="toggleTopic(this)" class="w-full p-5 flex items-start gap-4 text-left">
            <div class="flex-shrink-0 mt-0.5">
              <div class="w-7 h-7 rounded-lg bg-purple-500/20 border-2 border-purple-500/40 flex items-center justify-center text-purple-400 transition-all topic-check" data-checked="false">
                <span class="check-icon hidden text-sm font-bold">âœ“</span>
                <span class="uncheck-icon text-xs font-bold">9</span>
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="font-display font-bold text-white group-hover:text-purple-300 transition-colors">Grimm's Snow White vs. 7 Zwerge</h3>
              <p class="text-gray-400 text-sm mt-1">Traditional fairy tale vs. parody and adaptation.</p>
            </div>
            <span class="text-gray-600 text-xl transition-transform topic-arrow">â€º</span>
          </button>
          <div class="topic-content hidden px-5 pb-5">
            <div class="ml-11 border-l-2 border-purple-500/20 pl-4">
              <div class="grid sm:grid-cols-2 gap-3">
                <div class="bg-amber-500/5 rounded-xl p-4 border border-amber-500/10">
                  <h4 class="text-amber-300 font-bold text-sm mb-2 flex items-center gap-2">ğŸ“• Grimm's Snow White</h4>
                  <ul class="space-y-1.5 text-gray-400 text-xs">
                    <li class="flex gap-2"><span class="text-amber-400">â€¢</span> Moral clarity</li>
                    <li class="flex gap-2"><span class="text-amber-400">â€¢</span> Traditional gender roles</li>
                    <li class="flex gap-2"><span class="text-amber-400">â€¢</span> Punishment &amp; reward structures</li>
                    <li class="flex gap-2"><span class="text-amber-400">â€¢</span> Structured fairy tale logic</li>
                    <li class="flex gap-2"><span class="text-amber-400">â€¢</span> Heroism &amp; virtue clearly defined</li>
                  </ul>
                </div>
                <div class="bg-pink-500/5 rounded-xl p-4 border border-pink-500/10">
                  <h4 class="text-pink-300 font-bold text-sm mb-2 flex items-center gap-2">ğŸ¬ 7 Zwerge (2004)</h4>
                  <ul class="space-y-1.5 text-gray-400 text-xs">
                    <li class="flex gap-2"><span class="text-pink-400">â€¢</span> Parody of Snow White</li>
                    <li class="flex gap-2"><span class="text-pink-400">â€¢</span> Insecure, socially awkward dwarfs</li>
                    <li class="flex gap-2"><span class="text-pink-400">â€¢</span> Exaggerates conventions</li>
                    <li class="flex gap-2"><span class="text-pink-400">â€¢</span> Destabilizes masculinity/heroism</li>
                    <li class="flex gap-2"><span class="text-pink-400">â€¢</span> Heroism = collective &amp; flawed</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Topic 10: Comparative Themes -->
        <div class="study-card glass rounded-2xl overflow-hidden transition-all hover:border-purple-500/30 group" data-topic="culture-5">
          <button onclick="toggleTopic(this)" class="w-full p-5 flex items-start gap-4 text-left">
            <div class="flex-shrink-0 mt-0.5">
              <div class="w-7 h-7 rounded-lg bg-purple-500/20 border-2 border-purple-500/40 flex items-center justify-center text-purple-400 transition-all topic-check" data-checked="false">
                <span class="check-icon hidden text-sm font-bold">âœ“</span>
                <span class="uncheck-icon text-xs font-bold">10</span>
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="font-display font-bold text-white group-hover:text-purple-300 transition-colors">Comparative Themes â­</h3>
              <p class="text-gray-400 text-sm mt-1">Big-picture connections across all material.</p>
            </div>
            <span class="text-gray-600 text-xl transition-transform topic-arrow">â€º</span>
          </button>
          <div class="topic-content hidden px-5 pb-5">
            <div class="ml-11 space-y-2 border-l-2 border-purple-500/20 pl-4">
              <div class="bg-gradient-to-r from-purple-500/10 to-transparent rounded-lg p-3 border-l-4 border-purple-400 flex gap-2"><span>ğŸ”„</span><span class="text-gray-300 text-sm">Grimm = <strong class="text-white">stable moral structures</strong>; 7 Zwerge = <strong class="text-white">destabilizes through satire</strong>.</span></div>
              <div class="bg-gradient-to-r from-purple-500/10 to-transparent rounded-lg p-3 border-l-4 border-purple-400 flex gap-2"><span>ğŸ“</span><span class="text-gray-300 text-sm">Interpretation differences are <strong class="text-white">culturally structured</strong>.</span></div>
              <div class="bg-gradient-to-r from-purple-500/10 to-transparent rounded-lg p-3 border-l-4 border-purple-400 flex gap-2"><span>ğŸ¦¸</span><span class="text-gray-300 text-sm">Heroism: <strong class="text-white">individual moral clarity</strong> (Grimm) â†’ <strong class="text-white">comedic group dynamics</strong> (7 Zwerge).</span></div>
              <div class="bg-gradient-to-r from-purple-500/10 to-transparent rounded-lg p-3 border-l-4 border-purple-400 flex gap-2"><span>ğŸ§ </span><span class="text-gray-300 text-sm"><strong class="text-white">Cultural schemata</strong> influence how parody is interpreted.</span></div>
              <div class="bg-gradient-to-r from-purple-500/10 to-transparent rounded-lg p-3 border-l-4 border-purple-400 flex gap-2"><span>ğŸ“–</span><span class="text-gray-300 text-sm">Fairy tales are <strong class="text-white">adaptable narratives</strong> shaped by historical &amp; cultural context.</span></div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- SECTION 3: Lecture Notes â€” Humor, Culture & Fairy Tales -->
    <div class="mb-8">
      <div class="flex items-center gap-3 mb-4">
        <div class="dwarf-avatar bg-yellow-300/80 text-gray-900 animate-float" style="animation-delay:1s">âš¡</div>
        <div>
          <h2 class="font-display font-bold text-xl sm:text-2xl bg-gradient-to-r from-green-400 to-teal-400 bg-clip-text text-transparent">Part 3: Lecture Notes â€” Humor, Culture &amp; Fairy Tales</h2>
          <p class="text-gray-400 text-xs font-mono">Speedy races through the key lecture points â€¢ Module 6 Notes â€¢ 5 topics</p>
        </div>
      </div>

      <div class="grid gap-4" id="lecture-topics">

        <!-- Topic 11: Humor, Language & Culture -->
        <div class="study-card glass rounded-2xl overflow-hidden transition-all hover:border-green-500/30 group" data-topic="lecture-1">
          <button onclick="toggleTopic(this)" class="w-full p-5 flex items-start gap-4 text-left">
            <div class="flex-shrink-0 mt-0.5">
              <div class="w-7 h-7 rounded-lg bg-green-500/20 border-2 border-green-500/40 flex items-center justify-center text-green-400 transition-all topic-check" data-checked="false">
                <span class="check-icon hidden text-sm font-bold">âœ“</span>
                <span class="uncheck-icon text-xs font-bold">11</span>
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="font-display font-bold text-white group-hover:text-green-300 transition-colors">Humor, Language &amp; Culture</h3>
              <p class="text-gray-400 text-sm mt-1">The three interconnected aspects: language, culture, and humor.</p>
            </div>
            <span class="text-gray-600 text-xl transition-transform topic-arrow">â€º</span>
          </button>
          <div class="topic-content hidden px-5 pb-5">
            <div class="ml-11 space-y-3 border-l-2 border-green-500/20 pl-4">
              <div class="bg-green-500/5 rounded-xl p-4 border border-green-500/10">
                <p class="text-gray-300 text-sm leading-relaxed"><strong class="text-green-400">Three interconnected aspects:</strong> Language, Culture, and Humor.</p>
                <p class="text-gray-300 text-sm leading-relaxed mt-2">These are deeply intertwined â€” <strong class="text-green-300">humor is culturally specific</strong> and depends on shared linguistic and cultural knowledge to be understood.</p>
                <p class="text-gray-300 text-sm leading-relaxed mt-2">Key question: <em class="text-green-200">How do we see humor as something that is represented in Fairy Tales?</em></p>
              </div>
              <p class="text-green-200/80 text-sm font-medium italic bg-green-500/5 rounded-lg p-3 border-l-4 border-green-500/40">ğŸ’¡ Not often do we see humor in traditional fairy tales, but there is still a <strong>close connection</strong> between humor and fairy tale culture.</p>
            </div>
          </div>
        </div>

        <!-- Topic 12: Fairy Tales & Cultural Impact -->
        <div class="study-card glass rounded-2xl overflow-hidden transition-all hover:border-green-500/30 group" data-topic="lecture-2">
          <button onclick="toggleTopic(this)" class="w-full p-5 flex items-start gap-4 text-left">
            <div class="flex-shrink-0 mt-0.5">
              <div class="w-7 h-7 rounded-lg bg-green-500/20 border-2 border-green-500/40 flex items-center justify-center text-green-400 transition-all topic-check" data-checked="false">
                <span class="check-icon hidden text-sm font-bold">âœ“</span>
                <span class="uncheck-icon text-xs font-bold">12</span>
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="font-display font-bold text-white group-hover:text-green-300 transition-colors">Fairy Tales &amp; Cultural Impact</h3>
              <p class="text-gray-400 text-sm mt-1">How fairy tales shape societal expectations and preserve cultural values.</p>
            </div>
            <span class="text-gray-600 text-xl transition-transform topic-arrow">â€º</span>
          </button>
          <div class="topic-content hidden px-5 pb-5">
            <div class="ml-11 space-y-3 border-l-2 border-green-500/20 pl-4">
              <div class="bg-green-500/5 rounded-xl p-4 border border-green-500/10">
                <p class="text-gray-300 text-sm leading-relaxed">Fairy tales have a <strong class="text-green-300">very profound cultural impact</strong>, shaping societal expectations.</p>
                <p class="text-gray-300 text-sm leading-relaxed mt-2">They have <strong class="text-green-300">evolved over time</strong> to reflect changing cultural values and mediums of storytelling.</p>
                <p class="text-gray-300 text-sm leading-relaxed mt-2">Traditional fairy tales have had a huge impact on <strong class="text-green-300">constructing national identity</strong> and preserving cultural values.</p>
              </div>
              <div class="bg-green-500/5 rounded-xl p-3 border border-green-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">ğŸ”„</span>
                <div><strong class="text-green-300 text-sm">Adaptations &amp; Intertextuality</strong><p class="text-gray-400 text-xs mt-0.5">Fairy tales constantly change â€” each retelling reflects the culture that produces it.</p></div>
              </div>
              <div class="bg-green-500/5 rounded-xl p-3 border border-green-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">ğŸ“</span>
                <div><strong class="text-green-300 text-sm">Societal Expectations</strong><p class="text-gray-400 text-xs mt-0.5">Fairy tales encode what a culture considers normal, moral, and desirable.</p></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Topic 13: Grimm & German Nationalism -->
        <div class="study-card glass rounded-2xl overflow-hidden transition-all hover:border-green-500/30 group" data-topic="lecture-3">
          <button onclick="toggleTopic(this)" class="w-full p-5 flex items-start gap-4 text-left">
            <div class="flex-shrink-0 mt-0.5">
              <div class="w-7 h-7 rounded-lg bg-green-500/20 border-2 border-green-500/40 flex items-center justify-center text-green-400 transition-all topic-check" data-checked="false">
                <span class="check-icon hidden text-sm font-bold">âœ“</span>
                <span class="uncheck-icon text-xs font-bold">13</span>
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="font-display font-bold text-white group-hover:text-green-300 transition-colors">Grimm's Fairy Tales &amp; German Nationalism</h3>
              <p class="text-gray-400 text-sm mt-1">Origins in oral tradition, poverty, and cultural preservation.</p>
            </div>
            <span class="text-gray-600 text-xl transition-transform topic-arrow">â€º</span>
          </button>
          <div class="topic-content hidden px-5 pb-5">
            <div class="ml-11 space-y-3 border-l-2 border-green-500/20 pl-4">
              <div class="bg-green-500/5 rounded-xl p-4 border border-green-500/10">
                <p class="text-gray-300 text-sm leading-relaxed">Grimm's fairy tales in Germany were associated with the rise of <strong class="text-green-300">German nationalism</strong> and used as a means of <strong class="text-green-300">cultural preservation</strong>.</p>
                <p class="text-gray-300 text-sm leading-relaxed mt-2">They reflect the <strong class="text-green-300">cultural history and experience of the German people</strong>. Many stories deal with themes of <strong class="text-white">poverty, hardship, and the struggle for survival</strong>.</p>
              </div>
              <div class="bg-green-500/5 rounded-xl p-3 border border-green-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">ğŸ—£ï¸</span>
                <div><strong class="text-green-300 text-sm">Oral Origins</strong><p class="text-gray-400 text-xs mt-0.5">Originally told orally by <strong class="text-white">laborer women who worked in kitchens</strong> â€” not wealthy women. They came from a background of hunger and poverty.</p></div>
              </div>
              <div class="bg-green-500/5 rounded-xl p-3 border border-green-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">âš ï¸</span>
                <div><strong class="text-green-300 text-sm">Not Originally for Children</strong><p class="text-gray-400 text-xs mt-0.5">The dark and sometimes violent nature of fairy tales stems from the fact that they were <strong class="text-white">not originally intended for children</strong> but reflected the harsher realities of life.</p></div>
              </div>
              <p class="text-green-200/80 text-sm font-medium italic bg-green-500/5 rounded-lg p-3 border-l-4 border-green-500/40">ğŸ’¡ Themes of poverty, hunger, and survival were <strong>relevant for the time period</strong> when these stories were first told.</p>
            </div>
          </div>
        </div>

        <!-- Topic 14: 7 Zwerge Film & German Comedy -->
        <div class="study-card glass rounded-2xl overflow-hidden transition-all hover:border-green-500/30 group" data-topic="lecture-4">
          <button onclick="toggleTopic(this)" class="w-full p-5 flex items-start gap-4 text-left">
            <div class="flex-shrink-0 mt-0.5">
              <div class="w-7 h-7 rounded-lg bg-green-500/20 border-2 border-green-500/40 flex items-center justify-center text-green-400 transition-all topic-check" data-checked="false">
                <span class="check-icon hidden text-sm font-bold">âœ“</span>
                <span class="uncheck-icon text-xs font-bold">14</span>
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="font-display font-bold text-white group-hover:text-green-300 transition-colors">7 Zwerge Film &amp; German Comedy</h3>
              <p class="text-gray-400 text-sm mt-1">The 7 most famous German comedians, humor translation, and massive German success.</p>
            </div>
            <span class="text-gray-600 text-xl transition-transform topic-arrow">â€º</span>
          </button>
          <div class="topic-content hidden px-5 pb-5">
            <div class="ml-11 space-y-3 border-l-2 border-green-500/20 pl-4">
              <div class="bg-green-500/5 rounded-xl p-4 border border-green-500/10">
                <p class="text-gray-300 text-sm leading-relaxed">The film features the <strong class="text-green-300">7 most famous German comedians</strong>, each representing a dwarf character through humor.</p>
                <p class="text-gray-300 text-sm leading-relaxed mt-2">The movie was <strong class="text-green-300">extremely successful in Germany</strong>.</p>
              </div>
              <div class="bg-green-500/5 rounded-xl p-3 border border-green-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">ğŸ­</span>
                <div><strong class="text-green-300 text-sm">Representing Characters Through Humor</strong><p class="text-gray-400 text-xs mt-0.5">Each dwarf's personality was crafted to match the comedian's comedic style.</p></div>
              </div>
              <div class="bg-green-500/5 rounded-xl p-3 border border-green-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">ğŸŒ</span>
                <div><strong class="text-green-300 text-sm">Cultural Translatability of Humor</strong><p class="text-gray-400 text-xs mt-0.5">Key question: <em class="text-green-200">Could you translate the humor in this movie to other cultures?</em> Humor is deeply culture-specific.</p></div>
              </div>
              <div class="bg-green-500/5 rounded-xl p-3 border border-green-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">ğŸ‡©ğŸ‡ª</span>
                <div><strong class="text-green-300 text-sm">German Box-Office Hit</strong><p class="text-gray-400 text-xs mt-0.5">Its enormous success reflects how German audiences connect fairy tales with national comedic culture.</p></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Topic 15: FSK, Frog Prince & Eurodisney -->
        <div class="study-card glass rounded-2xl overflow-hidden transition-all hover:border-green-500/30 group" data-topic="lecture-5">
          <button onclick="toggleTopic(this)" class="w-full p-5 flex items-start gap-4 text-left">
            <div class="flex-shrink-0 mt-0.5">
              <div class="w-7 h-7 rounded-lg bg-green-500/20 border-2 border-green-500/40 flex items-center justify-center text-green-400 transition-all topic-check" data-checked="false">
                <span class="check-icon hidden text-sm font-bold">âœ“</span>
                <span class="uncheck-icon text-xs font-bold">15</span>
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="font-display font-bold text-white group-hover:text-green-300 transition-colors">FSK Ratings, Frog Prince &amp; Eurodisney</h3>
              <p class="text-gray-400 text-sm mt-1">Movie ratings, der FroschkÃ¶nig, and Disney's fairy tale influence.</p>
            </div>
            <span class="text-gray-600 text-xl transition-transform topic-arrow">â€º</span>
          </button>
          <div class="topic-content hidden px-5 pb-5">
            <div class="ml-11 space-y-3 border-l-2 border-green-500/20 pl-4">
              <div class="bg-green-500/5 rounded-xl p-3 border border-green-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">ğŸ¬</span>
                <div><strong class="text-green-300 text-sm">FSK (Freiwillige Selbstkontrolle)</strong><p class="text-gray-400 text-xs mt-0.5">The German movie rating system â€” <strong class="text-white">Freiwillige Selbstkontrolle der Filmwirtschaft</strong> = Voluntary Self-Regulation of the Film Industry. Similar to the MPAA in the US.</p></div>
              </div>
              <div class="bg-green-500/5 rounded-xl p-3 border border-green-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">ğŸ¸</span>
                <div><strong class="text-green-300 text-sm">Der FroschkÃ¶nig (Frog Prince)</strong><p class="text-gray-400 text-xs mt-0.5">Another key Grimm fairy tale discussed in the module â€” an example of fairy tales adapting across cultures and media.</p></div>
              </div>
              <div class="bg-green-500/5 rounded-xl p-3 border border-green-500/10 flex gap-3 items-start">
                <span class="text-lg flex-shrink-0">ğŸ°</span>
                <div><strong class="text-green-300 text-sm">Disneyland / Eurodisney</strong><p class="text-gray-400 text-xs mt-0.5">Demonstrates how fairy tales cross cultural boundaries â€” Disney's adaptations bring German/European fairy tales to a <strong class="text-white">global audience</strong>, but often sanitize and Americanize the stories.</p></div>
              </div>
              <p class="text-green-200/80 text-sm font-medium italic bg-green-500/5 rounded-lg p-3 border-l-4 border-green-500/40">ğŸ’¡ Fairy tales traveling from Grimm â†’ Disney â†’ Eurodisney shows how <strong>cultural adaptation</strong> transforms the original meaning.</p>
            </div>
          </div>
        </div>

      </div>
    </div>

  </div>

  <!-- ======== FLASHCARDS MODE ======== -->
  <div id="view-flashcards" class="view hidden">
    <div class="text-center mb-5">
      <div class="flex justify-center mb-3"><div class="dwarf-avatar bg-sky-400/80 text-white animate-float">â˜ï¸</div></div>
      <h2 class="font-display font-bold text-2xl sm:text-3xl text-white mb-2">ğŸƒ Cloudy's Flashcard Deck</h2>
      <p class="text-gray-400 text-sm sm:text-base">Cloudy the Dreamer helps you memorize! <span class="text-amber-400 font-semibold">Tap the card to flip it.</span></p>
    </div>

    <!-- ADHD: Visual progress dots -->
    <div class="flex justify-center gap-1.5 mb-4 flex-wrap max-w-md mx-auto" id="fc-dots"></div>

    <!-- Stats bar -->
    <div class="flex justify-center gap-4 sm:gap-6 mb-6">
      <div class="glass rounded-xl px-4 py-2 flex items-center gap-2">
        <span class="text-amber-400">ğŸ“</span>
        <span id="fc-progress" class="font-mono text-amber-300 text-sm font-bold">1 / 30</span>
      </div>
      <div class="glass rounded-xl px-4 py-2 flex items-center gap-2">
        <span class="text-green-400">ğŸ’</span>
        <span id="fc-known" class="font-mono text-green-300 text-sm font-bold">0 known</span>
      </div>
      <div class="glass rounded-xl px-4 py-2 flex items-center gap-2">
        <span class="text-gray-400">ğŸ“š</span>
        <span id="fc-remaining" class="font-mono text-gray-300 text-sm font-bold">30 left</span>
      </div>
    </div>

    <!-- BIG FLASHCARD -->
    <div class="flex justify-center mb-6 px-2">
      <div id="flashcard" class="flip-card w-full max-w-2xl cursor-pointer animate-breathe adhd-focus rounded-3xl" onclick="flipCard()">
        <div class="flip-card-inner relative w-full flashcard-container">
          <div class="flip-card-front absolute inset-0 glass-strong rounded-3xl p-8 sm:p-12 flex flex-col items-center justify-center text-center border-2 border-amber-500/30 hover:border-amber-500/50 transition-colors shadow-2xl">
            <div class="absolute top-4 left-5 flex items-center gap-2">
              <span id="fc-category" class="tag bg-amber-500/20 text-amber-300 border border-amber-500/20 text-xs sm:text-sm">Category</span>
            </div>
            <div class="absolute top-4 right-5">
              <div class="dwarf-avatar dwarf-avatar-sm bg-sky-400/60 text-white opacity-40">â˜ï¸</div>
            </div>
            <div class="flex-1 flex flex-col items-center justify-center py-8">
              <p id="fc-front" class="font-display font-bold text-2xl sm:text-3xl lg:text-4xl text-white leading-snug max-w-lg">Question</p>
            </div>
            <div class="flex items-center gap-3 text-gray-500 text-sm">
              <span>tap to reveal answer</span>
              <span class="animate-float text-lg">ğŸ‘†</span>
              <span class="kbd">Space</span>
            </div>
          </div>
          <div class="flip-card-back absolute inset-0 glass-strong rounded-3xl p-8 sm:p-12 flex flex-col items-center justify-center text-center border-2 border-green-500/30 shadow-2xl">
            <div class="absolute top-4 left-5">
              <span class="tag bg-green-500/20 text-green-300 border border-green-500/20 text-xs sm:text-sm">ğŸ’¡ Answer</span>
            </div>
            <div class="absolute top-4 right-5">
              <div class="dwarf-avatar dwarf-avatar-sm bg-green-500/60 text-white opacity-40">âœ¨</div>
            </div>
            <div class="flex-1 flex flex-col items-center justify-center py-8">
              <p id="fc-back" class="text-gray-100 text-lg sm:text-xl lg:text-2xl leading-relaxed max-w-lg font-medium">Answer</p>
            </div>
            <p class="text-gray-500 text-sm flex items-center gap-2">tap to see question <span class="kbd">Space</span></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Dwarf encouragement (changes randomly) -->
    <div class="text-center mb-5">
      <p id="fc-encouragement" class="text-gray-500 text-sm italic transition-opacity duration-300">â˜ï¸ Cloudy whispers: "You're doing great, keep dreaming big!"</p>
    </div>

    <!-- ADHD: Big, clearly labeled buttons with keyboard hints -->
    <div class="flex justify-center gap-3 sm:gap-4 flex-wrap">
      <button onclick="prevCard()" class="px-5 sm:px-7 py-3.5 rounded-2xl glass border-2 border-white/10 hover:border-amber-500/40 hover:bg-amber-500/5 transition-all font-bold text-xl flex items-center gap-2 group" title="Previous card">
        <span>â†</span>
        <span class="hidden sm:inline text-sm text-gray-400 group-hover:text-amber-300 font-normal">Prev</span>
        <span class="kbd hidden sm:inline">â†</span>
      </button>
      <button onclick="markKnown()" class="px-6 sm:px-8 py-3.5 rounded-2xl bg-green-500/20 border-2 border-green-500/30 hover:bg-green-500/30 hover:border-green-500/50 transition-all text-green-300 font-bold text-base sm:text-lg flex items-center gap-2 shadow-lg shadow-green-500/10">
        <span class="text-xl">ğŸ’</span> I Know This!
      </button>
      <button onclick="shuffleCards()" class="px-5 sm:px-6 py-3.5 rounded-2xl glass border-2 border-white/10 hover:border-amber-500/40 hover:bg-amber-500/5 transition-all text-xl flex items-center gap-2 group" title="Shuffle deck">
        <span>ğŸ”€</span>
        <span class="hidden sm:inline text-sm text-gray-400 group-hover:text-amber-300 font-normal">Shuffle</span>
      </button>
      <button onclick="nextCard()" class="px-5 sm:px-7 py-3.5 rounded-2xl glass border-2 border-white/10 hover:border-amber-500/40 hover:bg-amber-500/5 transition-all font-bold text-xl flex items-center gap-2 group" title="Next card">
        <span class="hidden sm:inline text-sm text-gray-400 group-hover:text-amber-300 font-normal">Next</span>
        <span>â†’</span>
        <span class="kbd hidden sm:inline">â†’</span>
      </button>
    </div>

    <!-- ADHD: Keyboard shortcut legend -->
    <div class="mt-6 text-center">
      <div class="inline-flex items-center gap-4 text-gray-600 text-xs">
        <span class="flex items-center gap-1"><span class="kbd">â†</span><span class="kbd">â†’</span> navigate</span>
        <span class="flex items-center gap-1"><span class="kbd">Space</span> flip</span>
        <span class="flex items-center gap-1"><span class="kbd">Enter</span> flip</span>
      </div>
    </div>
  </div>

  <!-- ======== QUIZ MODE ======== -->
  <div id="view-quiz" class="view hidden">
    <div class="text-center mb-6">
      <div class="flex justify-center mb-3"><div class="dwarf-avatar bg-yellow-300/80 text-gray-900">âš¡</div></div>
      <h2 class="font-display font-bold text-2xl sm:text-3xl text-white mb-2">âš¡ Speedy's Quick Quiz</h2>
      <p class="text-gray-400 text-sm sm:text-base">Speedy challenges you â€” think fast, earn gems!</p>
      <div class="flex justify-center gap-4 mt-4">
        <div class="glass rounded-xl px-4 py-2 flex items-center gap-2">
          <span class="text-amber-400">ğŸ“</span>
          <span id="quiz-progress" class="font-mono text-amber-300 text-sm font-bold">Question 1 / 25</span>
        </div>
        <div class="glass rounded-xl px-4 py-2 flex items-center gap-2">
          <span class="text-green-400">ğŸ’</span>
          <span id="quiz-score" class="font-mono text-green-300 text-sm font-bold">0 correct</span>
        </div>
      </div>
    </div>
    <div id="quiz-container" class="max-w-3xl mx-auto"></div>
    <div id="quiz-results" class="hidden max-w-3xl mx-auto"></div>
  </div>

  <!-- ======== MATCHING MODE ======== -->
  <div id="view-matching" class="view hidden">
    <div class="text-center mb-6">
      <div class="flex justify-center mb-3"><div class="dwarf-avatar bg-red-500/80 text-white">ğŸ˜Š</div></div>
      <h2 class="font-display font-bold text-2xl sm:text-3xl text-white mb-2">ğŸ§© Bubi's Match Game</h2>
      <p class="text-gray-400 text-sm sm:text-base">Bubi the Innocent Hero wants to help â€” tap a term, then its definition!</p>
      <div class="flex justify-center gap-4 mt-4">
        <div class="glass rounded-xl px-4 py-2 flex items-center gap-2">
          <span class="text-green-400">ğŸ’</span>
          <span id="match-score" class="font-mono text-green-300 text-sm font-bold">0 / 14 matched</span>
        </div>
        <div class="glass rounded-xl px-4 py-2 flex items-center gap-2">
          <span class="text-amber-400">â±ï¸</span>
          <span id="match-timer" class="font-mono text-amber-300 text-sm font-bold">0:00</span>
        </div>
      </div>
    </div>
    <div id="matching-container" class="max-w-4xl mx-auto grid sm:grid-cols-2 gap-6"></div>
    <div class="text-center mt-6">
      <button onclick="initMatching()" class="px-6 py-3 rounded-2xl glass border-2 border-white/10 hover:border-amber-500/30 hover:bg-amber-500/5 transition text-gray-400 text-base font-semibold flex items-center gap-2 mx-auto">ğŸ”„ Reset Game</button>
    </div>
  </div>

  <!-- ======== ESSAY PREP MODE ======== -->
  <div id="view-essay" class="view hidden">
    <div class="text-center mb-6">
      <div class="flex justify-center mb-3"><div class="dwarf-avatar bg-indigo-500/80 text-white">ğŸ¤¨</div></div>
      <h2 class="font-display font-bold text-2xl sm:text-3xl text-white mb-2">âœï¸ Ralfie's Essay Workshop</h2>
      <p class="text-gray-400 text-sm sm:text-base">Ralfie the Skeptic demands strong arguments â€” practice here! Drafts auto-save.</p>
    </div>
    <div class="max-w-3xl mx-auto space-y-4" id="essay-container"></div>
  </div>

  <!-- ======== NOTES MODE ======== -->
  <div id="view-notes" class="view hidden">
    <div class="text-center mb-6">
      <div class="flex justify-center mb-3"><div class="dwarf-avatar bg-amber-400/80 text-white animate-float">â˜€ï¸</div></div>
      <h2 class="font-display font-bold text-2xl sm:text-3xl text-white mb-2">ğŸ“‹ Sunny's Important Notes</h2>
      <p class="text-gray-400 text-sm sm:text-base">Sunny the Wise One gathered everything you need to know in one place!</p>
    </div>

    <div class="max-w-4xl mx-auto space-y-6">

      <!-- Quick Reference: Must-Know Terms -->
      <div class="glass-strong rounded-2xl p-6 sm:p-8 border border-emerald-500/20">
        <div class="flex items-center gap-3 mb-5">
          <span class="text-2xl">ğŸ“š</span>
          <h3 class="font-display font-bold text-xl sm:text-2xl bg-gradient-to-r from-emerald-400 to-teal-400 bg-clip-text text-transparent">Must-Know Terms &amp; Definitions</h3>
        </div>
        <div class="grid sm:grid-cols-2 gap-3">
          <div class="bg-emerald-500/5 rounded-xl p-4 border border-emerald-500/10">
            <p class="text-emerald-300 font-bold text-sm mb-1">Schema Theory</p>
            <p class="text-gray-400 text-sm">Cultural knowledge organized into mental frameworks that guide how we interpret texts.</p>
          </div>
          <div class="bg-emerald-500/5 rounded-xl p-4 border border-emerald-500/10">
            <p class="text-emerald-300 font-bold text-sm mb-1">Top-Down Processing</p>
            <p class="text-gray-400 text-sm">Using prior knowledge and expectations to interpret a text (not just reading the words).</p>
          </div>
          <div class="bg-emerald-500/5 rounded-xl p-4 border border-emerald-500/10">
            <p class="text-emerald-300 font-bold text-sm mb-1">Situation Model</p>
            <p class="text-gray-400 text-sm">The mental picture of characters, events, time &amp; space a reader builds while reading.</p>
          </div>
          <div class="bg-emerald-500/5 rounded-xl p-4 border border-emerald-500/10">
            <p class="text-emerald-300 font-bold text-sm mb-1">Inference-Making</p>
            <p class="text-gray-400 text-sm">Filling in narrative gaps using reasoning and prior cultural knowledge.</p>
          </div>
          <div class="bg-emerald-500/5 rounded-xl p-4 border border-emerald-500/10">
            <p class="text-emerald-300 font-bold text-sm mb-1">Individualism vs. Collectivism</p>
            <p class="text-gray-400 text-sm">Cultural value systems that shape how readers evaluate characters differently.</p>
          </div>
          <div class="bg-emerald-500/5 rounded-xl p-4 border border-emerald-500/10">
            <p class="text-emerald-300 font-bold text-sm mb-1">Cultural Variable</p>
            <p class="text-gray-400 text-sm">The argument that literary studies must include culture as a factor in interpretation.</p>
          </div>
          <div class="bg-emerald-500/5 rounded-xl p-4 border border-emerald-500/10">
            <p class="text-emerald-300 font-bold text-sm mb-1">Reciprocity</p>
            <p class="text-gray-400 text-sm">The principle of mutual exchange that governs dwarf-human interactions in fairy tales.</p>
          </div>
          <div class="bg-emerald-500/5 rounded-xl p-4 border border-emerald-500/10">
            <p class="text-emerald-300 font-bold text-sm mb-1">FSK (Freiwillige Selbstkontrolle)</p>
            <p class="text-gray-400 text-sm">The German movie rating system â€” Voluntary Self-Regulation of the Film Industry.</p>
          </div>
        </div>
      </div>

      <!-- Gilmour's 5 Dwarf Categories -->
      <div class="glass-strong rounded-2xl p-6 sm:p-8 border border-amber-500/20">
        <div class="flex items-center gap-3 mb-5">
          <span class="text-2xl">â›ï¸</span>
          <h3 class="font-display font-bold text-xl sm:text-2xl bg-gradient-to-r from-amber-400 to-orange-400 bg-clip-text text-transparent">Gilmour's 5 Dwarf Categories</h3>
        </div>
        <div class="space-y-3">
          <div class="flex gap-4 items-start bg-green-500/5 rounded-xl p-4 border border-green-500/10">
            <span class="text-3xl flex-shrink-0">ğŸ¤²</span>
            <div><p class="text-green-300 font-bold text-base">1. The Unexpected Helper</p><p class="text-gray-400 text-sm mt-1">Assists without asking anything in return.</p><p class="text-gray-500 text-xs italic mt-1">Examples: The Elves and the Shoemaker, Snow White dwarfs</p></div>
          </div>
          <div class="flex gap-4 items-start bg-blue-500/5 rounded-xl p-4 border border-blue-500/10">
            <span class="text-3xl flex-shrink-0">ğŸ«¡</span>
            <div><p class="text-blue-300 font-bold text-base">2. The Obedient Dwarf</p><p class="text-gray-400 text-sm mt-1">Controlled by a human through magic.</p><p class="text-gray-500 text-xs italic mt-1">Example: Das Blaue Licht</p></div>
          </div>
          <div class="flex gap-4 items-start bg-yellow-500/5 rounded-xl p-4 border border-yellow-500/10">
            <span class="text-3xl flex-shrink-0">ğŸ</span>
            <div><p class="text-yellow-300 font-bold text-base">3. The Volunteer Giver</p><p class="text-gray-400 text-sm mt-1">Offers help but expects equal value in return.</p></div>
          </div>
          <div class="flex gap-4 items-start bg-red-500/5 rounded-xl p-4 border border-red-500/10">
            <span class="text-3xl flex-shrink-0">ğŸ˜ˆ</span>
            <div><p class="text-red-300 font-bold text-base">4. The Demonic Dwarf</p><p class="text-gray-400 text-sm mt-1">Acts as an abductor or manipulator.</p><p class="text-gray-500 text-xs italic mt-1">Example: Rumpelstiltskin</p></div>
          </div>
          <div class="flex gap-4 items-start bg-purple-500/5 rounded-xl p-4 border border-purple-500/10">
            <span class="text-3xl flex-shrink-0">ğŸ’€</span>
            <div><p class="text-purple-300 font-bold text-base">5. The Ungrateful / Evil Dwarf</p><p class="text-gray-400 text-sm mt-1">Associated with greed and the Devil.</p><p class="text-gray-500 text-xs italic mt-1">Example: Schneewittchen und Rosenrot</p></div>
          </div>
        </div>
      </div>

      <!-- Key Texts -->
      <div class="glass-strong rounded-2xl p-6 sm:p-8 border border-sky-500/20">
        <div class="flex items-center gap-3 mb-5">
          <span class="text-2xl">ğŸ“•</span>
          <h3 class="font-display font-bold text-xl sm:text-2xl bg-gradient-to-r from-sky-400 to-blue-400 bg-clip-text text-transparent">Important Texts You Must Know</h3>
        </div>
        <div class="space-y-3">
          <div class="bg-sky-500/5 rounded-xl p-4 border border-sky-500/10 flex gap-4 items-start">
            <span class="text-2xl flex-shrink-0">ğŸ“œ</span>
            <div><p class="text-sky-300 font-bold text-base">Rudlieb</p><p class="text-gray-400 text-sm mt-1">Early German dwarf story involving treasure and mistrust. One of the <strong class="text-white">earliest dwarf narratives</strong> in German literature.</p></div>
          </div>
          <div class="bg-sky-500/5 rounded-xl p-4 border border-sky-500/10 flex gap-4 items-start">
            <span class="text-2xl flex-shrink-0">âš”ï¸</span>
            <div><p class="text-sky-300 font-bold text-base">Nibelungenlied</p><p class="text-gray-400 text-sm mt-1">Medieval epic. Dwarfs tied to <strong class="text-white">treasure, invisibility (Tarnkappe), and subjugation</strong>. Dwarf Alberich is overpowered and forced into servitude.</p></div>
          </div>
          <div class="bg-sky-500/5 rounded-xl p-4 border border-sky-500/10 flex gap-4 items-start">
            <span class="text-2xl flex-shrink-0">ğŸ‘¸</span>
            <div><p class="text-sky-300 font-bold text-base">Snow White (Schneewittchen)</p><p class="text-gray-400 text-sm mt-1">Dwarfs as <strong class="text-white">miners, protectors, guardians of domestic stability</strong>. They offer shelter in exchange for housework.</p></div>
          </div>
          <div class="bg-sky-500/5 rounded-xl p-4 border border-sky-500/10 flex gap-4 items-start">
            <span class="text-2xl flex-shrink-0">ğŸ‘</span>
            <div><p class="text-sky-300 font-bold text-base">The Elves and the Shoemaker</p><p class="text-gray-400 text-sm mt-1">Classic <strong class="text-white">Unexpected Helper</strong> story â€” dwarfs assist secretly without asking for anything.</p></div>
          </div>
          <div class="bg-sky-500/5 rounded-xl p-4 border border-sky-500/10 flex gap-4 items-start">
            <span class="text-2xl flex-shrink-0">ğŸ”µ</span>
            <div><p class="text-sky-300 font-bold text-base">Das Blaue Licht</p><p class="text-gray-400 text-sm mt-1">Features the <strong class="text-white">Obedient Dwarf</strong> â€” a dwarf under magical control by a human.</p></div>
          </div>
          <div class="bg-sky-500/5 rounded-xl p-4 border border-sky-500/10 flex gap-4 items-start">
            <span class="text-2xl flex-shrink-0">ğŸ˜ˆ</span>
            <div><p class="text-sky-300 font-bold text-base">Rumpelstiltskin (Rumpelstilzchen)</p><p class="text-gray-400 text-sm mt-1">The <strong class="text-white">Demonic Dwarf</strong> â€” demands the queen's firstborn child in exchange for spinning straw into gold.</p></div>
          </div>
          <div class="bg-sky-500/5 rounded-xl p-4 border border-sky-500/10 flex gap-4 items-start">
            <span class="text-2xl flex-shrink-0">ğŸ¸</span>
            <div><p class="text-sky-300 font-bold text-base">Der FroschkÃ¶nig (The Frog Prince)</p><p class="text-gray-400 text-sm mt-1">Key Grimm fairy tale â€” example of stories <strong class="text-white">adapting across cultures and media</strong>.</p></div>
          </div>
        </div>
      </div>

      <!-- Grimm vs 7 Zwerge Comparison -->
      <div class="glass-strong rounded-2xl p-6 sm:p-8 border border-pink-500/20">
        <div class="flex items-center gap-3 mb-5">
          <span class="text-2xl">âš¡</span>
          <h3 class="font-display font-bold text-xl sm:text-2xl bg-gradient-to-r from-pink-400 to-rose-400 bg-clip-text text-transparent">Grimm's Snow White vs. 7 Zwerge (2004)</h3>
        </div>
        <div class="grid sm:grid-cols-2 gap-4">
          <div class="bg-amber-500/5 rounded-2xl p-5 border border-amber-500/10">
            <h4 class="text-amber-300 font-bold text-base mb-3 flex items-center gap-2">ğŸ“• Grimm's Snow White</h4>
            <ul class="space-y-2.5">
              <li class="flex gap-3 text-gray-300 text-sm"><span class="text-amber-400 flex-shrink-0">â€¢</span> Moral clarity â€” good vs. evil is clear</li>
              <li class="flex gap-3 text-gray-300 text-sm"><span class="text-amber-400 flex-shrink-0">â€¢</span> Traditional gender roles</li>
              <li class="flex gap-3 text-gray-300 text-sm"><span class="text-amber-400 flex-shrink-0">â€¢</span> Punishment &amp; reward structures</li>
              <li class="flex gap-3 text-gray-300 text-sm"><span class="text-amber-400 flex-shrink-0">â€¢</span> Structured fairy tale logic</li>
              <li class="flex gap-3 text-gray-300 text-sm"><span class="text-amber-400 flex-shrink-0">â€¢</span> Heroism is <strong class="text-white">individual and virtuous</strong></li>
              <li class="flex gap-3 text-gray-300 text-sm"><span class="text-amber-400 flex-shrink-0">â€¢</span> Dwarfs are dutiful miners/protectors</li>
            </ul>
          </div>
          <div class="bg-pink-500/5 rounded-2xl p-5 border border-pink-500/10">
            <h4 class="text-pink-300 font-bold text-base mb-3 flex items-center gap-2">ğŸ¬ 7 Zwerge (2004 Film)</h4>
            <ul class="space-y-2.5">
              <li class="flex gap-3 text-gray-300 text-sm"><span class="text-pink-400 flex-shrink-0">â€¢</span> Parody of Snow White</li>
              <li class="flex gap-3 text-gray-300 text-sm"><span class="text-pink-400 flex-shrink-0">â€¢</span> Dwarfs are insecure &amp; socially awkward</li>
              <li class="flex gap-3 text-gray-300 text-sm"><span class="text-pink-400 flex-shrink-0">â€¢</span> Exaggerates fairy tale conventions</li>
              <li class="flex gap-3 text-gray-300 text-sm"><span class="text-pink-400 flex-shrink-0">â€¢</span> Destabilizes masculinity &amp; heroism</li>
              <li class="flex gap-3 text-gray-300 text-sm"><span class="text-pink-400 flex-shrink-0">â€¢</span> Heroism is <strong class="text-white">collective and flawed</strong></li>
              <li class="flex gap-3 text-gray-300 text-sm"><span class="text-pink-400 flex-shrink-0">â€¢</span> Stars 7 most famous German comedians</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Lecture Notes: Key Facts -->
      <div class="glass-strong rounded-2xl p-6 sm:p-8 border border-green-500/20">
        <div class="flex items-center gap-3 mb-5">
          <span class="text-2xl">ğŸ¤</span>
          <h3 class="font-display font-bold text-xl sm:text-2xl bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent">Key Lecture Facts</h3>
        </div>
        <div class="space-y-3">
          <div class="bg-gradient-to-r from-green-500/10 to-transparent rounded-xl p-4 border-l-4 border-green-400 flex gap-3">
            <span class="text-green-400 flex-shrink-0 font-bold">1.</span>
            <p class="text-gray-300 text-sm"><strong class="text-white">Language, Culture, and Humor</strong> are three deeply interconnected aspects â€” humor is culturally specific and depends on shared knowledge.</p>
          </div>
          <div class="bg-gradient-to-r from-green-500/10 to-transparent rounded-xl p-4 border-l-4 border-green-400 flex gap-3">
            <span class="text-green-400 flex-shrink-0 font-bold">2.</span>
            <p class="text-gray-300 text-sm">Fairy tales have a <strong class="text-white">profound cultural impact</strong> â€” they shape societal expectations and have evolved to reflect changing cultural values.</p>
          </div>
          <div class="bg-gradient-to-r from-green-500/10 to-transparent rounded-xl p-4 border-l-4 border-green-400 flex gap-3">
            <span class="text-green-400 flex-shrink-0 font-bold">3.</span>
            <p class="text-gray-300 text-sm">Grimm's fairy tales were used for <strong class="text-white">German nationalism &amp; cultural preservation</strong>. They reflect the cultural history of the German people.</p>
          </div>
          <div class="bg-gradient-to-r from-green-500/10 to-transparent rounded-xl p-4 border-l-4 border-green-400 flex gap-3">
            <span class="text-green-400 flex-shrink-0 font-bold">4.</span>
            <p class="text-gray-300 text-sm">Grimm tales were <strong class="text-white">NOT originally for children</strong>. They were told by laborer women from backgrounds of hunger and poverty. Themes of hardship and survival were real.</p>
          </div>
          <div class="bg-gradient-to-r from-green-500/10 to-transparent rounded-xl p-4 border-l-4 border-green-400 flex gap-3">
            <span class="text-green-400 flex-shrink-0 font-bold">5.</span>
            <p class="text-gray-300 text-sm">The 7 Zwerge film was <strong class="text-white">extremely successful in Germany</strong> â€” it stars the 7 most famous German comedians representing dwarf characters through humor.</p>
          </div>
          <div class="bg-gradient-to-r from-green-500/10 to-transparent rounded-xl p-4 border-l-4 border-green-400 flex gap-3">
            <span class="text-green-400 flex-shrink-0 font-bold">6.</span>
            <p class="text-gray-300 text-sm">Key question: <strong class="text-white">Can you translate the humor</strong> in this movie to other cultures? Humor is deeply culture-specific.</p>
          </div>
          <div class="bg-gradient-to-r from-green-500/10 to-transparent rounded-xl p-4 border-l-4 border-green-400 flex gap-3">
            <span class="text-green-400 flex-shrink-0 font-bold">7.</span>
            <p class="text-gray-300 text-sm"><strong class="text-white">FSK</strong> = Freiwillige Selbstkontrolle der Filmwirtschaft â€” the German movie rating system (like the MPAA).</p>
          </div>
          <div class="bg-gradient-to-r from-green-500/10 to-transparent rounded-xl p-4 border-l-4 border-green-400 flex gap-3">
            <span class="text-green-400 flex-shrink-0 font-bold">8.</span>
            <p class="text-gray-300 text-sm"><strong class="text-white">Grimm â†’ Disney â†’ Eurodisney</strong> shows how fairy tales are culturally adapted: dark German tales â†’ sanitized American versions â†’ back to Europe in changed form.</p>
          </div>
        </div>
      </div>

      <!-- Research Hypotheses & Findings -->
      <div class="glass-strong rounded-2xl p-6 sm:p-8 border border-violet-500/20">
        <div class="flex items-center gap-3 mb-5">
          <span class="text-2xl">ğŸ“Š</span>
          <h3 class="font-display font-bold text-xl sm:text-2xl bg-gradient-to-r from-violet-400 to-purple-400 bg-clip-text text-transparent">Research Hypotheses &amp; Findings</h3>
        </div>
        <div class="space-y-4">
          <div class="bg-blue-500/5 rounded-2xl p-5 border border-blue-500/10">
            <p class="text-blue-300 font-bold text-base mb-2">Hypothesis 1</p>
            <p class="text-gray-300 text-sm">Western readers â†’ <strong class="text-white">individualistic</strong> interpretations (independence, personal agency)</p>
            <p class="text-gray-300 text-sm mt-1">East Asian readers â†’ <strong class="text-white">socially oriented</strong> interpretations (harmony, group responsibility)</p>
          </div>
          <div class="bg-pink-500/5 rounded-2xl p-5 border border-pink-500/10">
            <p class="text-pink-300 font-bold text-base mb-2">Hypothesis 2</p>
            <p class="text-gray-300 text-sm">Differences in plot preference: <strong class="text-white">adventurous vs. restrained</strong> development depending on cultural background.</p>
          </div>
          <div class="bg-green-500/5 rounded-2xl p-5 border border-green-500/10">
            <p class="text-green-300 font-bold text-base mb-2">ğŸ“Š Results</p>
            <p class="text-gray-300 text-sm"><strong class="text-white">Statistically significant differences</strong> in inference-making â†’ culture influences <strong class="text-white">deep cognitive processes</strong> in reading.</p>
            <p class="text-gray-300 text-sm mt-1">Interpretation is NOT neutral. Reading is a <strong class="text-white">culturally situated act</strong>.</p>
          </div>
        </div>
      </div>

      <!-- Big Picture Themes -->
      <div class="glass-strong rounded-2xl p-6 sm:p-8 border border-amber-500/20">
        <div class="flex items-center gap-3 mb-5">
          <span class="text-2xl">ğŸ§ </span>
          <h3 class="font-display font-bold text-xl sm:text-2xl bg-gradient-to-r from-amber-400 to-yellow-400 bg-clip-text text-transparent">Big Picture â€” Themes to Remember</h3>
        </div>
        <div class="space-y-3">
          <div class="bg-gradient-to-r from-amber-500/10 to-transparent rounded-xl p-4 border-l-4 border-amber-400 flex gap-3">
            <span class="flex-shrink-0 text-lg">ğŸ”„</span>
            <p class="text-gray-300 text-sm">Grimm = <strong class="text-white">stable moral structures</strong>; 7 Zwerge = <strong class="text-white">destabilizes through satire</strong>.</p>
          </div>
          <div class="bg-gradient-to-r from-amber-500/10 to-transparent rounded-xl p-4 border-l-4 border-amber-400 flex gap-3">
            <span class="flex-shrink-0 text-lg">ğŸ“</span>
            <p class="text-gray-300 text-sm">Interpretation differences across cultures are <strong class="text-white">patterned and measurable</strong>, not random.</p>
          </div>
          <div class="bg-gradient-to-r from-amber-500/10 to-transparent rounded-xl p-4 border-l-4 border-amber-400 flex gap-3">
            <span class="flex-shrink-0 text-lg">ğŸ¦¸</span>
            <p class="text-gray-300 text-sm">Heroism shifts from <strong class="text-white">individual moral clarity</strong> (Grimm) to <strong class="text-white">comedic group dynamics</strong> (7 Zwerge).</p>
          </div>
          <div class="bg-gradient-to-r from-amber-500/10 to-transparent rounded-xl p-4 border-l-4 border-amber-400 flex gap-3">
            <span class="flex-shrink-0 text-lg">â›ï¸</span>
            <p class="text-gray-300 text-sm">Dwarfs originate in <strong class="text-white">Germanic myth &amp; medieval lit</strong> â€” they predate the Grimm tales.</p>
          </div>
          <div class="bg-gradient-to-r from-amber-500/10 to-transparent rounded-xl p-4 border-l-4 border-amber-400 flex gap-3">
            <span class="flex-shrink-0 text-lg">ğŸ’</span>
            <p class="text-gray-300 text-sm">Dwarfs are linked to <strong class="text-white">mountains, mining, treasure, and hidden knowledge</strong>.</p>
          </div>
          <div class="bg-gradient-to-r from-amber-500/10 to-transparent rounded-xl p-4 border-l-4 border-amber-400 flex gap-3">
            <span class="flex-shrink-0 text-lg">ğŸ¤</span>
            <p class="text-gray-300 text-sm"><strong class="text-white">Reciprocity &amp; exchange</strong> are central to every dwarf-human interaction.</p>
          </div>
          <div class="bg-gradient-to-r from-amber-500/10 to-transparent rounded-xl p-4 border-l-4 border-amber-400 flex gap-3">
            <span class="flex-shrink-0 text-lg">ğŸ­</span>
            <p class="text-gray-300 text-sm">Dwarfs shift roles across stories: <strong class="text-white">helper â†’ servant â†’ prophet â†’ villain â†’ demonic figure</strong>.</p>
          </div>
          <div class="bg-gradient-to-r from-amber-500/10 to-transparent rounded-xl p-4 border-l-4 border-amber-400 flex gap-3">
            <span class="flex-shrink-0 text-lg">ğŸ“–</span>
            <p class="text-gray-300 text-sm">Fairy tales are <strong class="text-white">adaptable narratives</strong> â€” same story, different meaning depending on when/where it's told.</p>
          </div>
          <div class="bg-gradient-to-r from-amber-500/10 to-transparent rounded-xl p-4 border-l-4 border-amber-400 flex gap-3">
            <span class="flex-shrink-0 text-lg">âœ¨</span>
            <p class="text-gray-300 text-sm"><strong class="text-white">Mystery &amp; limited knowledge</strong> = the enduring enchantment of dwarf figures.</p>
          </div>
        </div>
      </div>

      <!-- ADHD: Quick Cheat Sheet -->
      <div class="glass-strong rounded-2xl p-6 sm:p-8 border-2 border-amber-500/30 bg-gradient-to-br from-amber-500/5 to-orange-500/5">
        <div class="flex items-center gap-3 mb-5">
          <span class="text-2xl animate-gem-sparkle">ğŸ’</span>
          <h3 class="font-display font-bold text-xl sm:text-2xl text-amber-300">âš¡ Quick Cheat Sheet (If You Only Read One Thing!)</h3>
        </div>
        <div class="space-y-4">
          <div class="bg-black/20 rounded-2xl p-5 border border-amber-500/20">
            <p class="text-amber-300 font-bold text-sm uppercase tracking-wider mb-3">ğŸ§  The One Big Idea</p>
            <p class="text-white text-base sm:text-lg leading-relaxed font-medium">Culture shapes <em>everything</em> about how we read fairy tales â€” who we think is the hero, what we think the moral is, and what we find funny. This isn't opinion; it's measurable and significant.</p>
          </div>
          <div class="bg-black/20 rounded-2xl p-5 border border-amber-500/20">
            <p class="text-amber-300 font-bold text-sm uppercase tracking-wider mb-3">â›ï¸ The Dwarf Summary</p>
            <p class="text-white text-base sm:text-lg leading-relaxed font-medium">Dwarfs evolved from complex, morally ambiguous medieval figures â†’ to simplified Grimm characters (helpers OR villains) â†’ to comedic parodies in 7 Zwerge. Their magic is in their mystery.</p>
          </div>
          <div class="bg-black/20 rounded-2xl p-5 border border-amber-500/20">
            <p class="text-amber-300 font-bold text-sm uppercase tracking-wider mb-3">ğŸ¬ The Film Summary</p>
            <p class="text-white text-base sm:text-lg leading-relaxed font-medium">7 Zwerge (2004) = Snow White parody starring Germany's top 7 comedians. Massively popular in Germany. Its humor is culturally specific and hard to translate â€” proving that language, culture, and humor are inseparable.</p>
          </div>
          <div class="bg-black/20 rounded-2xl p-5 border border-amber-500/20">
            <p class="text-amber-300 font-bold text-sm uppercase tracking-wider mb-3">ğŸ“• The Grimm Summary</p>
            <p class="text-white text-base sm:text-lg leading-relaxed font-medium">Grimm tales = originally dark stories from poor working women â†’ edited for Romantic nationalism â†’ sanitized by Disney for global audiences. They were never "just for kids."</p>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- ======== OFFICIAL CHEAT SHEET MODE (PRINTABLE) ======== -->
  <div id="view-cheatsheet" class="view hidden">
    <div class="text-center mb-4 no-print">
      <div class="flex justify-center mb-3"><div class="dwarf-avatar bg-rose-500/80 text-white animate-float">ğŸ“</div></div>
      <h2 class="font-display font-bold text-2xl sm:text-3xl text-white mb-2">ğŸ“ Official 1-Page Cheat Sheet</h2>
      <p class="text-gray-400 text-sm sm:text-base mb-4">Designed for your <span class="text-rose-300 font-bold">one allowed sheet of notes</span>. Covers all 3 quiz question types!</p>
      <button onclick="window.print()" class="px-8 py-3 rounded-2xl bg-gradient-to-r from-rose-500 to-pink-500 text-white font-bold text-lg hover:opacity-90 transition-all shadow-lg shadow-rose-500/30 flex items-center gap-3 mx-auto">
        ğŸ–¨ï¸ Print This Cheat Sheet
      </button>
    </div>

    <!-- PRINTABLE CHEAT SHEET -->
    <div id="cheatsheet-content" class="max-w-4xl mx-auto">

      <!-- PRINT HEADER -->
      <div class="print-only-header hidden text-center mb-2">
        <h1 style="font-size:16px;font-weight:900;margin:0;">GER 441 â€” Module 6 Cheat Sheet: Dwarfs, Fairy Tales, Humor &amp; Culture</h1>
      </div>

      <!-- Q1: SCHOLARLY READING (Stringham â€” Dwarfs Article) -->
      <div class="glass-strong rounded-2xl p-4 sm:p-5 mb-3 border-2 border-amber-500/30 print-section">
        <div class="flex items-center gap-2 mb-3">
          <span class="text-lg">ğŸ“–</span>
          <h3 class="font-display font-bold text-base sm:text-lg text-amber-300">Q1 â€” SCHOLARLY READING: Stringham, "Dwarfs in German Fairy Tales"</h3>
        </div>

        <div class="grid sm:grid-cols-2 gap-2 text-xs sm:text-sm mb-3">
          <div>
            <p class="text-amber-400 font-bold mb-1">âœ¦ Author &amp; Argument</p>
            <p class="text-gray-300"><strong class="text-white">EnikÃ¶ Stringham</strong> traces dwarfs from medieval epics â†’ Grimm fairy tales. Dwarfs shift roles: <strong class="text-white">helper â†’ servant â†’ prophet â†’ villain â†’ demonic figure</strong>. They are NOT static â€” they change meaning across historical periods.</p>
          </div>
          <div>
            <p class="text-amber-400 font-bold mb-1">âœ¦ 7 Major Themes</p>
            <p class="text-gray-300">1) Historical continuity 2) Association with earth/mining/treasure 3) <strong class="text-white">Reciprocity</strong> (exchange governs every dwarf-human interaction) 4) Power &amp; subjugation 5) Wisdom &amp; prophecy 6) Moral ambiguity 7) Grimm's Romantic nationalism revisions</p>
          </div>
        </div>

        <div class="grid sm:grid-cols-2 gap-2 text-xs sm:text-sm mb-3">
          <div>
            <p class="text-amber-400 font-bold mb-1">âœ¦ Gilmour's 5 Dwarf Categories</p>
            <ol class="text-gray-300 space-y-0.5 list-decimal ml-4">
              <li><strong class="text-green-300">Unexpected Helper</strong> â€” helps freely (Elves &amp; Shoemaker, Snow White dwarfs)</li>
              <li><strong class="text-blue-300">Obedient Dwarf</strong> â€” controlled by magic (Das Blaue Licht)</li>
              <li><strong class="text-yellow-300">Volunteer Giver</strong> â€” helps but expects equal exchange</li>
              <li><strong class="text-red-300">Demonic Dwarf</strong> â€” abductor/manipulator (Rumpelstiltskin)</li>
              <li><strong class="text-purple-300">Ungrateful/Evil Dwarf</strong> â€” greed, associated with the Devil</li>
            </ol>
          </div>
          <div>
            <p class="text-amber-400 font-bold mb-1">âœ¦ Key Texts &amp; What They Show</p>
            <ul class="text-gray-300 space-y-0.5">
              <li>â€¢ <strong class="text-white">Rudlieb</strong> â€” earliest dwarf narrative, treasure &amp; mistrust</li>
              <li>â€¢ <strong class="text-white">Nibelungenlied</strong> â€” dwarf Alberich: treasure, invisibility (Tarnkappe), forced servitude</li>
              <li>â€¢ <strong class="text-white">Snow White</strong> â€” dwarfs as miners, protectors, domestic stability; reciprocity (shelter for housework)</li>
              <li>â€¢ <strong class="text-white">Elves &amp; Shoemaker</strong> â€” Unexpected Helper, secret aid</li>
              <li>â€¢ <strong class="text-white">Rumpelstiltskin</strong> â€” Demonic Dwarf, demands firstborn child for spinning strawâ†’gold</li>
              <li>â€¢ <strong class="text-white">Das Blaue Licht</strong> â€” Obedient Dwarf under magical control</li>
            </ul>
          </div>
        </div>

        <div class="bg-amber-500/10 rounded-xl p-3 border border-amber-500/20 text-xs sm:text-sm">
          <p class="text-amber-300 font-bold mb-1">âœ¦ KEY QUOTES/FACTS FOR SPECIFIC EXAMPLES:</p>
          <ul class="text-gray-300 space-y-0.5">
            <li>â€¢ Dwarfs originate in <strong class="text-white">Germanic myth &amp; medieval lit BEFORE Grimm</strong>.</li>
            <li>â€¢ <strong class="text-white">Mystery &amp; limited knowledge</strong> = their enduring enchantment (never fully explained â†’ always fascinating).</li>
            <li>â€¢ Grimms used fairy tales for <strong class="text-white">Romantic nationalism &amp; cultural preservation</strong> â€” they didn't just collect, they <em>edited</em> to shape German identity.</li>
            <li>â€¢ In Snow White: dwarfs say <em>"If you will keep house for usâ€¦you shall want for nothing"</em> â€” classic <strong class="text-white">reciprocity</strong>.</li>
            <li>â€¢ Rumpelstiltskin's deal: <em>"What will you give me?"</em> â€” starts with necklace, then ring, then demands the <strong class="text-white">child itself</strong>. Escalating exchange.</li>
            <li>â€¢ Nibelungenlied: Siegfried defeats dwarf Alberich and takes the <strong class="text-white">Tarnkappe (cloak of invisibility)</strong> â€” power through subjugation.</li>
          </ul>
        </div>
      </div>

      <!-- Q2: THE FILM â€” 7 Zwerge -->
      <div class="glass-strong rounded-2xl p-4 sm:p-5 mb-3 border-2 border-pink-500/30 print-section">
        <div class="flex items-center gap-2 mb-3">
          <span class="text-lg">ğŸ¬</span>
          <h3 class="font-display font-bold text-base sm:text-lg text-pink-300">Q2 â€” THE FILM: 7 Zwerge (2004) â€” Specific Examples</h3>
        </div>

        <div class="grid sm:grid-cols-2 gap-2 text-xs sm:text-sm mb-3">
          <div>
            <p class="text-pink-400 font-bold mb-1">âœ¦ Film Basics</p>
            <ul class="text-gray-300 space-y-0.5">
              <li>â€¢ <strong class="text-white">Snow White parody</strong> starring Germany's 7 most famous comedians</li>
              <li>â€¢ <strong class="text-white">Massive box-office hit in Germany</strong></li>
              <li>â€¢ Each comedian brought their established <strong class="text-white">comedic persona</strong> to a dwarf character</li>
              <li>â€¢ FSK rated (Freiwillige Selbstkontrolle der Filmwirtschaft = German movie rating system)</li>
            </ul>
          </div>
          <div>
            <p class="text-pink-400 font-bold mb-1">âœ¦ How It Changes Grimm</p>
            <ul class="text-gray-300 space-y-0.5">
              <li>â€¢ Grimm: dwarfs are dutiful miners/protectors â†’ <strong class="text-white">7Z: dwarfs are insecure &amp; socially awkward</strong></li>
              <li>â€¢ Grimm: moral clarity (good vs evil) â†’ <strong class="text-white">7Z: parody &amp; exaggeration</strong></li>
              <li>â€¢ Grimm: heroism = individual &amp; virtuous â†’ <strong class="text-white">7Z: heroism = collective &amp; flawed</strong></li>
              <li>â€¢ Grimm: traditional gender roles â†’ <strong class="text-white">7Z: destabilizes masculinity &amp; heroism</strong></li>
            </ul>
          </div>
        </div>

        <div class="bg-pink-500/10 rounded-xl p-3 border border-pink-500/20 text-xs sm:text-sm mb-3">
          <p class="text-pink-300 font-bold mb-1">âœ¦ SPECIFIC EXAMPLES TO USE IN YOUR ESSAY:</p>
          <ul class="text-gray-300 space-y-0.5">
            <li>â€¢ Dwarfs <strong class="text-white">stumble into heroism accidentally</strong> â€” they argue, fail at tasks, and are confused about what to do. This is the OPPOSITE of Grimm.</li>
            <li>â€¢ Each dwarf's personality matches the <strong class="text-white">comedian's real comedic style</strong> â€” the humor depends on German audiences RECOGNIZING these performers.</li>
            <li>â€¢ The film <strong class="text-white">exaggerates fairy tale conventions to the point of absurdity</strong> â€” making the audience question assumptions they take for granted.</li>
            <li>â€¢ Success was largely <strong class="text-white">limited to Germany</strong> because humor doesn't translate â€” proves language, culture &amp; humor are inseparable.</li>
            <li>â€¢ The film shows heroism is <strong class="text-white">culturally constructed, not natural</strong> â€” what counts as heroic depends on cultural expectations.</li>
            <li>â€¢ Traditional fairy tale structure (problem â†’ quest â†’ reward) is <strong class="text-white">parodied through comedic incompetence</strong> rather than followed earnestly.</li>
          </ul>
        </div>

        <div class="bg-pink-500/5 rounded-xl p-3 border border-pink-500/15 text-xs sm:text-sm">
          <p class="text-pink-300 font-bold mb-1">âœ¦ WHY THE HUMOR DOESN'T TRANSLATE:</p>
          <p class="text-gray-300">1) Stars aren't known outside Germany 2) Parody requires knowing Grimm as <em>cultural heritage</em>, not just a story 3) German comedic timing/style differs from American/other comedy 4) Culturally-specific wordplay and references</p>
        </div>
      </div>

      <!-- Q3: MODULE SUMMARY (Big Picture) -->
      <div class="glass-strong rounded-2xl p-4 sm:p-5 mb-3 border-2 border-violet-500/30 print-section">
        <div class="flex items-center gap-2 mb-3">
          <span class="text-lg">ğŸ§ </span>
          <h3 class="font-display font-bold text-base sm:text-lg text-violet-300">Q3 â€” MODULE SUMMARY: The Big Picture</h3>
        </div>

        <div class="grid sm:grid-cols-2 gap-2 text-xs sm:text-sm mb-3">
          <div>
            <p class="text-violet-400 font-bold mb-1">âœ¦ The Core Argument of Module 6</p>
            <p class="text-gray-300"><strong class="text-white">Culture shapes EVERYTHING</strong> about how we read fairy tales â€” who we think is the hero, what we think the moral is, and what we find funny. Reading is <strong class="text-white">NOT neutral</strong> â€” it is a culturally situated act. Differences in interpretation are <strong class="text-white">patterned and measurable</strong>.</p>
          </div>
          <div>
            <p class="text-violet-400 font-bold mb-1">âœ¦ Key Terms to Define</p>
            <ul class="text-gray-300 space-y-0.5">
              <li>â€¢ <strong class="text-white">Schema Theory</strong> â€” cultural mental frameworks guiding interpretation</li>
              <li>â€¢ <strong class="text-white">Top-Down Processing</strong> â€” using prior knowledge to interpret text</li>
              <li>â€¢ <strong class="text-white">Situation Model</strong> â€” mental picture of characters/events/space during reading</li>
              <li>â€¢ <strong class="text-white">Inference-Making</strong> â€” filling narrative gaps with cultural knowledge</li>
              <li>â€¢ <strong class="text-white">Individualism vs. Collectivism</strong> â€” how cultures evaluate characters differently</li>
            </ul>
          </div>
        </div>

        <div class="grid sm:grid-cols-2 gap-2 text-xs sm:text-sm mb-3">
          <div>
            <p class="text-violet-400 font-bold mb-1">âœ¦ Research Hypotheses &amp; Results</p>
            <ul class="text-gray-300 space-y-0.5">
              <li>â€¢ <strong class="text-white">H1:</strong> Western readers â†’ individualistic interpretations; East Asian â†’ socially oriented</li>
              <li>â€¢ <strong class="text-white">H2:</strong> Plot preferences differ: adventurous vs. restrained development</li>
              <li>â€¢ <strong class="text-white">Results:</strong> Statistically significant differences in inference-making â†’ culture influences DEEP cognitive processes</li>
            </ul>
          </div>
          <div>
            <p class="text-violet-400 font-bold mb-1">âœ¦ The 3 Big Connections</p>
            <ol class="text-gray-300 space-y-0.5 list-decimal ml-4">
              <li><strong class="text-white">Dwarfs â†’ Culture:</strong> Dwarf figures are culturally constructed, not fixed archetypes. They change meaning across eras.</li>
              <li><strong class="text-white">Grimm â†’ 7 Zwerge:</strong> Stable morality â†’ satirical parody. Individual heroism â†’ collective flawed heroism.</li>
              <li><strong class="text-white">Language + Culture + Humor:</strong> Inseparable triad. Humor requires shared cultural knowledge; fairy tales are always culturally rooted.</li>
            </ol>
          </div>
        </div>

        <div class="bg-violet-500/10 rounded-xl p-3 border border-violet-500/20 text-xs sm:text-sm">
          <p class="text-violet-300 font-bold mb-1">âœ¦ MODULE TIMELINE YOU CAN REFERENCE:</p>
          <p class="text-gray-300">
            <strong class="text-white">Medieval epics</strong> (Rudlieb, Nibelungenlied: complex, dangerous dwarfs) 
            â†’ <strong class="text-white">Brothers Grimm</strong> (1800s: simplified, moralized for nationalism) 
            â†’ <strong class="text-white">Disney</strong> (1937+: sanitized, Americanized, global) 
            â†’ <strong class="text-white">7 Zwerge</strong> (2004: parodied, humor-driven, culturally specific) 
            â†’ <strong class="text-white">Eurodisney</strong> (Americanized tales return to Europe in changed form)
          </p>
          <p class="text-violet-300 mt-2"><strong>ONE SENTENCE SUMMARY:</strong> <span class="text-white">Fairy tales are adaptable narratives that change meaning based on cultural context â€” the same story told by Grimm, Disney, and 7 Zwerge carries three completely different cultural messages.</span></p>
        </div>
      </div>

      <!-- BONUS: Quick-Reference Footer -->
      <div class="glass rounded-xl p-3 border border-gray-500/20 print-section">
        <div class="grid grid-cols-3 gap-2 text-xs">
          <div>
            <p class="text-gray-400 font-bold mb-1">ğŸ“• Grimm = </p>
            <p class="text-gray-300">Dark origins, oral tradition from poor laborer women, NOT for children, cultural preservation, Romantic nationalism</p>
          </div>
          <div>
            <p class="text-gray-400 font-bold mb-1">ğŸ¬ 7 Zwerge = </p>
            <p class="text-gray-300">Parody, 7 famous comedians, massive German hit, humor doesn't translate, destabilizes heroism/masculinity</p>
          </div>
          <div>
            <p class="text-gray-400 font-bold mb-1">ğŸ§  Culture = </p>
            <p class="text-gray-300">Shapes reading at cognitive level, schemata guide interpretation, inference-making is culturally variable, measurable differences</p>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- ======== BLAST GAMES MODE ======== -->
  <div id="view-blastgames" class="view hidden">
    <div class="text-center mb-6">
      <div class="flex justify-center mb-3"><div class="dwarf-avatar bg-fuchsia-500/80 text-white animate-float">ğŸ®</div></div>
      <h2 class="font-display font-bold text-2xl sm:text-3xl text-white mb-2">ğŸ® Blast Games â€” ADHD-Friendly Mini Games!</h2>
      <p class="text-gray-400 text-sm sm:text-base">Bite-sized, dopamine-boosting games to lock in your exam knowledge. Pick a game!</p>
    </div>

    <!-- Game Selector -->
    <div class="grid grid-cols-2 sm:grid-cols-5 gap-3 mb-6 max-w-4xl mx-auto" id="blast-game-selector">
      <button onclick="startBlastGame('speedround')" class="blast-pick glass-strong rounded-2xl p-4 border-2 border-fuchsia-500/20 hover:border-fuchsia-500/50 transition-all text-center group">
        <span class="text-3xl block mb-2 group-hover:animate-wiggle">âš¡</span>
        <span class="font-display font-bold text-fuchsia-300 text-sm">Speed Round</span>
        <span class="block text-gray-500 text-[10px] mt-1">60s True/False Blitz</span>
      </button>
      <button onclick="startBlastGame('bombdefuse')" class="blast-pick glass-strong rounded-2xl p-4 border-2 border-orange-500/20 hover:border-orange-500/50 transition-all text-center group">
        <span class="text-3xl block mb-2 group-hover:animate-wiggle">ğŸ’£</span>
        <span class="font-display font-bold text-orange-300 text-sm">Bomb Defuser</span>
        <span class="block text-gray-500 text-[10px] mt-1">Type Fast or Boom!</span>
      </button>
      <button onclick="startBlastGame('timeline')" class="blast-pick glass-strong rounded-2xl p-4 border-2 border-sky-500/20 hover:border-sky-500/50 transition-all text-center group">
        <span class="text-3xl block mb-2 group-hover:animate-wiggle">ğŸ”—</span>
        <span class="font-display font-bold text-sky-300 text-sm">Timeline</span>
        <span class="block text-gray-500 text-[10px] mt-1">Put Events in Order</span>
      </button>
      <button onclick="startBlastGame('whoami')" class="blast-pick glass-strong rounded-2xl p-4 border-2 border-green-500/20 hover:border-green-500/50 transition-all text-center group">
        <span class="text-3xl block mb-2 group-hover:animate-wiggle">ğŸ•µï¸</span>
        <span class="font-display font-bold text-green-300 text-sm">Who Am I?</span>
        <span class="block text-gray-500 text-[10px] mt-1">Guess from Clues</span>
      </button>
      <button onclick="startBlastGame('categorysort')" class="blast-pick glass-strong rounded-2xl p-4 border-2 border-amber-500/20 hover:border-amber-500/50 transition-all text-center group col-span-2 sm:col-span-1">
        <span class="text-3xl block mb-2 group-hover:animate-wiggle">ğŸ—‚ï¸</span>
        <span class="font-display font-bold text-amber-300 text-sm">Category Sort</span>
        <span class="block text-gray-500 text-[10px] mt-1">Sort into Categories</span>
      </button>
    </div>

    <!-- Game Arena -->
    <div id="blast-arena" class="max-w-3xl mx-auto"></div>
  </div>

</main>

<!-- Back to Top Button -->
<div class="fixed bottom-6 right-6 z-40">
  <button onclick="scrollToTop()" class="w-12 h-12 rounded-full bg-gradient-to-br from-amber-500 to-orange-600 text-white shadow-lg shadow-amber-500/30 flex items-center justify-center hover:scale-110 active:scale-95 transition-transform text-xl" title="Back to the top of the mine!">â›ï¸</button>
</div>

<!-- ============================================================ -->
<!--  JAVASCRIPT                                                  -->
<!-- ============================================================ -->
<script>
// ============================================
// DATA
// ============================================

const flashcardData = [
  { category: "ğŸ§  Concept", q: "What is Schema Theory?", a: "Cultural knowledge organized into mental frameworks that guide how we interpret texts and stories." },
  { category: "ğŸ§  Concept", q: "What is Top-Down Processing?", a: "Using prior knowledge and expectations to interpret a text, rather than building understanding purely from the text itself." },
  { category: "ğŸ§  Concept", q: "What is a Situation Model?", a: "The mental representation of characters, events, time, and space that a reader builds during reading." },
  { category: "ğŸ§  Concept", q: "What is Inference-Making?", a: "Filling narrative gaps using reasoning and prior cultural knowledge when a story doesn't explicitly state something." },
  { category: "ğŸ§  Concept", q: "What is the Individualism vs. Collectivism framework?", a: "Cultural value systems that shape character evaluation â€” Western cultures tend toward individualism, East Asian toward collectivism." },
  { category: "ğŸ§  Concept", q: "What is a Cultural Variable?", a: "The argument that literary studies must include culture as a factor in how texts are interpreted." },
  { category: "â›ï¸ Dwarfs", q: "Who is the author of the Dwarfs article?", a: "EnikÃ¶ Stringham â€” traces dwarf figures from medieval German literature through Grimm fairy tales." },
  { category: "â›ï¸ Dwarfs", q: "What is the 'Unexpected Helper' dwarf type?", a: "Assists without asking for anything in return, like the dwarfs in The Elves and the Shoemaker or Snow White." },
  { category: "â›ï¸ Dwarfs", q: "What is the 'Demonic Dwarf' category?", a: "Acts as an abductor or manipulator â€” Rumpelstiltskin is the key example." },
  { category: "â›ï¸ Dwarfs", q: "What is the 'Obedient Dwarf' category?", a: "A dwarf controlled by a human through magic, as in Das Blaue Licht." },
  { category: "â›ï¸ Dwarfs", q: "What role do dwarfs play in the Nibelungenlied?", a: "Tied to treasure, invisibility, and subjugation â€” they may be subdued and forced into servitude." },
  { category: "â›ï¸ Dwarfs", q: "What are dwarfs frequently associated with?", a: "Mountains, mining, treasure, hidden underground spaces, and secret knowledge." },
  { category: "â›ï¸ Dwarfs", q: "What is 'reciprocity' in dwarf-human interactions?", a: "Interactions often involve exchange â€” treasure, protection, knowledge, or even children." },
  { category: "ğŸ¬ 7 Zwerge", q: "How does 7 Zwerge reimagine Snow White?", a: "As a parody. The dwarfs are insecure and socially awkward rather than traditionally heroic. It exaggerates fairy tale conventions." },
  { category: "ğŸ¬ 7 Zwerge", q: "How does heroism differ between Grimm and 7 Zwerge?", a: "Grimm: individual moral clarity. 7 Zwerge: comedic group dynamics where heroism is collective and flawed." },
  { category: "ğŸ¬ 7 Zwerge", q: "What does 7 Zwerge destabilize?", a: "Expectations of masculinity and heroism â€” showing these concepts are culturally constructed, not fixed." },
  { category: "ğŸ“Š Research", q: "What did Hypothesis 1 predict?", a: "Western readers = individualistic interpretations; East Asian readers = socially oriented interpretations." },
  { category: "ğŸ“Š Research", q: "What did the research results show?", a: "Statistically significant differences in inference-making, supporting that culture influences deep cognitive processes." },
  { category: "ğŸ“• Grimm", q: "What does Grimm's Snow White emphasize?", a: "Moral clarity, traditional gender roles, punishment and reward structures, and structured fairy tale logic." },
  { category: "ğŸ”„ Themes", q: "Why are fairy tales 'adaptable narratives'?", a: "They are shaped by historical and cultural context â€” the same story carries different meanings depending on when/where it's told." },
  { category: "ğŸ¤ Lecture", q: "What are the three interconnected aspects discussed in the lecture?", a: "Language, Culture, and Humor â€” they are deeply intertwined and humor depends on shared linguistic and cultural knowledge." },
  { category: "ğŸ¤ Lecture", q: "Were Grimm's fairy tales originally intended for children?", a: "No â€” they were not originally for children. The dark and violent nature reflects the harsher realities of life at the time." },
  { category: "ğŸ¤ Lecture", q: "Who originally told the stories collected by the Brothers Grimm?", a: "Laborer women who worked in kitchens â€” not wealthy women. They came from a background of hunger and poverty." },
  { category: "ğŸ¤ Lecture", q: "How were Grimm's fairy tales connected to German nationalism?", a: "They were associated with the rise of German nationalism and used as a means of cultural preservation, reflecting German cultural history." },
  { category: "ğŸ¤ Lecture", q: "What is the FSK?", a: "Freiwillige Selbstkontrolle der Filmwirtschaft â€” the German movie rating system (Voluntary Self-Regulation of the Film Industry), similar to the MPAA." },
  { category: "ğŸ¤ Lecture", q: "Why was the 7 Zwerge film so successful in Germany?", a: "It featured the 7 most famous German comedians, each representing a dwarf character through humor. It was a massive box-office hit." },
  { category: "ğŸ¤ Lecture", q: "Can the humor in 7 Zwerge be translated to other cultures?", a: "This is a key question â€” humor is deeply culture-specific, so much of the comedy may not translate across cultural boundaries." },
  { category: "ğŸ¤ Lecture", q: "What is 'der FroschkÃ¶nig'?", a: "The Frog Prince â€” a key Grimm fairy tale, an example of how fairy tales adapt across cultures and media." },
  { category: "ğŸ¤ Lecture", q: "How does Disneyland/Eurodisney relate to fairy tale culture?", a: "Disney's adaptations bring German/European fairy tales to a global audience, but often sanitize and Americanize the original stories." },
];

const quizData = [
  { q: "According to schema theory, what are 'schemata'?", options: ["Plot structures in fairy tales", "Culturally embedded mental frameworks guiding interpretation", "German literary traditions", "Types of dwarf characters"], correct: 1 },
  { q: "Which dwarf category assists without asking for anything?", options: ["The Obedient Dwarf", "The Volunteer Giver", "The Unexpected Helper", "The Demonic Dwarf"], correct: 2 },
  { q: "In the Nibelungenlied, dwarfs are associated with:", options: ["Comedy and satire", "Treasure, invisibility, and subjugation", "Cooking and domestic work", "Religious authority"], correct: 1 },
  { q: "What does 'top-down processing' mean in reading?", options: ["Reading from the first page to the last", "Using prior knowledge to interpret a text", "Analyzing only surface-level meaning", "Translating between languages"], correct: 1 },
  { q: "How does 7 Zwerge portray its dwarfs?", options: ["As wise prophets", "As evil villains", "As insecure and socially awkward", "As traditional heroes"], correct: 2 },
  { q: "Rumpelstiltskin is an example of which category?", options: ["The Unexpected Helper", "The Volunteer Giver", "The Obedient Dwarf", "The Demonic Dwarf"], correct: 3 },
  { q: "What did Hypothesis 1 predict?", options: ["All readers interpret fairy tales the same way", "Western = individualistic, East Asian = socially oriented", "Children prefer Grimm over modern versions", "German tales are more popular than Asian ones"], correct: 1 },
  { q: "What central theme governs dwarf-human interactions?", options: ["Violence and warfare", "Reciprocity and exchange", "Religious devotion", "Romantic love"], correct: 1 },
  { q: "Grimm's Snow White emphasizes:", options: ["Parody and satire", "Moral ambiguity", "Moral clarity and punishment/reward structures", "Comedic group dynamics"], correct: 2 },
  { q: "The 'Obedient Dwarf' is controlled by:", options: ["A king's decree", "A human through magic", "The Brothers Grimm", "Other dwarfs"], correct: 1 },
  { q: "What makes inference-making culturally variable?", options: ["Different grammar across languages", "Culture shapes cognitive processes for filling narrative gaps", "Some cultures can't read fairy tales", "It isn't culturally variable"], correct: 1 },
  { q: "How does heroism shift from Grimm to 7 Zwerge?", options: ["From collective to individual", "From individual moral clarity to comedic group dynamics", "From comedy to tragedy", "It doesn't change"], correct: 1 },
  { q: "The Brothers Grimm shaped dwarfs through:", options: ["Scientific experiments", "Scholarship and Romantic nationalism", "Film production", "Political speeches"], correct: 1 },
  { q: "What is a 'situation model'?", options: ["A physical model of a setting", "Mental representation of characters, events, time & space during reading", "A diagram of relationships", "A map in fairy tales"], correct: 1 },
  { q: "Why include culture as a variable in literary studies?", options: ["Makes studies longer", "Interpretation differences are patterned and measurable", "German literature is superior", "Readers don't have opinions"], correct: 1 },
  { q: "What are the three interconnected aspects from the lecture?", options: ["Plot, Setting, Character", "Language, Culture, and Humor", "Reading, Writing, Speaking", "Film, Music, Art"], correct: 1 },
  { q: "Were Grimm's fairy tales originally intended for children?", options: ["Yes, they were always children's stories", "No â€” they reflected harsher realities and were not for children", "Only some of them were for children", "They were intended for royalty"], correct: 1 },
  { q: "Who originally told the stories that the Brothers Grimm collected?", options: ["Wealthy aristocratic women", "University professors", "Laborer women who worked in kitchens", "The Brothers Grimm invented them"], correct: 2 },
  { q: "What themes were common in the original Grimm fairy tales?", options: ["Romance and comedy", "Poverty, hardship, and the struggle for survival", "Science and technology", "Travel and exploration"], correct: 1 },
  { q: "What is the FSK?", options: ["A German fairy tale collection", "A type of dwarf character", "The German movie rating system", "A German comedy award"], correct: 2 },
  { q: "Why was the 7 Zwerge film extremely successful in Germany?", options: ["It was a Hollywood production", "It featured the 7 most famous German comedians", "It was funded by the German government", "It was the first German film ever made"], correct: 1 },
  { q: "Can the humor in 7 Zwerge easily translate to other cultures?", options: ["Yes, humor is universal", "No â€” humor is deeply culture-specific and may not translate", "Only to English-speaking cultures", "Only to other European cultures"], correct: 1 },
  { q: "What does 'der FroschkÃ¶nig' mean in English?", options: ["The Dwarf King", "The Frog Prince", "The Snow Queen", "The Magic Mirror"], correct: 1 },
  { q: "How does Disney relate to German fairy tales?", options: ["Disney invented all fairy tales", "Disney brings German fairy tales to global audiences but often Americanizes them", "Disney has no connection to fairy tales", "Disney only adapts French fairy tales"], correct: 1 },
];

const matchingPairs = [
  { term: "Schema Theory", def: "Cultural mental frameworks guiding interpretation" },
  { term: "Unexpected Helper", def: "Assists without asking anything in return" },
  { term: "Demonic Dwarf", def: "Abductor or manipulator (Rumpelstiltskin)" },
  { term: "Nibelungenlied", def: "Epic: treasure, invisibility, subjugation" },
  { term: "7 Zwerge", def: "Parody with insecure, awkward dwarfs" },
  { term: "Reciprocity", def: "Exchange central to dwarf-human interactions" },
  { term: "Situation Model", def: "Mental representation built during reading" },
  { term: "Top-Down Processing", def: "Using prior knowledge to interpret text" },
  { term: "FSK", def: "German movie rating system (Freiwillige Selbstkontrolle)" },
  { term: "Der FroschkÃ¶nig", def: "The Frog Prince â€” a key Grimm fairy tale" },
  { term: "Oral Origins", def: "Stories told by laborer women, not wealthy people" },
  { term: "German Nationalism", def: "Grimm tales used for cultural preservation" },
  { term: "Cultural Translatability", def: "Can humor cross cultural boundaries?" },
];

const essayQuestions = [
  { section: "â›ï¸ Dwarfs", q: "How does Stringham trace the development of dwarfs from medieval epics to Grimm fairy tales?", hints: ["Start with Rudlieb & Nibelungenlied", "Show how roles evolved over time", "End with Grimm's Romantic nationalism influence"],
    example: "Stringham traces the development of dwarf figures across centuries of German literature, beginning with early medieval texts and ending with the Grimm brothers' fairy tales. In the earliest known German dwarf narrative, <strong>Rudlieb</strong>, dwarfs appear as mysterious underground beings associated with treasure and mistrust â€” they are neither fully good nor evil, but exist in an ambiguous space between the human and supernatural worlds. Moving forward to the <strong>Nibelungenlied</strong>, dwarfs take on more defined roles connected to power, treasure, invisibility, and subjugation. In this epic, the dwarf Alberich is physically overpowered and forced into servitude, reflecting a medieval worldview in which dwarfs could be conquered and controlled by humans.\n\nAs Stringham shows, the transition from medieval epics to the Grimm brothers' <strong>Kinder- und HausmÃ¤rchen</strong> represents a significant shift in how dwarfs were portrayed. The Grimms, influenced by <strong>Romantic nationalism</strong>, revised and curated these stories as part of a larger project of cultural preservation. Their scholarly editing choices simplified and moralized dwarf characters â€” transforming them from the morally complex figures of medieval literature into more clearly defined helpers (as in Snow White) or villains (as in Rumpelstiltskin). This trajectory demonstrates that dwarf figures are not static archetypes but rather <strong>culturally constructed characters</strong> whose meanings shift according to the historical and ideological contexts in which they are written." },

  { section: "â›ï¸ Dwarfs", q: "Explain the significance of reciprocity in dwarf-human relationships.", hints: ["Define reciprocity in this context", "Give examples: Rumpelstiltskin, Elves & Shoemaker", "Discuss how exchange shapes narrative"],
    example: "Reciprocity â€” the principle of mutual exchange â€” is one of the most consistent and significant themes governing dwarf-human relationships across German fairy tales. In nearly every story involving dwarfs, interactions are structured around some form of <strong>give and take</strong>: dwarfs provide treasure, labor, protection, or knowledge, and in return they expect something of equal value.\n\nThis is most dramatically illustrated in <strong>Rumpelstiltskin</strong>, where the dwarf spins straw into gold for the miller's daughter but demands her firstborn child as payment. The story's tension hinges entirely on this exchange â€” the dwarf's help is never free, and the consequences of the bargain drive the entire plot. In contrast, <strong>The Elves and the Shoemaker</strong> presents a more benevolent form of reciprocity: the elves help the shoemaker secretly, and when the shoemaker and his wife reciprocate by making clothes for the elves, the relationship concludes harmoniously.\n\nThe significance of reciprocity extends beyond individual narratives. It reflects a broader cultural understanding that <strong>relationships with supernatural beings are contractual</strong> â€” they must be maintained through fairness and balance. When humans violate this principle (by being greedy, ungrateful, or deceptive), the consequences are severe. Reciprocity thus functions as both a <strong>narrative engine</strong> and a <strong>moral framework</strong>, reinforcing the idea that even magical help comes with obligations." },

  { section: "â›ï¸ Dwarfs", q: "Compare the dwarfs in Snow White to those in the Nibelungenlied.", hints: ["Snow White: miners, protectors, domestic stability", "Nibelungenlied: treasure, invisibility, subjugation", "What changed between these portrayals?"],
    example: "The dwarfs in <strong>Snow White</strong> and the <strong>Nibelungenlied</strong> represent fundamentally different conceptions of what dwarfs mean in German literature, reflecting the different contexts in which these texts were produced.\n\nIn the Nibelungenlied, a medieval heroic epic, the dwarf <strong>Alberich</strong> is a powerful figure associated with treasure, invisibility (through a magical cloak, the <em>Tarnkappe</em>), and subjugation. He is physically overpowered by Siegfried and forced into servitude â€” his role reflects a world of warfare, conquest, and the struggle for dominance. Dwarfs in this context are <strong>dangerous, autonomous beings</strong> who must be controlled through force.\n\nIn contrast, the dwarfs of <strong>Grimm's Snow White</strong> are gentle miners who take Snow White into their home and protect her from the evil queen. They represent <strong>domestic stability, labor, and communal care</strong>. Rather than hoarding treasure for power, they mine as honest workers. Rather than being conquered, they willingly offer shelter in exchange for Snow White's help with household tasks â€” a benevolent form of reciprocity.\n\nThe shift between these portrayals reflects broader changes in German culture: from the <strong>martial values of medieval epics</strong> to the <strong>domesticated, moralized world of Romantic-era fairy tales</strong>. The Grimms' editorial choices softened and simplified dwarf characters to serve their project of cultural preservation and moral education, transforming dwarfs from complex, threatening figures into reassuring symbols of honest labor and community." },

  { section: "â›ï¸ Dwarfs", q: "How do Grimm revisions shape modern perceptions of dwarfs?", hints: ["Romantic nationalism context", "Scholarly editing choices", "Impact on modern fairy tale reading"],
    example: "The Brothers Grimm's editorial revisions of their <strong>Kinder- und HausmÃ¤rchen</strong> (Children's and Household Tales) fundamentally shaped how modern audiences understand dwarf characters. Their work was not simply a neutral act of collection â€” it was a <strong>deliberate process of cultural curation</strong> influenced by Romantic nationalism.\n\nThe Grimms were working during a period of intense German nation-building, and they saw fairy tales as expressions of an authentic <strong>German cultural spirit</strong> (<em>Volksgeist</em>). Their scholarly editing choices reflected this ideology: across multiple editions, they revised stories to emphasize moral clarity, traditional values, and distinctly German cultural elements. Dwarf characters were simplified â€” they became either clearly helpful (as in Snow White and The Elves and the Shoemaker) or clearly threatening (as in Rumpelstiltskin), losing much of the <strong>moral ambiguity</strong> that characterized earlier portrayals.\n\nThese revisions have had lasting consequences. Because the Grimm versions became the most widely read and translated fairy tales in the world, their specific interpretations of dwarf characters became the <strong>default understanding</strong> for most modern readers. When people today think of fairy tale dwarfs, they overwhelmingly picture the helpful miners of Snow White â€” a portrayal that is largely a Grimm invention. The more complex, dangerous, and morally ambiguous dwarfs of medieval German literature (such as those in the Nibelungenlied or Rudlieb) have been largely forgotten by popular culture. In this way, Grimm revisions didn't just record tradition â€” they <strong>created</strong> the tradition that modern audiences take for granted." },

  { section: "â›ï¸ Dwarfs", q: "Why is mystery important to the enchantment of dwarf figures?", hints: ["Limited knowledge creates fascination", "Dwarfs exist at edges of human understanding", "Mystery preserves narrative power"],
    example: "Mystery is central to the enduring enchantment of dwarf figures in German fairy tales and mythology. Unlike human characters whose motivations and backgrounds are typically explained, dwarfs consistently exist at the <strong>edges of human understanding</strong> â€” they live underground, appear and disappear without explanation, and possess knowledge and abilities that remain unexplained.\n\nThis limited knowledge is precisely what makes dwarfs so narratively powerful. In stories like <strong>Snow White</strong>, we learn almost nothing about the dwarfs' inner lives, histories, or motivations beyond their daily mining routine. In <strong>Rumpelstiltskin</strong>, the dwarf's origins, powers, and reasons for wanting a child are never explained â€” the mystery of his character is what creates the story's tension and horror. If these gaps were filled, the characters would lose their <strong>uncanny quality</strong>.\n\nStringham argues that this mystery is not a flaw but a <strong>fundamental feature</strong> of dwarf figures. Dwarfs occupy a liminal space between the known and unknown, the natural and supernatural. They represent forces that humans can interact with but never fully comprehend. This incompleteness <strong>preserves their narrative power</strong> across centuries â€” because they are never fully explained, they can be endlessly reinterpreted by different cultures and time periods. The mystery of dwarfs is what allows them to remain enchanting rather than becoming ordinary." },

  { section: "ğŸ¬ Culture", q: "How does schema theory explain cultural differences in interpretation?", hints: ["Define schemata", "Explain culturally embedded frameworks", "Connect to measurable differences"],
    example: "Schema theory provides a powerful framework for understanding why readers from different cultural backgrounds interpret the same text in systematically different ways. <strong>Schemata</strong> are mental frameworks â€” organized structures of knowledge â€” that people develop through socialization within their culture. These frameworks guide how we process new information, including how we read and interpret stories.\n\nWhen a reader encounters a fairy tale, they don't simply decode the words on the page. Instead, they engage in <strong>top-down processing</strong>, using their existing cultural schemata to fill in gaps, evaluate characters, and construct a mental model of the story (a <strong>situation model</strong>). Because schemata are culturally embedded, readers from different cultures bring fundamentally different frameworks to the same text.\n\nFor example, a reader socialized in a <strong>Western individualist</strong> culture might interpret a character's independent decision-making as heroic and admirable, while a reader from an <strong>East Asian collectivist</strong> culture might view the same behavior as selfish or irresponsible. These aren't random differences â€” research has shown that they are <strong>patterned and statistically measurable</strong>. The inference-making processes that readers use to fill narrative gaps are shaped by culture at a deep cognitive level.\n\nSchema theory thus demonstrates that reading is <strong>never culturally neutral</strong>. Every act of interpretation is filtered through culturally specific mental frameworks, which is why the same fairy tale can carry entirely different meanings for different audiences." },

  { section: "ğŸ¬ Culture", q: "How does 7 Zwerge parody traditional heroism?", hints: ["Compare to Grimm's clear heroism", "Insecure, awkward dwarfs", "Collective, flawed heroism"],
    example: "The 2004 film <strong>7 Zwerge</strong> systematically parodies the traditional heroism found in Grimm's fairy tales by replacing moral clarity with comedy, and individual virtue with collective dysfunction.\n\nIn Grimm's <strong>Snow White</strong>, heroism is straightforward: the dwarfs are dutiful protectors, the prince is a noble rescuer, and good triumphs over evil through clear moral structures. Characters know their roles, and the narrative rewards virtue and punishes wickedness. Heroism in this framework is <strong>individual, moral, and clearly defined</strong>.\n\n<strong>7 Zwerge</strong> inverts all of this. The dwarfs are not brave protectors but <strong>insecure, socially awkward misfits</strong> who stumble into heroism accidentally. Each dwarf's personality â€” played by one of Germany's most famous comedians â€” is built around comedic flaws rather than virtues. They argue with each other, fail at basic tasks, and are frequently confused about what they're supposed to do.\n\nHeroism in 7 Zwerge is therefore <strong>collective and flawed</strong> rather than individual and virtuous. The dwarfs succeed not because any one of them is particularly brave or skilled, but because they muddle through together as a dysfunctional group. This parody <strong>destabilizes traditional expectations of masculinity and heroism</strong>, showing that these concepts are culturally constructed rather than natural or inevitable. By making heroism comedic, the film invites audiences to question the fairy tale conventions they take for granted." },

  { section: "ğŸ¬ Culture", q: "What evidence supports culture influencing inference-making?", hints: ["Statistically significant results", "Different situation models across cultures", "Deep cognitive processes affected"],
    example: "The scholarly article examined in this module provides compelling evidence that culture influences the deep cognitive processes involved in reading, particularly <strong>inference-making</strong> â€” the process by which readers fill in gaps that a narrative doesn't explicitly state.\n\nThe researchers designed studies comparing how readers from <strong>Western (individualist)</strong> and <strong>East Asian (collectivist)</strong> cultural backgrounds interpreted the same fairy tale narratives. Their hypotheses predicted that Western readers would generate inferences emphasizing individual agency, independence, and personal achievement, while East Asian readers would generate inferences emphasizing social harmony, group responsibility, and relational dynamics.\n\nThe results showed <strong>statistically significant differences</strong> in how the two groups constructed their <strong>situation models</strong> â€” the mental representations of characters, events, time, and space that readers build while reading. These were not superficial differences in preference or opinion; they reflected fundamentally different cognitive processes operating at the level of <strong>how meaning is constructed</strong> from text.\n\nThis evidence is significant because it demonstrates that inference-making is not a universal, culture-free cognitive process. Rather, it is <strong>shaped by the culturally embedded schemata</strong> that readers bring to the text. The implication for literary studies is profound: any analysis of how readers understand fairy tales (or any narrative) is incomplete if it does not account for <strong>culture as a variable</strong>." },

  { section: "ğŸ¬ Culture", q: "How does individualism vs. collectivism affect character evaluation?", hints: ["Western: independence & initiative admired", "East Asian: harmony & social responsibility", "Same character judged differently"],
    example: "The cultural framework of <strong>individualism vs. collectivism</strong> has a direct and measurable effect on how readers evaluate characters in fairy tales. This framework, drawn from cross-cultural psychology, describes fundamental differences in how cultures define the relationship between individuals and their communities.\n\nIn <strong>individualist cultures</strong> (predominant in Western societies like Germany and the United States), independence, personal initiative, and self-reliance are highly valued. When readers from these cultures encounter a fairy tale character who acts boldly on their own â€” defying authority, pursuing personal goals, or demonstrating individual cleverness â€” they tend to evaluate that character <strong>positively</strong>, seeing them as heroic and admirable.\n\nIn <strong>collectivist cultures</strong> (predominant in East Asian societies like China, Japan, and Korea), social harmony, group loyalty, and fulfilling one's responsibilities to others are prioritized. Readers from these cultures might evaluate the <strong>same character negatively</strong> â€” seeing their independent behavior as selfish, disruptive, or irresponsible toward the community.\n\nThis means that a character like Snow White, the prince, or even the dwarfs can carry <strong>entirely different moral weight</strong> depending on the reader's cultural background. The dwarfs' communal lifestyle might resonate positively with collectivist readers, while a Western reader might focus more on Snow White's individual journey. These differences are not random â€” they are <strong>systematic and culturally structured</strong>, demonstrating that character evaluation is always filtered through cultural values." },

  { section: "ğŸ¬ Culture", q: "Why should culture be a variable in literary studies?", hints: ["Interpretation is not neutral", "Patterned, measurable differences", "Missing culture = incomplete analysis"],
    example: "The research examined in this module makes a strong case that culture should be treated as a <strong>fundamental variable</strong> in literary studies, not an afterthought or optional consideration.\n\nThe core argument is straightforward: if <strong>interpretation is not neutral</strong> â€” if how readers understand characters, evaluate moral choices, and fill in narrative gaps is shaped by their cultural background â€” then any literary analysis that ignores culture is inherently incomplete. The research demonstrates this empirically: readers from different cultural backgrounds construct <strong>systematically different situation models</strong> when reading the same texts, and these differences are <strong>patterned and statistically measurable</strong>.\n\nWithout accounting for culture, literary scholars risk several errors. First, they may <strong>universalize their own culturally specific readings</strong>, assuming that their interpretation is the 'correct' or 'natural' one. Second, they may miss the ways in which a text's meaning <strong>changes across cultural contexts</strong> â€” the same fairy tale can function as a story about individual triumph in one culture and communal responsibility in another. Third, they may fail to understand why <strong>adaptations and retellings</strong> transform stories in the ways they do.\n\nIncluding culture as a variable doesn't mean that all interpretations are equally valid or that textual analysis is impossible. Rather, it means acknowledging that <strong>reading is a culturally situated act</strong> and that robust literary scholarship must account for the cultural frameworks that readers bring to texts. This is especially important for fairy tales, which travel across cultures more than almost any other literary form." },

  { section: "ğŸ¤ Lecture", q: "How are language, culture, and humor interconnected in the context of fairy tales?", hints: ["Humor depends on shared cultural knowledge", "Language carries cultural meaning", "Fairy tales use culturally-specific humor"],
    example: "Language, culture, and humor form a deeply interconnected triad that is essential to understanding how fairy tales function â€” and how they change when they move across cultural boundaries.\n\n<strong>Language</strong> is never merely a neutral tool for communication. It carries cultural meanings, associations, connotations, and wordplay that are specific to the community that speaks it. When a fairy tale is told in German, it draws on specifically German linguistic resources â€” puns, idioms, rhythms, and references that may have no equivalent in other languages.\n\n<strong>Culture</strong> provides the shared knowledge base that makes communication meaningful. Fairy tales rely on culturally embedded assumptions about morality, social roles, family structures, and what counts as funny, frightening, or meaningful. A German audience hearing a fairy tale brings a set of cultural expectations that differ from those of a French, Japanese, or American audience.\n\n<strong>Humor</strong> sits at the intersection of language and culture and is therefore one of the most difficult elements to translate. Humor depends on <strong>shared expectations that can be subverted</strong> â€” if the audience doesn't share the cultural expectation, the joke falls flat. This is why the <strong>7 Zwerge</strong> film was enormously successful in Germany (where audiences recognized both the fairy tale conventions being parodied and the comedians performing them) but would be much harder to translate for an international audience.\n\nIn the context of fairy tales, this triad demonstrates that stories are never culturally free-floating â€” they are always <strong>rooted in specific linguistic and cultural contexts</strong> that shape their meaning and reception." },

  { section: "ğŸ¤ Lecture", q: "Why were Grimm's fairy tales not originally intended for children?", hints: ["Oral origins from laborers/working women", "Themes of poverty, hardship, survival", "Dark/violent content reflected real life"],
    example: "Although Grimm's fairy tales are now overwhelmingly associated with children's literature, they were <strong>not originally intended for children</strong>. Understanding why requires examining their origins and the social contexts from which they emerged.\n\nThe stories collected by the Brothers Grimm came from <strong>oral tradition</strong> â€” they were told by <strong>laborer women who worked in kitchens</strong>, not by wealthy or educated women. These storytellers came from backgrounds of <strong>hunger and poverty</strong>, and their stories reflected these realities. Themes of scarcity, danger, abandonment, and the struggle for survival were not literary devices â€” they were descriptions of actual conditions faced by the people who told these tales.\n\nThis is why early versions of Grimm fairy tales contain content that modern readers find shockingly dark: children abandoned in forests because their parents cannot feed them (Hansel and Gretel), violent punishments including death by torture (the evil queen in Snow White is forced to dance in red-hot iron shoes), and threats to children's lives that are graphic and disturbing.\n\nThe <strong>dark and sometimes violent nature</strong> of these tales stems directly from their origins as stories told by and for adults living in harsh conditions. They served as warnings, moral instruction, and entertainment for communities that faced real dangers daily.\n\nIt was only through the Grimms' own <strong>editorial revisions</strong> across multiple editions â€” and later through Disney's sanitized adaptations â€” that these stories were gradually softened and repositioned as children's literature. The transformation from adult oral tradition to children's bedtime stories is itself a powerful example of how <strong>cultural context reshapes narrative</strong>." },

  { section: "ğŸ¤ Lecture", q: "How do Grimm's fairy tales relate to German nationalism and cultural preservation?", hints: ["Used as means of cultural preservation", "Associated with rise of German nationalism", "Reflect cultural history of German people"],
    example: "The Brothers Grimm's fairy tale collection was deeply intertwined with the rise of <strong>German nationalism</strong> in the 19th century. Their work was not simply an academic exercise in folklore â€” it was a <strong>political and cultural project</strong> aimed at defining and preserving a distinctly German cultural identity.\n\nDuring the early 1800s, the German-speaking lands were politically fragmented into dozens of small states. There was no unified 'Germany' â€” but there was a growing movement among intellectuals and nationalists to identify a shared <strong>German cultural spirit</strong> (<em>Volksgeist</em>) that could serve as the foundation for eventual political unity. The Grimms believed that fairy tales, as expressions of an authentic oral tradition passed down through generations of common people, represented the purest form of this cultural spirit.\n\nBy collecting, editing, and publishing these tales in their <strong>Kinder- und HausmÃ¤rchen</strong>, the Grimms were actively engaged in <strong>cultural preservation</strong> â€” rescuing stories they feared would be lost to modernization and foreign cultural influence. Their editorial choices reflected this nationalist agenda: they emphasized themes they saw as distinctly German, removed elements they considered foreign, and gradually shaped the tales to project an image of German culture as morally serious, hardworking, and rooted in tradition.\n\nThe fairy tales thus served a dual purpose: they preserved cultural heritage while also <strong>constructing a national identity</strong>. The stories reflected the cultural history and experience of the German people â€” their poverty, their values, their relationship with nature and the supernatural â€” and presented this history as something worthy of pride and protection. This is why Grimm's fairy tales became such powerful symbols of German culture, a status they retain to this day." },

  { section: "ğŸ¤ Lecture", q: "Can the humor in 7 Zwerge be translated to other cultures? Why or why not?", hints: ["Humor is deeply culture-specific", "Film stars 7 famous German comedians", "Cultural references may not transfer"],
    example: "The question of whether the humor in <strong>7 Zwerge</strong> can be translated to other cultures gets at a fundamental truth about comedy: <strong>humor is deeply culture-specific</strong>, and what makes something funny depends on shared cultural knowledge that cannot always cross borders.\n\nSeveral factors make the humor in 7 Zwerge particularly resistant to cultural translation. First, the film stars the <strong>7 most famous German comedians</strong> of the time, each of whom brought their established comedic personas to their dwarf characters. For German audiences, much of the humor came from recognizing these familiar performers in absurd fairy tale roles. International audiences without this context would miss this entire layer of comedy.\n\nSecond, the film's humor depends on <strong>subverting expectations about Grimm's Snow White</strong> â€” a story that holds a specific cultural status in Germany as part of the national literary heritage. The parody works because German audiences have a deep, culturally embedded relationship with these fairy tales. Audiences from cultures where Snow White is known primarily through Disney would bring different expectations, making many of the jokes less effective.\n\nThird, <strong>comedic styles and timing vary across cultures</strong>. What Germans find funny â€” including specific types of slapstick, irony, and self-deprecating humor â€” may not align with comedic sensibilities in other countries.\n\nThis does not mean the film has zero appeal internationally, but it does mean that its <strong>full comedic impact is culturally bounded</strong>. The film's enormous success in Germany and more modest international reception illustrates exactly how language, culture, and humor are interconnected â€” and why fairy tale adaptations always carry the cultural fingerprint of the society that produces them." },

  { section: "ğŸ¤ Lecture", q: "How does the journey from Grimm â†’ Disney â†’ Eurodisney illustrate cultural adaptation?", hints: ["Original stories were dark and harsh", "Disney sanitizes and Americanizes", "Eurodisney brings it back to Europe in changed form"],
    example: "The journey of fairy tales from <strong>Grimm â†’ Disney â†’ Eurodisney</strong> provides a remarkable case study in how stories are transformed as they move across cultural boundaries and historical periods.\n\n<strong>Stage 1: Grimm's Originals.</strong> The Brothers Grimm collected stories from German oral tradition â€” tales rooted in poverty, hardship, and survival. These stories were dark, sometimes violent, and carried moral lessons shaped by specifically German cultural values. They were products of a nationalist project aimed at preserving German cultural identity.\n\n<strong>Stage 2: Disney's Americanization.</strong> When Walt Disney adapted stories like Snow White (1937), he fundamentally transformed them. Disney <strong>sanitized</strong> the darker elements, added musical numbers and romantic storylines, and reframed the narratives through an <strong>American cultural lens</strong> emphasizing optimism, individual achievement, and happy endings. The dwarfs in Disney's Snow White were given individual, comedic personalities â€” a significant departure from Grimm's undifferentiated group of miners. Disney's versions became the globally dominant versions, effectively replacing Grimm in popular consciousness for much of the world.\n\n<strong>Stage 3: Eurodisney.</strong> When Disneyland opened in Paris as Eurodisney (now Disneyland Paris), it brought these already-Americanized fairy tales <strong>back to Europe in changed form</strong>. European audiences â€” including German audiences â€” now encountered their own cultural heritage filtered through American commercial entertainment. The stories had come full circle, but they were no longer the same stories.\n\nThis journey illustrates several key principles: fairy tales are <strong>adaptable narratives</strong> shaped by their cultural context; each retelling reflects the values of the culture producing it; and cultural adaptation is not a neutral process but one that <strong>transforms meaning</strong>. The dark German tales of poverty became bright American tales of individual triumph, which then became global commercial entertainment â€” demonstrating that no fairy tale exists outside of culture." },
];

// ============================================
// STATE
// ============================================
let xp = 0, level = 1, streak = 0, bestStreak = 0;
let topicsChecked = new Set();
const totalTopics = 15;

// Flashcard state
let fcIndex = 0, fcKnown = new Set();
let fcOrder = [...Array(flashcardData.length).keys()];

// Quiz state
let quizIndex = 0, quizCorrect = 0, quizAnswered = new Set();
let quizOrder = [...Array(quizData.length).keys()].sort(() => Math.random() - 0.5);

// Matching state
let matchSelected = null, matchedPairs = new Set(), matchStartTime = null, matchTimerInterval = null;

// Timer state
let timerMinutes = 25, timerSeconds = 0, timerRunning = false, timerInterval = null, timerTotalSeconds = 25 * 60;

// Achievements
let achievements = new Set();

// ============================================
// UTILITIES
// ============================================

function addXP(amount) {
  xp += amount;
  const xpForLevel = level * 100;
  const container = document.getElementById('xp-fly-container');
  const fly = document.createElement('div');
  fly.className = 'animate-xp-fly font-mono font-bold text-amber-400 text-sm';
  fly.textContent = `+${amount} XP`;
  container.appendChild(fly);
  setTimeout(() => fly.remove(), 1200);

  if (xp >= xpForLevel) {
    xp -= xpForLevel;
    level++;
    document.getElementById('level-display').textContent = `Lv ${level}`;
    showAchievement('ğŸ‘‘', 'Level Up!', `You reached Level ${level}!`);
    confetti({ particleCount: 150, spread: 90, origin: { y: 0.6 }, colors: ['#fbbf24', '#f97316', '#ef4444', '#a78bfa', '#38bdf8'] });
  }
  document.getElementById('xp-display').textContent = `${xp} XP`;
  document.getElementById('xp-bar').style.width = `${(xp / (level * 100)) * 100}%`;
}

function updateStreak(correct) {
  if (correct) {
    streak++;
    if (streak > bestStreak) bestStreak = streak;
    if (streak === 3 && !achievements.has('s3')) { achievements.add('s3'); showAchievement('â›ï¸', '3 Gems Found!', 'Three in a row â€” the mine glows!'); }
    if (streak === 5 && !achievements.has('s5')) { achievements.add('s5'); showAchievement('ï¿½ï¿½', '5 Streak!', "Sunny says: You're shining bright!"); }
    if (streak === 10 && !achievements.has('s10')) { achievements.add('s10'); showAchievement('ï¿½', 'MINE KING!', 'Tschakko salutes your 10 streak!'); }
  } else { streak = 0; }
  document.getElementById('streak-count').textContent = streak;
}

function showAchievement(icon, title, desc) {
  const toast = document.getElementById('achievement-toast');
  document.getElementById('achievement-icon').textContent = icon;
  document.getElementById('achievement-title').textContent = title;
  document.getElementById('achievement-desc').textContent = desc;
  toast.classList.remove('hidden'); toast.classList.add('flex');
  confetti({ particleCount: 40, spread: 60, origin: { y: 0.2 }, colors: ['#fbbf24', '#a78bfa'] });
  setTimeout(() => { toast.classList.add('hidden'); toast.classList.remove('flex'); }, 3500);
}

function scrollToTop() { window.scrollTo({ top: 0, behavior: 'smooth' }); }

function showStreakInfo() {
  if (bestStreak > 0) showAchievement('ğŸ”¥', `Best Streak: ${bestStreak}`, `Current: ${streak}`);
}

// ============================================
// MODE SWITCHING
// ============================================

function switchMode(mode) {
  document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
  document.getElementById(`view-${mode}`).classList.remove('hidden');

  document.querySelectorAll('.mode-btn').forEach(btn => {
    btn.className = 'mode-btn px-4 sm:px-5 py-2.5 rounded-xl font-display font-bold text-sm transition-all flex items-center gap-2 bg-white/5 border-2 border-white/10 text-gray-400 hover:border-white/30';
  });
  const colors = {
    study: 'bg-amber-500/20 border-amber-500 text-amber-300 shadow-[0_0_15px_rgba(245,158,11,0.2)]',
    flashcards: 'bg-sky-500/20 border-sky-500 text-sky-300 shadow-[0_0_15px_rgba(56,189,248,0.2)]',
    quiz: 'bg-yellow-500/20 border-yellow-500 text-yellow-300 shadow-[0_0_15px_rgba(234,179,8,0.2)]',
    matching: 'bg-red-500/20 border-red-500 text-red-300 shadow-[0_0_15px_rgba(239,68,68,0.2)]',
    essay: 'bg-indigo-500/20 border-indigo-500 text-indigo-300 shadow-[0_0_15px_rgba(99,102,241,0.2)]',
    notes: 'bg-emerald-500/20 border-emerald-500 text-emerald-300 shadow-[0_0_15px_rgba(16,185,129,0.2)]',
    cheatsheet: 'bg-rose-500/20 border-rose-500 text-rose-300 shadow-[0_0_15px_rgba(244,63,94,0.2)]',
    blastgames: 'bg-fuchsia-500/20 border-fuchsia-500 text-fuchsia-300 shadow-[0_0_15px_rgba(217,70,239,0.2)]'
  };
  document.getElementById(`mode-${mode}`).className = `mode-btn px-4 sm:px-5 py-2.5 rounded-xl font-display font-bold text-sm transition-all flex items-center gap-2 ${colors[mode]} border-2`;

  if (mode === 'flashcards') renderFlashcard();
  if (mode === 'quiz') renderQuiz();
  if (mode === 'matching') initMatching();
  if (mode === 'essay') renderEssay();
  scrollToTop();
}

// ============================================
// STUDY MODE
// ============================================

function toggleTopic(btn) {
  const card = btn.closest('.study-card');
  const content = card.querySelector('.topic-content');
  const arrow = card.querySelector('.topic-arrow');
  const check = card.querySelector('.topic-check');
  const topicKey = card.dataset.topic;
  const isOpen = !content.classList.contains('hidden');

  if (isOpen) {
    content.classList.add('hidden');
    arrow.style.transform = 'rotate(0deg)';
    if (!topicsChecked.has(topicKey)) {
      topicsChecked.add(topicKey);
      check.dataset.checked = 'true';
      check.querySelector('.check-icon').classList.remove('hidden');
      check.querySelector('.uncheck-icon').classList.add('hidden');
      check.classList.add('bg-green-500/30', 'border-green-500/50');
      check.classList.remove('bg-amber-500/20', 'border-amber-500/40', 'bg-purple-500/20', 'border-purple-500/40', 'bg-green-500/20', 'border-green-500/40');
      addXP(10);
      updateStudyProgress();
    }
  } else {
    content.classList.remove('hidden');
    arrow.style.transform = 'rotate(90deg)';
    content.style.animation = 'slide-up 0.3s ease-out';
  }
}

function updateStudyProgress() {
  const pct = Math.round((topicsChecked.size / totalTopics) * 100);
  document.getElementById('study-progress-pct').textContent = `${pct}%`;
  document.getElementById('study-progress-bar').style.width = `${pct}%`;
  if (pct === 100 && !achievements.has('allTopics')) {
    achievements.add('allTopics');
    showAchievement('ğŸ’', 'Master Miner!', 'You reviewed all study topics! The dwarfs are proud!');
    confetti({ particleCount: 200, spread: 120, origin: { y: 0.5 } });
  }
}

// ============================================
// FLASHCARDS
// ============================================

const dwarfEncouragements = [
  "â˜ï¸ Cloudy whispers: \"You're doing great, keep dreaming big!\"",
  "â›ï¸ Tschakko grunts: \"Tough stuff, but you're tougher!\"",
  "â˜€ï¸ Sunny beams: \"Your knowledge is shining brighter!\"",
  "ğŸ˜Š Bubi cheers: \"Every card is a step forward!\"",
  "ğŸª Cookie offers: \"Study snack? You've earned it!\"",
  "âš¡ Speedy zips by: \"Quick learner! Keep that pace!\"",
  "ğŸ¤¨ Ralfie admits: \"Okay, I'm actually impressed...\"",
  "ğŸ’ The mine glows brighter with each card you learn!",
  "â›ï¸ You're digging deeper into knowledge â€” the dwarfs are proud!",
  "ğŸ”ï¸ Almost at the top of the mountain! Keep climbing!",
];

function renderFcDots() {
  const dotsEl = document.getElementById('fc-dots');
  if (!dotsEl) return;
  dotsEl.innerHTML = fcOrder.map((realIdx, i) => {
    let cls = 'fc-dot';
    if (i === fcIndex) cls += ' active';
    if (fcKnown.has(realIdx)) cls += ' known';
    return `<div class="${cls}" title="Card ${i+1}"></div>`;
  }).join('');
}

function showEncouragement() {
  const el = document.getElementById('fc-encouragement');
  if (!el) return;
  el.style.opacity = '0';
  setTimeout(() => {
    el.textContent = dwarfEncouragements[Math.floor(Math.random() * dwarfEncouragements.length)];
    el.style.opacity = '1';
  }, 200);
}

function renderFlashcard() {
  if (fcOrder.length === 0) return;
  const data = flashcardData[fcOrder[fcIndex]];
  document.getElementById('flashcard').classList.remove('flipped');
  document.getElementById('fc-front').textContent = data.q;
  document.getElementById('fc-back').textContent = data.a;
  document.getElementById('fc-category').textContent = data.category;
  document.getElementById('fc-progress').textContent = `${fcIndex + 1} / ${fcOrder.length}`;
  document.getElementById('fc-known').textContent = `${fcKnown.size} known`;
  const remainEl = document.getElementById('fc-remaining');
  if (remainEl) remainEl.textContent = `${fcOrder.length - fcKnown.size} left`;
  renderFcDots();
}

function flipCard() { document.getElementById('flashcard').classList.toggle('flipped'); }
function nextCard() { fcIndex = (fcIndex + 1) % fcOrder.length; renderFlashcard(); if (Math.random() < 0.3) showEncouragement(); }
function prevCard() { fcIndex = (fcIndex - 1 + fcOrder.length) % fcOrder.length; renderFlashcard(); }

function markKnown() {
  const realIdx = fcOrder[fcIndex];
  if (!fcKnown.has(realIdx)) { fcKnown.add(realIdx); addXP(5); updateStreak(true); showEncouragement(); }
  fcOrder.splice(fcIndex, 1);
  if (fcOrder.length === 0) {
    showAchievement('ğŸƒ', 'Cloudy is Proud!', 'You mastered all the flashcards!');
    fcOrder = [...Array(flashcardData.length).keys()]; fcKnown.clear(); fcIndex = 0;
  } else { fcIndex = fcIndex % fcOrder.length; }
  renderFlashcard();
}

function shuffleCards() {
  fcOrder.sort(() => Math.random() - 0.5); fcIndex = 0; renderFlashcard();
  const c = document.getElementById('flashcard'); c.style.animation = 'none'; c.offsetHeight; c.style.animation = 'wiggle 0.4s ease';
}

document.addEventListener('keydown', (e) => {
  if (document.getElementById('view-flashcards').classList.contains('hidden')) return;
  if (e.key === 'ArrowRight') nextCard();
  if (e.key === 'ArrowLeft') prevCard();
  if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); flipCard(); }
});

// ============================================
// QUIZ
// ============================================

function renderQuiz() {
  if (quizAnswered.size >= quizOrder.length) { renderQuizResults(); return; }
  const idx = quizOrder[quizIndex];
  const data = quizData[idx];
  const container = document.getElementById('quiz-container');
  document.getElementById('quiz-results').classList.add('hidden');
  container.classList.remove('hidden');
  document.getElementById('quiz-progress').textContent = `Question ${quizAnswered.size + 1} / ${quizOrder.length}`;
  document.getElementById('quiz-score').textContent = `${quizCorrect} correct`;

  const optionsHtml = data.options.map((opt, i) => `
    <button onclick="answerQuiz(${i}, ${data.correct})" class="quiz-option w-full text-left p-5 sm:p-6 rounded-2xl glass border-2 border-white/10 hover:border-amber-500/40 hover:bg-amber-500/5 transition-all text-base sm:text-lg text-gray-200 flex items-center gap-4 group" data-idx="${i}">
      <span class="w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-white/10 border border-white/20 flex items-center justify-center text-sm sm:text-base font-bold text-gray-400 flex-shrink-0 group-hover:bg-amber-500/20 group-hover:text-amber-300 transition">${['A','B','C','D'][i]}</span>
      <span class="leading-snug">${opt}</span>
    </button>
  `).join('');

  container.innerHTML = `
    <div class="animate-slide-up">
      <div class="glass-strong rounded-2xl p-6 sm:p-10 border border-amber-500/10">
        <p class="font-display font-bold text-xl sm:text-2xl text-white mb-8 leading-snug">${data.q}</p>
        <div class="space-y-3 sm:space-y-4" id="quiz-options">${optionsHtml}</div>
        <div id="quiz-feedback" class="hidden mt-6"></div>
      </div>
    </div>`;
}

function answerQuiz(selected, correct) {
  if (quizAnswered.has(quizOrder[quizIndex])) return;
  quizAnswered.add(quizOrder[quizIndex]);
  const buttons = document.querySelectorAll('.quiz-option');
  const isCorrect = selected === correct;

  buttons.forEach((btn, i) => {
    btn.style.pointerEvents = 'none';
    if (i === correct) { btn.classList.remove('border-white/10'); btn.classList.add('border-green-500', 'bg-green-500/10'); }
    if (i === selected && !isCorrect) { btn.classList.remove('border-white/10'); btn.classList.add('border-red-500', 'bg-red-500/10', 'animate-shake'); }
  });

  const feedback = document.getElementById('quiz-feedback');
  feedback.classList.remove('hidden');
  if (isCorrect) {
    quizCorrect++; addXP(15); updateStreak(true);
    feedback.innerHTML = `<div class="flex items-center gap-4 bg-green-500/10 border-2 border-green-500/20 rounded-2xl p-5"><span class="text-3xl">ğŸ’</span><div><p class="text-green-300 font-bold text-base">Correct! Speedy is impressed! +15 XP</p><p class="text-gray-400 text-sm mt-1">Streak: ${streak} ğŸ”¥</p></div></div>`;
    confetti({ particleCount: 30, spread: 50, origin: { y: 0.8 }, colors: ['#fbbf24', '#f97316', '#34d399'] });
  } else {
    updateStreak(false);
    feedback.innerHTML = `<div class="flex items-center gap-4 bg-red-500/10 border-2 border-red-500/20 rounded-2xl p-5"><span class="text-3xl">ğŸ¤¨</span><div><p class="text-red-300 font-bold text-base">Not quite!</p><p class="text-gray-400 text-sm mt-1">Ralfie says: "Check the green answer &amp; try again!" ğŸ’ª</p></div></div>`;
  }
  feedback.innerHTML += `<button onclick="nextQuizQuestion()" class="mt-5 px-8 py-3.5 rounded-2xl bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold text-base hover:opacity-90 transition inline-flex items-center gap-2 shadow-lg shadow-amber-500/20">${quizAnswered.size >= quizOrder.length ? 'ğŸ’ See Results' : 'â†’ Next Question'}</button>`;
  document.getElementById('quiz-score').textContent = `${quizCorrect} correct`;
}

function nextQuizQuestion() {
  if (quizAnswered.size >= quizOrder.length) { renderQuizResults(); return; }
  quizIndex = (quizIndex + 1) % quizOrder.length;
  while (quizAnswered.has(quizOrder[quizIndex])) quizIndex = (quizIndex + 1) % quizOrder.length;
  renderQuiz();
}

function renderQuizResults() {
  document.getElementById('quiz-container').classList.add('hidden');
  const results = document.getElementById('quiz-results');
  results.classList.remove('hidden');
  const pct = Math.round((quizCorrect / quizOrder.length) * 100);
  let grade, emoji, color;
  if (pct >= 90) { grade = 'A+'; emoji = 'ğŸ†'; color = 'text-amber-400'; }
  else if (pct >= 80) { grade = 'A'; emoji = 'ğŸŒŸ'; color = 'text-green-400'; }
  else if (pct >= 70) { grade = 'B'; emoji = 'ğŸ‘'; color = 'text-blue-400'; }
  else if (pct >= 60) { grade = 'C'; emoji = 'ğŸ“š'; color = 'text-purple-400'; }
  else { grade = 'Keep Studying!'; emoji = 'ğŸ’ª'; color = 'text-pink-400'; }
  if (pct === 100 && !achievements.has('perfect')) { achievements.add('perfect'); showAchievement('ï¿½', 'Perfect Score!', 'All 7 Zwerge bow to your knowledge!'); }
  confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
  results.innerHTML = `<div class="glass-strong rounded-2xl p-8 text-center animate-pop border border-amber-500/10"><span class="text-6xl">${emoji}</span><h3 class="font-display font-bold text-3xl ${color} mt-4">${grade}</h3><p class="text-gray-300 text-lg mt-2">${quizCorrect} / ${quizOrder.length} correct (${pct}%)</p><p class="text-gray-500 text-sm mt-1">Best streak: ${bestStreak} ğŸ”¥</p><button onclick="resetQuiz()" class="mt-6 px-8 py-3 rounded-xl bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold hover:opacity-90 transition inline-flex items-center gap-2">â›ï¸ Mine Again</button></div>`;
}

function resetQuiz() {
  quizIndex = 0; quizCorrect = 0; quizAnswered.clear();
  quizOrder.sort(() => Math.random() - 0.5); streak = 0;
  document.getElementById('streak-count').textContent = '0'; renderQuiz();
}

// ============================================
// MATCHING GAME
// ============================================

function initMatching() {
  matchedPairs = new Set(); matchSelected = null; matchStartTime = Date.now();
  if (matchTimerInterval) clearInterval(matchTimerInterval);
  matchTimerInterval = setInterval(updateMatchTimer, 1000);
  const container = document.getElementById('matching-container');
  const terms = matchingPairs.map((p, i) => ({ text: p.term, idx: i })).sort(() => Math.random() - 0.5);
  const defs = matchingPairs.map((p, i) => ({ text: p.def, idx: i })).sort(() => Math.random() - 0.5);

  container.innerHTML = `
    <div class="space-y-3">
      <h3 class="text-blue-400 font-display font-bold text-sm uppercase tracking-wider mb-3 flex items-center gap-2">ğŸ“ Terms <span class="text-xs text-gray-500 font-normal normal-case">(tap one)</span></h3>
      ${terms.map(t => `<button onclick="selectMatch(this,'term',${t.idx})" class="match-item w-full text-left p-5 rounded-2xl glass border-2 border-white/10 hover:border-blue-500/40 hover:bg-blue-500/5 transition-all text-base" data-type="term" data-idx="${t.idx}"><span class="text-blue-300 font-bold text-base sm:text-lg">${t.text}</span></button>`).join('')}
    </div>
    <div class="space-y-3">
      <h3 class="text-pink-400 font-display font-bold text-sm uppercase tracking-wider mb-3 flex items-center gap-2">ğŸ’¡ Definitions <span class="text-xs text-gray-500 font-normal normal-case">(then tap match)</span></h3>
      ${defs.map(d => `<button onclick="selectMatch(this,'def',${d.idx})" class="match-item w-full text-left p-5 rounded-2xl glass border-2 border-white/10 hover:border-pink-500/40 hover:bg-pink-500/5 transition-all text-base text-gray-300" data-type="def" data-idx="${d.idx}">${d.text}</button>`).join('')}
    </div>`;
  updateMatchScore();
}

function selectMatch(el, type, idx) {
  if (el.dataset.matched) return;
  if (matchSelected && matchSelected.type === type) {
    matchSelected.el.classList.remove('border-amber-400', 'bg-amber-500/10', 'ring-2', 'ring-amber-400/30');
    matchSelected.el.classList.add('border-white/10');
  }
  if (!matchSelected || matchSelected.type === type) {
    if (matchSelected && matchSelected.type !== type) {} else {
      matchSelected = { el, type, idx };
      el.classList.remove('border-white/10'); el.classList.add('border-amber-400', 'bg-amber-500/10', 'ring-2', 'ring-amber-400/30');
      return;
    }
  }
  // Check match
  if (matchSelected.idx === idx) {
    matchedPairs.add(idx);
    [matchSelected.el, el].forEach(e => {
      e.classList.remove('border-white/10', 'border-amber-400', 'bg-amber-500/10', 'ring-2', 'ring-amber-400/30');
      e.classList.add('border-green-500/40', 'bg-green-500/10', 'opacity-60');
      e.style.pointerEvents = 'none'; e.dataset.matched = 'true';
    });
    addXP(10); updateStreak(true);
    confetti({ particleCount: 20, spread: 40, origin: { y: 0.7 }, colors: ['#34d399'] });
    if (matchedPairs.size === matchingPairs.length) {
      clearInterval(matchTimerInterval);
      const elapsed = Math.round((Date.now() - matchStartTime) / 1000);
      showAchievement('ğŸ§©', 'Bubi Cheers!', `All matched in ${elapsed}s! The mine is clear!`);
      confetti({ particleCount: 150, spread: 100 });
    }
  } else {
    updateStreak(false);
    [matchSelected.el, el].forEach(e => {
      e.classList.add('animate-shake', 'border-red-500', 'bg-red-500/10');
      setTimeout(() => {
        e.classList.remove('animate-shake', 'border-red-500', 'bg-red-500/10', 'border-amber-400', 'bg-amber-500/10', 'ring-2', 'ring-amber-400/30');
        e.classList.add('border-white/10');
      }, 500);
    });
  }
  matchSelected = null; updateMatchScore();
}

function updateMatchScore() { document.getElementById('match-score').textContent = `${matchedPairs.size} / ${matchingPairs.length} matched`; }

function updateMatchTimer() {
  if (!matchStartTime) return;
  const s = Math.round((Date.now() - matchStartTime) / 1000);
  document.getElementById('match-timer').textContent = `${Math.floor(s/60)}:${(s%60).toString().padStart(2,'0')}`;
}

// ============================================
// ESSAY PREP
// ============================================

function renderEssay() {
  document.getElementById('essay-container').innerHTML = essayQuestions.map((eq, i) => `
    <div class="glass rounded-2xl overflow-hidden transition-all adhd-focus">
      <button onclick="toggleEssay(this)" class="w-full p-5 sm:p-6 flex items-start gap-3 sm:gap-4 text-left group">
        <span class="tag ${eq.section.includes('Dwarf') ? 'bg-amber-500/20 text-amber-300 border border-amber-500/20' : eq.section.includes('Lecture') ? 'bg-green-500/20 text-green-300 border border-green-500/20' : 'bg-purple-500/20 text-purple-300 border border-purple-500/20'} flex-shrink-0 text-xs sm:text-sm">${eq.section}</span>
        <p class="font-display font-bold text-white group-hover:text-amber-300 transition-colors text-base sm:text-lg flex-1 leading-snug">${eq.q}</p>
        <span class="text-gray-600 text-2xl transition-transform essay-arrow flex-shrink-0">â€º</span>
      </button>
      <div class="essay-content hidden px-5 sm:px-6 pb-6">
        <div class="sm:ml-16">
          <p class="text-gray-400 text-sm uppercase tracking-wider font-bold mb-3 flex items-center gap-2">ğŸ’¡ Outline Hints <span class="text-xs text-gray-600 normal-case font-normal">(use these to structure your answer)</span></p>
          <div class="space-y-2 mb-5">
            ${eq.hints.map(h => `<div class="bg-white/5 rounded-xl p-4 text-gray-300 text-base border-l-4 border-amber-500/30 flex gap-3"><span class="text-amber-400 flex-shrink-0">â†’</span> ${h}</div>`).join('')}
          </div>

          ${eq.example ? `
          <div class="mb-5">
            <button onclick="toggleExampleEssay(this)" class="w-full flex items-center gap-3 p-4 rounded-2xl bg-gradient-to-r from-indigo-500/10 to-purple-500/10 border-2 border-indigo-500/20 hover:border-indigo-500/40 transition-all group/ex text-left">
              <span class="text-2xl flex-shrink-0">ğŸ“</span>
              <div class="flex-1">
                <p class="font-display font-bold text-indigo-300 text-sm group-hover/ex:text-indigo-200 transition">Show Example Essay</p>
                <p class="text-gray-500 text-xs mt-0.5">A detailed model answer to guide your writing</p>
              </div>
              <span class="text-indigo-400 text-xl transition-transform example-arrow flex-shrink-0">â€º</span>
            </button>
            <div class="example-content hidden mt-3">
              <div class="bg-indigo-500/5 border-2 border-indigo-500/15 rounded-2xl p-5 sm:p-6">
                <div class="flex items-center gap-2 mb-4">
                  <span class="text-lg">âœ¨</span>
                  <p class="text-indigo-300 font-display font-bold text-sm uppercase tracking-wider">Example Essay</p>
                  <span class="tag bg-indigo-500/20 text-indigo-300 border border-indigo-500/20 text-[10px]">Model Answer</span>
                </div>
                <div class="text-gray-300 text-sm sm:text-base leading-relaxed space-y-3 essay-example-text">${eq.example.split('\\n\\n').map(p => '<p>' + p + '</p>').join('')}</div>
                <div class="mt-4 pt-4 border-t border-indigo-500/10">
                  <p class="text-gray-500 text-xs italic flex items-center gap-2">ğŸ’¡ <span>Use this as a reference â€” your essay should reflect your own understanding and voice.</span></p>
                </div>
              </div>
            </div>
          </div>` : ''}

          <textarea placeholder="Draft your answer here... (auto-saved) âœï¸" class="w-full bg-white/5 border-2 border-white/10 rounded-2xl p-5 text-gray-200 text-base resize-y min-h-[160px] focus:outline-none focus:border-amber-500/40 transition placeholder:text-gray-600 leading-relaxed" oninput="localStorage.setItem('essay-${i}',this.value)">${localStorage.getItem('essay-'+i) || ''}</textarea>
        </div>
      </div>
    </div>`).join('');
}

function toggleExampleEssay(btn) {
  const content = btn.nextElementSibling;
  const arrow = btn.querySelector('.example-arrow');
  if (!content.classList.contains('hidden')) {
    content.classList.add('hidden');
    arrow.style.transform = 'rotate(0deg)';
    btn.querySelector('.font-display').textContent = 'Show Example Essay';
  } else {
    content.classList.remove('hidden');
    arrow.style.transform = 'rotate(90deg)';
    content.style.animation = 'slide-up 0.3s ease-out';
    btn.querySelector('.font-display').textContent = 'Hide Example Essay';
  }
}

function toggleEssay(btn) {
  const c = btn.nextElementSibling, a = btn.querySelector('.essay-arrow');
  if (!c.classList.contains('hidden')) { c.classList.add('hidden'); a.style.transform = 'rotate(0deg)'; }
  else { c.classList.remove('hidden'); a.style.transform = 'rotate(90deg)'; c.style.animation = 'slide-up 0.3s ease-out'; }
}

// ============================================
// POMODORO TIMER
// ============================================

function toggleTimer() {
  const m = document.getElementById('timer-modal'); m.classList.toggle('hidden'); m.classList.toggle('flex');
}
function setTimer(min) {
  timerMinutes = min; timerTotalSeconds = min * 60; timerSeconds = 0; timerRunning = false;
  if (timerInterval) clearInterval(timerInterval); updateTimerDisplay();
}
function startTimer() {
  if (timerRunning) return; timerRunning = true;
  let remaining = timerMinutes * 60 + timerSeconds;
  timerInterval = setInterval(() => {
    remaining--;
    if (remaining <= 0) {
      clearInterval(timerInterval); timerRunning = false; timerMinutes = 0; timerSeconds = 0; updateTimerDisplay();
      showAchievement('â›ï¸', 'Mining Session Complete!', 'Cookie says: time for a snack break!'); addXP(25);
      confetti({ particleCount: 80, spread: 70, colors: ['#fbbf24', '#f97316', '#ef4444'] }); return;
    }
    timerMinutes = Math.floor(remaining / 60); timerSeconds = remaining % 60; updateTimerDisplay();
  }, 1000);
}
function pauseTimer() { timerRunning = false; if (timerInterval) clearInterval(timerInterval); }
function updateTimerDisplay() {
  const str = `${timerMinutes.toString().padStart(2,'0')}:${timerSeconds.toString().padStart(2,'0')}`;
  document.getElementById('timer-display').textContent = str;
  document.getElementById('timer-big').textContent = str;
  const remaining = timerMinutes * 60 + timerSeconds;
  document.getElementById('timer-circle').style.strokeDashoffset = 283 * (1 - remaining / timerTotalSeconds);
}

// ============================================
// BACKGROUND PARTICLES (subtle, calming)
// ============================================

(function initParticles() {
  const canvas = document.getElementById('particles-canvas');
  const ctx = canvas.getContext('2d');
  let particles = [];
  function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
  resize(); window.addEventListener('resize', resize);

  for (let i = 0; i < 40; i++) {
    particles.push({
      x: Math.random() * canvas.width, y: Math.random() * canvas.height,
      r: Math.random() * 2 + 0.5, dx: (Math.random() - 0.5) * 0.3, dy: (Math.random() - 0.5) * 0.3,
      color: ['rgba(251,191,36,0.3)', 'rgba(249,115,22,0.3)', 'rgba(239,68,68,0.2)', 'rgba(139,92,246,0.2)', 'rgba(56,189,248,0.2)'][Math.floor(Math.random() * 5)]
    });
  }
  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles.forEach(p => {
      p.x += p.dx; p.y += p.dy;
      if (p.x < 0) p.x = canvas.width; if (p.x > canvas.width) p.x = 0;
      if (p.y < 0) p.y = canvas.height; if (p.y > canvas.height) p.y = 0;
      ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fillStyle = p.color; ctx.fill();
    });
    // Draw connections
    for (let i = 0; i < particles.length; i++) {
      for (let j = i + 1; j < particles.length; j++) {
        const dist = Math.hypot(particles[i].x - particles[j].x, particles[i].y - particles[j].y);
        if (dist < 120) {
          ctx.beginPath(); ctx.moveTo(particles[i].x, particles[i].y); ctx.lineTo(particles[j].x, particles[j].y);
          ctx.strokeStyle = `rgba(251,191,36,${0.08 * (1 - dist / 120)})`; ctx.stroke();
        }
      }
    }
    requestAnimationFrame(animate);
  }
  animate();
})();

// ============================================
// STATE PERSISTENCE
// ============================================

function loadState() {
  const saved = localStorage.getItem('mod6-state');
  if (saved) {
    try {
      const s = JSON.parse(saved);
      xp = s.xp || 0; level = s.level || 1; bestStreak = s.bestStreak || 0;
      topicsChecked = new Set(s.topicsChecked || []); achievements = new Set(s.achievements || []);
      document.getElementById('xp-display').textContent = `${xp} XP`;
      document.getElementById('level-display').textContent = `Lv ${level}`;
      document.getElementById('xp-bar').style.width = `${(xp / (level * 100)) * 100}%`;
      topicsChecked.forEach(key => {
        const card = document.querySelector(`[data-topic="${key}"]`);
        if (card) {
          const check = card.querySelector('.topic-check');
          check.dataset.checked = 'true';
          check.querySelector('.check-icon').classList.remove('hidden');
          check.querySelector('.uncheck-icon').classList.add('hidden');
          check.classList.add('bg-green-500/30', 'border-green-500/50');
          check.classList.remove('bg-amber-500/20', 'border-amber-500/40', 'bg-purple-500/20', 'border-purple-500/40', 'bg-green-500/20', 'border-green-500/40');
        }
      });
      updateStudyProgress();
    } catch(e) {}
  }
}

function saveState() {
  localStorage.setItem('mod6-state', JSON.stringify({
    xp, level, bestStreak, topicsChecked: [...topicsChecked], achievements: [...achievements]
  }));
}

setInterval(saveState, 5000);
window.addEventListener('beforeunload', saveState);
loadState();

if (!localStorage.getItem('mod6-welcomed')) {
  localStorage.setItem('mod6-welcomed', 'true');
  setTimeout(() => showAchievement('â›ï¸', 'Welcome to the Mine!', 'The 7 Zwerge are ready to help you study!'), 800);
}

// ============================================
// ğŸ® BLAST GAMES
// ============================================

let blastTimerInterval = null;

function startBlastGame(game) {
  if (blastTimerInterval) { clearInterval(blastTimerInterval); blastTimerInterval = null; }
  const arena = document.getElementById('blast-arena');
  if (game === 'speedround') initSpeedRound(arena);
  else if (game === 'bombdefuse') initBombDefuse(arena);
  else if (game === 'timeline') initTimeline(arena);
  else if (game === 'whoami') initWhoAmI(arena);
  else if (game === 'categorysort') initCategorySort(arena);
  arena.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// â”€â”€â”€ âš¡ SPEED ROUND: 60s True/False Blitz â”€â”€â”€
const speedRoundData = [
  { s: "Stringham traces dwarfs from medieval epics to Grimm fairy tales.", a: true },
  { s: "Dwarfs in German literature are always portrayed as evil.", a: false },
  { s: "Reciprocity is central to dwarf-human interactions.", a: true },
  { s: "The Nibelungenlied features a dwarf named Alberich.", a: true },
  { s: "Rumpelstiltskin is an example of an Unexpected Helper.", a: false },
  { s: "Grimm fairy tales were originally intended for children.", a: false },
  { s: "7 Zwerge (2004) is a parody of Snow White.", a: true },
  { s: "Schema theory says all readers interpret texts the same way.", a: false },
  { s: "FSK stands for Freiwillige Selbstkontrolle der Filmwirtschaft.", a: true },
  { s: "The dwarfs in Snow White provide shelter expecting nothing in return.", a: false },
  { s: "Das Blaue Licht features an Obedient Dwarf.", a: true },
  { s: "Heroism in 7 Zwerge is individual and virtuous.", a: false },
  { s: "The Brothers Grimm were passive collectors, not active editors.", a: false },
  { s: "Culture influences inference-making at a deep cognitive level.", a: true },
  { s: "Dwarfs are frequently associated with mountains and mining.", a: true },
  { s: "The Elves and the Shoemaker is an example of the Demonic Dwarf.", a: false },
  { s: "Western readers tend toward individualistic interpretations.", a: true },
  { s: "Grimm fairy tales were used for German cultural preservation.", a: true },
  { s: "7 Zwerge's humor translates easily to all cultures.", a: false },
  { s: "Rudlieb is one of the earliest German dwarf narratives.", a: true },
  { s: "Gilmour identifies exactly 3 categories of dwarfs.", a: false },
  { s: "The Tarnkappe is a cloak of invisibility from the Nibelungenlied.", a: true },
  { s: "Dwarfs shift roles: helper, servant, prophet, villain.", a: true },
  { s: "Disney's adaptations preserve the dark original Grimm stories perfectly.", a: false },
  { s: "Mystery and limited knowledge preserve the enchantment of dwarf figures.", a: true },
  { s: "The Volunteer Giver helps but expects fair exchange in return.", a: true },
  { s: "Situation Model means a physical diorama of a story.", a: false },
  { s: "7 Zwerge stars the 7 most famous German comedians.", a: true },
  { s: "Top-down processing means reading word by word without context.", a: false },
  { s: "The Grimm fairy tales originally came from laborer women who worked in kitchens.", a: true },
  { s: "Lied vom HÃ¼rnen Seyfrid involves prophetic knowledge.", a: true },
  { s: "Snow White dwarfs reinforce social norms through structured reciprocity.", a: true },
  { s: "Moral ambiguity is NOT a theme in the Stringham article.", a: false },
  { s: "Eurodisney brought Americanized fairy tales back to Europe.", a: true },
];

function initSpeedRound(arena) {
  const shuffled = [...speedRoundData].sort(() => Math.random() - 0.5);
  let idx = 0, score = 0, timeLeft = 60, answered = false;

  function render() {
    arena.innerHTML = `
      <div class="glass-strong rounded-2xl p-6 sm:p-8 border-2 border-fuchsia-500/30 animate-pop">
        <div class="flex items-center justify-between mb-6">
          <div class="flex items-center gap-3">
            <span class="text-3xl animate-wiggle">âš¡</span>
            <div>
              <h3 class="font-display font-bold text-xl text-fuchsia-300">Speed Round</h3>
              <p class="text-gray-500 text-xs">True or False â€” GO!</p>
            </div>
          </div>
          <div class="flex items-center gap-4">
            <div class="glass rounded-xl px-4 py-2"><span class="font-mono font-bold text-green-300 text-lg">${score}</span><span class="text-gray-500 text-xs ml-1">pts</span></div>
            <div class="glass rounded-xl px-4 py-2"><span class="font-mono font-bold ${timeLeft <= 10 ? 'text-red-400 animate-pulse' : 'text-amber-300'} text-lg">${timeLeft}s</span></div>
          </div>
        </div>
        <div class="bg-fuchsia-500/5 rounded-2xl p-6 sm:p-8 border border-fuchsia-500/10 mb-6 min-h-[120px] flex items-center justify-center">
          <p class="font-display font-bold text-lg sm:text-xl text-white text-center leading-relaxed">${idx < shuffled.length ? shuffled[idx].s : 'Done!'}</p>
        </div>
        <div id="sr-feedback" class="mb-4 min-h-[48px]"></div>
        ${idx < shuffled.length ? `
        <div class="flex justify-center gap-4">
          <button onclick="srAnswer(true)" class="px-10 py-4 rounded-2xl bg-green-500/20 border-2 border-green-500/30 hover:bg-green-500/30 hover:border-green-500/50 transition-all text-green-300 font-bold text-xl flex items-center gap-3 shadow-lg shadow-green-500/10">âœ… TRUE</button>
          <button onclick="srAnswer(false)" class="px-10 py-4 rounded-2xl bg-red-500/20 border-2 border-red-500/30 hover:bg-red-500/30 hover:border-red-500/50 transition-all text-red-300 font-bold text-xl flex items-center gap-3 shadow-lg shadow-red-500/10">âŒ FALSE</button>
        </div>` : ''}
      </div>`;
  }

  window.srAnswer = function(ans) {
    if (answered || idx >= shuffled.length) return;
    answered = true;
    const correct = ans === shuffled[idx].a;
    const fb = document.getElementById('sr-feedback');
    if (correct) {
      score += timeLeft <= 10 ? 3 : timeLeft <= 30 ? 2 : 1;
      addXP(5); updateStreak(true);
      fb.innerHTML = `<div class="text-center text-green-300 font-bold animate-pop text-lg">ğŸ’ Correct! +${timeLeft <= 10 ? 3 : timeLeft <= 30 ? 2 : 1} pts</div>`;
    } else {
      updateStreak(false);
      fb.innerHTML = `<div class="text-center text-red-300 font-bold animate-shake text-lg">âŒ Nope! Answer was ${shuffled[idx].a ? 'TRUE' : 'FALSE'}</div>`;
    }
    setTimeout(() => { idx++; answered = false; if (timeLeft > 0 && idx < shuffled.length) render(); else endGame(); }, 800);
  };

  function endGame() {
    clearInterval(blastTimerInterval); blastTimerInterval = null;
    const total = Math.min(idx, shuffled.length);
    confetti({ particleCount: 80, spread: 70, colors: ['#d946ef', '#fbbf24', '#34d399'] });
    arena.innerHTML = `
      <div class="glass-strong rounded-2xl p-8 text-center animate-pop border-2 border-fuchsia-500/30">
        <span class="text-5xl">âš¡</span>
        <h3 class="font-display font-bold text-2xl text-fuchsia-300 mt-4">Speed Round Complete!</h3>
        <p class="text-white text-4xl font-mono font-bold mt-3">${score} points</p>
        <p class="text-gray-400 text-sm mt-2">Answered ${total} questions in 60 seconds</p>
        <button onclick="startBlastGame('speedround')" class="mt-6 px-8 py-3 rounded-2xl bg-gradient-to-r from-fuchsia-500 to-purple-500 text-white font-bold hover:opacity-90 transition">âš¡ Play Again</button>
      </div>`;
  }

  render();
  blastTimerInterval = setInterval(() => {
    timeLeft--;
    const timerEl = arena.querySelector('.font-mono.font-bold.text-amber-300, .font-mono.font-bold.text-red-400');
    if (timerEl) {
      timerEl.textContent = `${timeLeft}s`;
      if (timeLeft <= 10) timerEl.className = timerEl.className.replace('text-amber-300', 'text-red-400') + ' animate-pulse';
    }
    if (timeLeft <= 0) endGame();
  }, 1000);
}

// â”€â”€â”€ ğŸ’£ BOMB DEFUSER: Type the answer before time runs out â”€â”€â”€
const bombData = [
  { q: "Author of the Dwarfs article? (last name)", a: ["stringham"] },
  { q: "Dwarf who is forced into servitude in the Nibelungenlied?", a: ["alberich"] },
  { q: "Magic cloak from the Nibelungenlied?", a: ["tarnkappe"] },
  { q: "Category: assists without asking for anything", a: ["unexpected helper"] },
  { q: "Category: abductor or manipulator", a: ["demonic dwarf"] },
  { q: "Rumpelstiltskin demands the queen's ___", a: ["firstborn", "child", "firstborn child", "baby"] },
  { q: "FSK stands for Freiwillige ___ der Filmwirtschaft", a: ["selbstkontrolle"] },
  { q: "Cultural mental frameworks guiding interpretation", a: ["schema theory", "schema", "schemata"] },
  { q: "The Frog Prince in German: Der ___", a: ["froschkÃ¶nig", "froschkonig", "froschkoenig"] },
  { q: "7 Zwerge is a ___ of Snow White", a: ["parody"] },
  { q: "Using prior knowledge to interpret text = ___-down processing", a: ["top"] },
  { q: "Mental picture of characters/events during reading", a: ["situation model"] },
  { q: "Grimm tales were used for German ___ and cultural preservation", a: ["nationalism", "romantic nationalism"] },
  { q: "Filling narrative gaps with cultural knowledge = ___-making", a: ["inference"] },
  { q: "Early 11th century dwarf story about treasure & mistrust", a: ["rudlieb"] },
];

function initBombDefuse(arena) {
  const shuffled = [...bombData].sort(() => Math.random() - 0.5).slice(0, 10);
  let idx = 0, score = 0, bombTime = 15;

  function renderBomb() {
    if (idx >= shuffled.length) { endBombGame(); return; }
    bombTime = 15;
    arena.innerHTML = `
      <div class="glass-strong rounded-2xl p-6 sm:p-8 border-2 border-orange-500/30 animate-pop">
        <div class="flex items-center justify-between mb-5">
          <div class="flex items-center gap-3">
            <span class="text-3xl ${bombTime <= 5 ? 'animate-shake' : 'animate-wiggle'}">ğŸ’£</span>
            <div>
              <h3 class="font-display font-bold text-xl text-orange-300">Bomb Defuser</h3>
              <p class="text-gray-500 text-xs">${idx + 1} / ${shuffled.length}</p>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <div class="glass rounded-xl px-4 py-2"><span class="font-mono font-bold text-green-300">${score}</span><span class="text-gray-500 text-xs ml-1">defused</span></div>
            <div class="glass rounded-xl px-4 py-2"><span id="bomb-timer" class="font-mono font-bold text-orange-300 text-xl">${bombTime}</span></div>
          </div>
        </div>
        <div class="bg-orange-500/5 rounded-2xl p-6 border border-orange-500/10 mb-5">
          <p class="font-display font-bold text-lg sm:text-xl text-white text-center">${shuffled[idx].q}</p>
        </div>
        <div id="bomb-feedback" class="mb-3 min-h-[40px]"></div>
        <div class="flex gap-3">
          <input type="text" id="bomb-input" class="flex-1 bg-white/5 border-2 border-orange-500/30 rounded-2xl px-5 py-4 text-white text-lg font-bold focus:outline-none focus:border-orange-500 transition placeholder:text-gray-600" placeholder="Type your answer..." autofocus autocomplete="off" onkeydown="if(event.key==='Enter')checkBomb()">
          <button onclick="checkBomb()" class="px-6 py-4 rounded-2xl bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold text-lg hover:opacity-90 transition flex-shrink-0">ğŸ”§ Defuse!</button>
        </div>
      </div>`;
    document.getElementById('bomb-input').focus();
    if (blastTimerInterval) clearInterval(blastTimerInterval);
    blastTimerInterval = setInterval(() => {
      bombTime--;
      const te = document.getElementById('bomb-timer');
      if (te) { te.textContent = bombTime; if (bombTime <= 5) te.classList.add('text-red-400', 'animate-pulse'); }
      if (bombTime <= 0) {
        clearInterval(blastTimerInterval);
        updateStreak(false);
        const fb = document.getElementById('bomb-feedback');
        if (fb) fb.innerHTML = `<div class="text-center text-red-300 font-bold animate-shake">ğŸ’¥ BOOM! Answer: <span class="text-white">${shuffled[idx].a[0]}</span></div>`;
        setTimeout(() => { idx++; renderBomb(); }, 1500);
      }
    }, 1000);
  }

  window.checkBomb = function() {
    const input = document.getElementById('bomb-input');
    if (!input) return;
    const val = input.value.trim().toLowerCase();
    if (!val) return;
    const correct = shuffled[idx].a.some(a => val.includes(a.toLowerCase()));
    const fb = document.getElementById('bomb-feedback');
    if (correct) {
      clearInterval(blastTimerInterval);
      score++; addXP(15); updateStreak(true);
      fb.innerHTML = `<div class="text-center text-green-300 font-bold animate-pop text-lg">ğŸ”§ Defused! +15 XP</div>`;
      confetti({ particleCount: 25, spread: 40, origin: { y: 0.7 }, colors: ['#f97316', '#fbbf24'] });
      setTimeout(() => { idx++; renderBomb(); }, 900);
    } else {
      fb.innerHTML = `<div class="text-center text-red-300 font-bold animate-shake">âŒ Try again â€” keep typing!</div>`;
      input.value = ''; input.focus();
    }
  };

  function endBombGame() {
    clearInterval(blastTimerInterval); blastTimerInterval = null;
    confetti({ particleCount: 100, spread: 80, colors: ['#f97316', '#fbbf24', '#ef4444'] });
    arena.innerHTML = `
      <div class="glass-strong rounded-2xl p-8 text-center animate-pop border-2 border-orange-500/30">
        <span class="text-5xl">ğŸ’£</span>
        <h3 class="font-display font-bold text-2xl text-orange-300 mt-4">Mission Complete!</h3>
        <p class="text-white text-4xl font-mono font-bold mt-3">${score} / ${shuffled.length}</p>
        <p class="text-gray-400 text-sm mt-2">bombs defused</p>
        <button onclick="startBlastGame('bombdefuse')" class="mt-6 px-8 py-3 rounded-2xl bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold hover:opacity-90 transition">ğŸ’£ Play Again</button>
      </div>`;
  }

  renderBomb();
}

// â”€â”€â”€ ğŸ”— TIMELINE: Arrange events in chronological order â”€â”€â”€
const timelineEvents = [
  { text: "Rudlieb â€” earliest German dwarf narrative", year: 1050 },
  { text: "Nibelungenlied â€” dwarfs, treasure, Tarnkappe", year: 1200 },
  { text: "Lied vom HÃ¼rnen Seyfrid â€” prophetic dwarfs", year: 1530 },
  { text: "Brothers Grimm collect Kinder- und HausmÃ¤rchen", year: 1812 },
  { text: "Grimm tales used for Romantic nationalism", year: 1850 },
  { text: "Disney's Snow White film released", year: 1937 },
  { text: "7 Zwerge parody film released in Germany", year: 2004 },
  { text: "Eurodisney â€” Americanized tales return to Europe", year: 1992 },
];

function initTimeline(arena) {
  const shuffled = [...timelineEvents].sort(() => Math.random() - 0.5);
  let selected = [];
  const correct = [...timelineEvents].sort((a, b) => a.year - b.year);

  function renderTimeline() {
    const remaining = shuffled.filter(e => !selected.find(s => s.text === e.text));
    arena.innerHTML = `
      <div class="glass-strong rounded-2xl p-6 sm:p-8 border-2 border-sky-500/30 animate-pop">
        <div class="flex items-center gap-3 mb-5">
          <span class="text-3xl animate-wiggle">ğŸ”—</span>
          <div>
            <h3 class="font-display font-bold text-xl text-sky-300">Timeline Challenge</h3>
            <p class="text-gray-500 text-xs">Tap events in chronological order â€” earliest first!</p>
          </div>
        </div>

        <!-- Placed timeline -->
        <div class="mb-5 space-y-2">
          <p class="text-gray-500 text-xs font-bold uppercase tracking-wider mb-2">ğŸ“ Your Timeline (${selected.length} / ${timelineEvents.length})</p>
          ${selected.length === 0 ? '<p class="text-gray-600 text-sm italic">Tap events below to build your timeline...</p>' : ''}
          ${selected.map((e, i) => `
            <div class="flex items-center gap-3 bg-sky-500/10 rounded-xl p-3 border border-sky-500/20 animate-slide-right">
              <span class="w-8 h-8 rounded-lg bg-sky-500/20 flex items-center justify-center text-sky-300 font-mono font-bold text-sm flex-shrink-0">${i + 1}</span>
              <span class="text-white text-sm font-medium flex-1">${e.text}</span>
              <button onclick="tlUndo(${i})" class="text-gray-500 hover:text-red-400 transition text-lg flex-shrink-0">âœ•</button>
            </div>`).join('')}
        </div>

        <!-- Available events -->
        ${remaining.length > 0 ? `
        <p class="text-gray-500 text-xs font-bold uppercase tracking-wider mb-2">â° Available Events</p>
        <div class="space-y-2 mb-5">
          ${remaining.map((e, i) => `
            <button onclick="tlPick('${e.text.replace(/'/g, "\\'")}')" class="w-full text-left p-4 rounded-xl glass border-2 border-white/10 hover:border-sky-500/40 hover:bg-sky-500/5 transition-all text-white text-sm font-medium">
              ${e.text}
            </button>`).join('')}
        </div>` : ''}

        ${selected.length === timelineEvents.length ? `
        <button onclick="tlCheck()" class="w-full px-8 py-4 rounded-2xl bg-gradient-to-r from-sky-500 to-blue-500 text-white font-bold text-lg hover:opacity-90 transition">ğŸ” Check My Timeline!</button>` : ''}

        <div id="tl-feedback" class="mt-4"></div>
      </div>`;
  }

  window.tlPick = function(text) {
    const event = shuffled.find(e => e.text === text);
    if (event && !selected.find(s => s.text === text)) { selected.push(event); renderTimeline(); }
  };

  window.tlUndo = function(idx) { selected.splice(idx, 1); renderTimeline(); };

  window.tlCheck = function() {
    let correctCount = 0;
    selected.forEach((e, i) => { if (e.text === correct[i].text) correctCount++; });
    const fb = document.getElementById('tl-feedback');
    if (correctCount === correct.length) {
      addXP(50); updateStreak(true);
      confetti({ particleCount: 150, spread: 100, colors: ['#38bdf8', '#fbbf24', '#34d399'] });
      fb.innerHTML = `<div class="bg-green-500/10 border-2 border-green-500/20 rounded-2xl p-5 text-center animate-pop"><span class="text-4xl">ğŸ‰</span><p class="text-green-300 font-bold text-xl mt-2">Perfect Timeline! +50 XP</p></div>`;
    } else {
      updateStreak(false);
      const correctOrder = correct.map((e, i) => `<div class="flex items-center gap-2 text-sm"><span class="text-sky-300 font-mono font-bold">${e.year}</span><span class="text-gray-300">${e.text}</span></div>`).join('');
      fb.innerHTML = `
        <div class="bg-red-500/10 border-2 border-red-500/20 rounded-2xl p-5 animate-shake">
          <p class="text-red-300 font-bold text-center mb-3">âŒ ${correctCount}/${correct.length} correct â€” here's the right order:</p>
          <div class="space-y-1.5">${correctOrder}</div>
          <button onclick="selected=[];renderTimeline?renderTimeline():startBlastGame('timeline')" class="mt-4 mx-auto block px-6 py-2 rounded-xl bg-sky-500/20 border border-sky-500/30 text-sky-300 font-bold text-sm hover:bg-sky-500/30 transition">ğŸ”„ Try Again</button>
        </div>`;
    }
  };

  renderTimeline();
}

// â”€â”€â”€ ğŸ•µï¸ WHO AM I? Guess the text/concept from progressive clues â”€â”€â”€
const whoAmIData = [
  { answer: "Rumpelstiltskin", clues: ["I am a dwarf from a Grimm fairy tale.", "I can spin straw into gold.", "I made a deal with a miller's daughter.", "I demanded her firstborn child as payment.", "Knowing my NAME is what defeats me."] },
  { answer: "Snow White Dwarfs", clues: ["We are a group, not just one.", "We work underground every day.", "We offered shelter to a princess.", "We expected housework in return â€” reciprocity!", "There are 7 of us, and we are miners."] },
  { answer: "Alberich (Nibelungenlied)", clues: ["I appear in a medieval German epic.", "I possess a magical treasure hoard.", "I own a Tarnkappe â€” a cloak of invisibility.", "I was defeated by a great hero.", "Siegfried conquered me and took my cloak."] },
  { answer: "Schema Theory", clues: ["I am not a character â€” I am a concept.", "I explain why people read differently.", "I involve mental frameworks from socialization.", "Culture shapes me â€” I am not universal.", "I am the theory of culturally embedded knowledge structures."] },
  { answer: "7 Zwerge (2004 Film)", clues: ["I am a modern retelling of a classic tale.", "I was a massive hit in Germany.", "I star 7 famous German comedians.", "My humor doesn't translate well to other cultures.", "I am a parody of Snow White."] },
  { answer: "Brothers Grimm", clues: ["We were two people working together.", "We collected stories from German oral tradition.", "Our sources were laborer women, not aristocrats.", "We edited stories to serve Romantic nationalism.", "Our Kinder- und HausmÃ¤rchen is world-famous."] },
  { answer: "Reciprocity", clues: ["I am a theme, not a character.", "I govern dwarf-human interactions.", "I mean mutual exchange â€” give and take.", "In Snow White, I look like: shelter for housework.", "In Rumpelstiltskin, I escalate: necklace â†’ ring â†’ child."] },
  { answer: "Das Blaue Licht", clues: ["I am a Grimm fairy tale.", "I feature a dwarf character.", "The dwarf in me is not free â€” he is controlled.", "A human uses magic to command the dwarf.", "I am the key example of the 'Obedient Dwarf' category."] },
];

function initWhoAmI(arena) {
  const shuffled = [...whoAmIData].sort(() => Math.random() - 0.5);
  let roundIdx = 0, clueIdx = 0, guessed = false, score = 0;

  function renderWhoAmI() {
    if (roundIdx >= shuffled.length) { endWhoAmI(); return; }
    const current = shuffled[roundIdx];
    const revealedClues = current.clues.slice(0, clueIdx + 1);
    const maxPoints = 5 - clueIdx;

    arena.innerHTML = `
      <div class="glass-strong rounded-2xl p-6 sm:p-8 border-2 border-green-500/30 animate-pop">
        <div class="flex items-center justify-between mb-5">
          <div class="flex items-center gap-3">
            <span class="text-3xl animate-wiggle">ğŸ•µï¸</span>
            <div>
              <h3 class="font-display font-bold text-xl text-green-300">Who Am I?</h3>
              <p class="text-gray-500 text-xs">Round ${roundIdx + 1} / ${shuffled.length} â€” Fewer clues = more points!</p>
            </div>
          </div>
          <div class="glass rounded-xl px-4 py-2"><span class="font-mono font-bold text-green-300">${score}</span><span class="text-gray-500 text-xs ml-1">pts</span></div>
        </div>

        <div class="space-y-2 mb-5">
          ${revealedClues.map((c, i) => `
            <div class="flex items-start gap-3 bg-green-500/${5 + i * 2} rounded-xl p-4 border border-green-500/10 animate-slide-right" style="animation-delay:${i * 0.1}s">
              <span class="w-7 h-7 rounded-lg bg-green-500/20 flex items-center justify-center text-green-300 font-mono font-bold text-xs flex-shrink-0">ğŸ”</span>
              <p class="text-white text-sm sm:text-base font-medium">${c}</p>
            </div>`).join('')}
        </div>

        <div class="flex items-center gap-2 mb-4">
          <div class="flex gap-1">${current.clues.map((_, i) => `<div class="w-3 h-3 rounded-full ${i <= clueIdx ? 'bg-green-400' : 'bg-gray-700'}"></div>`).join('')}</div>
          <span class="text-gray-500 text-xs">Clue ${clueIdx + 1}/${current.clues.length}</span>
          <span class="text-green-300 text-xs font-bold ml-auto">Worth ${maxPoints} pt${maxPoints !== 1 ? 's' : ''}</span>
        </div>

        <div id="wai-feedback" class="mb-3 min-h-[40px]"></div>

        ${!guessed ? `
        <div class="flex gap-3 mb-3">
          <input type="text" id="wai-input" class="flex-1 bg-white/5 border-2 border-green-500/30 rounded-2xl px-5 py-4 text-white text-lg font-bold focus:outline-none focus:border-green-500 transition placeholder:text-gray-600" placeholder="Type your guess..." autofocus autocomplete="off" onkeydown="if(event.key==='Enter')waiGuess()">
          <button onclick="waiGuess()" class="px-6 py-4 rounded-2xl bg-gradient-to-r from-green-500 to-emerald-500 text-white font-bold hover:opacity-90 transition flex-shrink-0">ğŸ•µï¸ Guess!</button>
        </div>
        ${clueIdx < current.clues.length - 1 ? `<button onclick="waiMoreClues()" class="w-full py-3 rounded-xl glass border-2 border-white/10 hover:border-green-500/30 text-gray-400 hover:text-green-300 font-bold text-sm transition">ğŸ” Need Another Clue (-1 point)</button>` : ''}
        ` : ''}
      </div>`;
    if (!guessed) { const inp = document.getElementById('wai-input'); if (inp) inp.focus(); }
  }

  window.waiGuess = function() {
    const input = document.getElementById('wai-input');
    if (!input) return;
    const val = input.value.trim().toLowerCase();
    if (!val) return;
    const answer = shuffled[roundIdx].answer.toLowerCase();
    const fb = document.getElementById('wai-feedback');
    // Flexible matching â€” check if answer contains guess or vice versa
    const isCorrect = answer.includes(val) || val.includes(answer) || answer.split(/[\s()]/g).some(w => w.length > 3 && val.includes(w.toLowerCase()));
    if (isCorrect) {
      guessed = true;
      const pts = Math.max(1, 5 - clueIdx);
      score += pts; addXP(pts * 5); updateStreak(true);
      confetti({ particleCount: 40, spread: 50, origin: { y: 0.7 }, colors: ['#34d399', '#fbbf24'] });
      fb.innerHTML = `<div class="text-center text-green-300 font-bold animate-pop text-lg">ğŸ‰ Correct! It's <span class="text-white">${shuffled[roundIdx].answer}</span>! +${pts} pts</div>`;
      setTimeout(() => { roundIdx++; clueIdx = 0; guessed = false; renderWhoAmI(); }, 1800);
    } else {
      fb.innerHTML = `<div class="text-center text-red-300 font-bold animate-shake">âŒ Not quite â€” try again or get another clue!</div>`;
      input.value = ''; input.focus();
    }
  };

  window.waiMoreClues = function() {
    if (clueIdx < shuffled[roundIdx].clues.length - 1) { clueIdx++; renderWhoAmI(); }
  };

  function endWhoAmI() {
    confetti({ particleCount: 100, spread: 80, colors: ['#34d399', '#fbbf24', '#38bdf8'] });
    arena.innerHTML = `
      <div class="glass-strong rounded-2xl p-8 text-center animate-pop border-2 border-green-500/30">
        <span class="text-5xl">ğŸ•µï¸</span>
        <h3 class="font-display font-bold text-2xl text-green-300 mt-4">Detective Work Complete!</h3>
        <p class="text-white text-4xl font-mono font-bold mt-3">${score} points</p>
        <p class="text-gray-400 text-sm mt-2">across ${shuffled.length} mysteries</p>
        <button onclick="startBlastGame('whoami')" class="mt-6 px-8 py-3 rounded-2xl bg-gradient-to-r from-green-500 to-emerald-500 text-white font-bold hover:opacity-90 transition">ğŸ•µï¸ Play Again</button>
      </div>`;
  }

  renderWhoAmI();
}

// â”€â”€â”€ ğŸ—‚ï¸ CATEGORY SORT: Sort items into Gilmour's categories â”€â”€â”€
const categorySortData = {
  categories: [
    { name: "Unexpected Helper", emoji: "ğŸ¤²", color: "green" },
    { name: "Obedient Dwarf", emoji: "ğŸ«¡", color: "blue" },
    { name: "Demonic Dwarf", emoji: "ğŸ˜ˆ", color: "red" },
    { name: "Volunteer Giver", emoji: "ğŸ", color: "yellow" },
    { name: "Ungrateful/Evil", emoji: "ğŸ’€", color: "purple" },
  ],
  items: [
    { text: "Snow White's 7 dwarfs", cat: "Unexpected Helper" },
    { text: "Elves & the Shoemaker", cat: "Unexpected Helper" },
    { text: "Rumpelstiltskin", cat: "Demonic Dwarf" },
    { text: "Das Blaue Licht dwarf", cat: "Obedient Dwarf" },
    { text: "Snow White & Rose Red dwarf", cat: "Ungrateful/Evil" },
    { text: "Dwarf who helps for fair exchange", cat: "Volunteer Giver" },
    { text: "Helps secretly, wants nothing", cat: "Unexpected Helper" },
    { text: "Controlled by human magic", cat: "Obedient Dwarf" },
    { text: "Demands a child as payment", cat: "Demonic Dwarf" },
    { text: "Associated with greed & the Devil", cat: "Ungrateful/Evil" },
  ]
};

function initCategorySort(arena) {
  const items = [...categorySortData.items].sort(() => Math.random() - 0.5);
  let currentItem = 0, score = 0, wrong = 0;

  function renderSort() {
    if (currentItem >= items.length) { endSort(); return; }
    const item = items[currentItem];
    const colorMap = { green: 'green', blue: 'blue', red: 'red', yellow: 'yellow', purple: 'purple' };

    arena.innerHTML = `
      <div class="glass-strong rounded-2xl p-6 sm:p-8 border-2 border-amber-500/30 animate-pop">
        <div class="flex items-center justify-between mb-5">
          <div class="flex items-center gap-3">
            <span class="text-3xl animate-wiggle">ğŸ—‚ï¸</span>
            <div>
              <h3 class="font-display font-bold text-xl text-amber-300">Category Sort</h3>
              <p class="text-gray-500 text-xs">${currentItem + 1} / ${items.length} items</p>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <div class="glass rounded-xl px-3 py-1.5"><span class="text-green-300 font-mono font-bold text-sm">âœ… ${score}</span></div>
            <div class="glass rounded-xl px-3 py-1.5"><span class="text-red-300 font-mono font-bold text-sm">âŒ ${wrong}</span></div>
          </div>
        </div>

        <div class="bg-amber-500/10 rounded-2xl p-6 border-2 border-amber-500/20 mb-6 text-center">
          <p class="text-gray-400 text-xs uppercase tracking-wider mb-2">Sort this item:</p>
          <p class="font-display font-bold text-xl sm:text-2xl text-white">${item.text}</p>
        </div>

        <div id="cs-feedback" class="mb-4 min-h-[40px]"></div>

        <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
          ${categorySortData.categories.map(cat => `
            <button onclick="csChoice('${cat.name}')" class="p-4 rounded-2xl glass border-2 border-${cat.color}-500/20 hover:border-${cat.color}-500/50 hover:bg-${cat.color}-500/10 transition-all text-center group">
              <span class="text-2xl block mb-1 group-hover:animate-wiggle">${cat.emoji}</span>
              <span class="font-display font-bold text-${cat.color}-300 text-xs sm:text-sm">${cat.name}</span>
            </button>`).join('')}
        </div>
      </div>`;
  }

  window.csChoice = function(catName) {
    const item = items[currentItem];
    const fb = document.getElementById('cs-feedback');
    if (catName === item.cat) {
      score++; addXP(10); updateStreak(true);
      fb.innerHTML = `<div class="text-center text-green-300 font-bold animate-pop text-lg">âœ… Correct! +10 XP</div>`;
      confetti({ particleCount: 20, spread: 30, origin: { y: 0.7 }, colors: ['#fbbf24', '#34d399'] });
    } else {
      wrong++; updateStreak(false);
      fb.innerHTML = `<div class="text-center text-red-300 font-bold animate-shake">âŒ Nope! It's <span class="text-white">${item.cat}</span></div>`;
    }
    setTimeout(() => { currentItem++; renderSort(); }, 1000);
  };

  function endSort() {
    confetti({ particleCount: 100, spread: 80, colors: ['#fbbf24', '#d946ef', '#34d399'] });
    const pct = Math.round((score / items.length) * 100);
    arena.innerHTML = `
      <div class="glass-strong rounded-2xl p-8 text-center animate-pop border-2 border-amber-500/30">
        <span class="text-5xl">ğŸ—‚ï¸</span>
        <h3 class="font-display font-bold text-2xl text-amber-300 mt-4">Sorting Complete!</h3>
        <p class="text-white text-4xl font-mono font-bold mt-3">${score} / ${items.length}</p>
        <p class="text-gray-400 text-sm mt-2">(${pct}%) correctly sorted</p>
        <button onclick="startBlastGame('categorysort')" class="mt-6 px-8 py-3 rounded-2xl bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold hover:opacity-90 transition">ğŸ—‚ï¸ Play Again</button>
      </div>`;
  }

  renderSort();
}
</script>
</body>
</html>
